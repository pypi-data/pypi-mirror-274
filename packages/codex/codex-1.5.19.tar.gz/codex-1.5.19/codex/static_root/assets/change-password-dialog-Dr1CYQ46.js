import{_,b as C,a as m}from"./VSlideGroup-BdgkaRxE.js";import{b1 as g,cp as k,cq as E,N as L,k as f,O as c,m as N,t as B,_ as v,R as l,P as i,T as a,ao as D,ap as w,L as n,ae as d,ai as u,ah as p,ak as A,b4 as O,aj as I,aB as M,aG as h,a_ as b,aE as P}from"./admin-drawer-panel-DffXGW1d.js";import{V as U}from"./confirm-footer-CIu2tkFD.js";const R={name:"ChangePasswordDialog",components:{SubmitFooter:_,CloseButton:g},props:{user:{type:Object,required:!0},isAdminMode:{type:Boolean,default:!1},size:{type:String,default:"default"},density:{type:String,default:"default"}},data(){return{rules:{oldPassword:[e=>!!e||"Old Password is required"],password:[e=>e?e.length<this.MIN_PASSWORD_LENGTH?`Password must be ${this.MIN_PASSWORD_LENGTH} characters long`:e===this.credentials.oldPassword?"New password must be different than old password":!0:"New Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},credentials:{oldPassword:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,showDialog:!1,mdiLockReset:k,mdiLockPlusOutline:E}},computed:{...L(f,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN})},watch:{showDialog(e){if(e){const s=this.$refs.form;s&&s.reset(),this.clearErrors()}},credentials:{handler(){const e=this.$refs.form;if(!e){this.submitButtonEnabled=!1;return}e.validate().then(({valid:s})=>this.submitButtonEnabled=s).catch(()=>{this.submitButtonEnabled=!1})},deep:!0}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyListener)},methods:{...c(N,["changePassword"]),...c(f,["clearErrors"]),doUserChange(){return B().changeUserPassword(this.user.pk,this.credentials).catch(console.error)},doSelfChange(){return this.changePassword(this.credentials).catch(console.error)},submit(){const e=this.$refs.form;e&&e.validate().then(({valid:s})=>{if(s)return this.isAdminMode?this.doUserChange():this.doSelfChange()}).catch(console.error)},_keyListener(e){e.stopImmediatePropagation()}}},F={key:0,class:"codexFormSuccess"},T=["value"];function x(e,s,t,z,o,y){const S=g,V=_;return t.user?(l(),i(U,{key:0,modelValue:o.showDialog,"onUpdate:modelValue":s[7]||(s[7]=r=>o.showDialog=r),origin:"center-top",transition:"slide-y-transition","max-width":"22em"},{activator:a(({props:r})=>[t.isAdminMode?(l(),i(D,w({key:0,icon:""},r,{size:t.size,density:t.density,title:"Change Password"}),{default:a(()=>[n(p,null,{default:a(()=>[d(u(o.mdiLockPlusOutline),1)]),_:1})]),_:2},1040,["size","density"])):(l(),i(A,O(w({key:1},r)),{default:a(()=>[n(I,null,{default:a(()=>[n(p,null,{default:a(()=>[d(u(o.mdiLockReset),1)]),_:1}),d("Change Password ")]),_:1})]),_:2},1040))]),default:a(()=>[e.formSuccess?(l(),M("div",F,[d(u(e.formSuccess)+" ",1),n(S,{onClick:s[0]||(s[0]=r=>o.showDialog=!1)})])):(l(),i(C,{key:1,ref:"form",class:"changePasswordForm"},{default:a(()=>[h("h2",null,"User "+u(t.user.username),1),h("input",{name:"username",autocomplete:"username",disabled:"",type:"text",class:"hidden",value:t.user.username},null,8,T),t.isAdminMode?P("",!0):(l(),i(m,{key:0,ref:"oldPassword",modelValue:o.credentials.oldPassword,"onUpdate:modelValue":s[1]||(s[1]=r=>o.credentials.oldPassword=r),autocomplete:"current-password",label:"Old Password",rules:o.rules.oldPassword,clearable:"",type:"password",autofocus:"",onKeydown:s[2]||(s[2]=b(r=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"])),n(m,{ref:"password",modelValue:o.credentials.password,"onUpdate:modelValue":s[3]||(s[3]=r=>o.credentials.password=r),autocomplete:"new-password",label:"New Password",rules:o.rules.password,clearable:"",type:"password",autofocus:t.isAdminMode,onKeydown:s[4]||(s[4]=b(r=>e.$refs.passwordConfirm.focus(),["enter"]))},null,8,["modelValue","rules","autofocus"]),n(m,{ref:"passwordConfirm",modelValue:o.credentials.passwordConfirm,"onUpdate:modelValue":s[5]||(s[5]=r=>o.credentials.passwordConfirm=r),autocomplete:"new-password",label:"Confirm Password",rules:o.rules.passwordConfirm,clearable:"",type:"password"},null,8,["modelValue","rules"]),n(V,{verb:"Change",table:"Password",disabled:!o.submitButtonEnabled,onSubmit:y.submit,onCancel:s[6]||(s[6]=r=>o.showDialog=!1)},null,8,["disabled","onSubmit"])]),_:1},512))]),_:1},8,["modelValue"])):P("",!0)}const K=v(R,[["render",x],["__scopeId","data-v-19b56e24"]]);export{K as _};
