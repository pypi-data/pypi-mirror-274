const __vite__fileDeps=["assets/admin-drawer-panel-DffXGW1d.js","assets/admin-drawer-panel-Dv_IY0x2.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{x as te,b_ as we,E as ue,bO as ye,bN as Se,au as ce,F as Pe,G as oe,I as Ce,aw as ie,ax as Q,b$ as Te,bR as Re,bU as Ve,s as W,A as Dt,h as b,K as ne,L as r,C as X,b2 as qe,c0 as Bt,N as j,k as le,aA as de,m as N,O as me,_ as M,R as k,P as C,T as v,aG as L,ai as V,aB as q,aE as A,c1 as Ke,c2 as xt,c3 as Et,ae as D,ah as H,bh as It,bk as Lt,c4 as At,Q as ee,ap as G,ao as Ze,c5 as Nt,as as pe,c6 as $t,r as Je,X as Ot,y as Mt,c7 as Ft,M as De,c8 as J,bS as Ut,c9 as Ht,bV as zt,ca as Wt,aj as Qe,b4 as jt,b5 as Gt,ak as et,a_ as he,cb as tt,cc as Yt,aF as ot,bq as nt,aD as Be,aW as _e,bW as st,cd as at,H as xe,ce as rt,l as Xt,cf as qt,cg as Kt,ch as it,a as Z,o as lt,ci as Zt,cj as ae,w as Jt,ck as Qt,J as ut,cl as eo,bL as to,cm as oo,ay as ct,bX as dt,cn as no,n as so,ad as ao,bl as ro}from"./admin-drawer-panel-DffXGW1d.js";import{m as mt,b as gt,_ as ht,C as Oe,r as fe,u as io,A as Me,c as lo,d as uo}from"./main-DB0zDxIA.js";import{c as co,t as mo}from"./index-DUjeNg4x.js";import{V as ft,b as go,u as ho,c as fo}from"./confirm-footer-CIu2tkFD.js";import{_ as vt}from"./change-password-dialog-Dr1CYQ46.js";import{_ as bt,a as ve,b as vo}from"./VSlideGroup-BdgkaRxE.js";import{a as bo,c as po,u as _o,V as Fe,d as Ue}from"./VSelectionControl-DvHEDoJy.js";const ko=te({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...we(),...ue(),...ye(),...mt(),...Se(),...ce({tag:"footer"}),...Pe()},"VFooter"),pt=oe()({name:"VFooter",props:ko(),setup(e,t){let{slots:o}=t;const{themeClasses:a}=Ce(e),{backgroundColorClasses:n,backgroundColorStyles:s}=ie(Q(e,"color")),{borderClasses:i}=Te(e),{elevationClasses:l}=Re(e),{roundedClasses:y}=Ve(e),p=W(32),{resizeRef:m}=Dt(w=>{w.length&&(p.value=w[0].target.clientHeight)}),d=b(()=>e.height==="auto"?p.value:parseInt(e.height,10)),{layoutItemStyles:g,layoutIsReady:_}=gt({id:e.name,order:b(()=>parseInt(e.order,10)),position:b(()=>"bottom"),layoutSize:d,elementSize:b(()=>e.height==="auto"?void 0:d.value),active:b(()=>e.app),absolute:Q(e,"absolute")});return ne(()=>r(e.tag,{ref:m,class:["v-footer",a.value,n.value,i.value,l.value,y.value,e.class],style:[s.value,e.app?g.value:{height:X(e.height)},e.style]},o)),e.app?_:{}}}),wo={name:"VersionFooter",data(){return{mdiOpenInNew:qe,mdiContentCopy:Bt}},computed:{...j(le,{versions:e=>e.versions}),...de(N,["isUserAdmin"]),outdated:function(){return this.isUserAdmin&&this.semverGreaterThan(this.versions.latest>this.versions.installed)},versionTitle:function(){return this.outdated?`v${this.versions.latest} is available`:"up to date"}},created(){this.loadVersions()},methods:{...me(le,["loadVersions"]),semverGreaterThan(e,t){try{if(!e||!t)return!1;const o=e.split("."),a=t.split(".");for(const[n,s]of o.entries())if(+s>+a[n])return!0}catch(o){console.debug("compare codex versions",e,">",t,o)}return!1}}},yo={id:"version"},So={key:0,id:"latest"};function Po(e,t,o,a,n,s){return k(),C(pt,{id:"version-footer",title:s.versionTitle},{default:v(()=>[L("div",yo,"codex v"+V(e.versions.installed),1),s.outdated?(k(),q("div",So," codex v"+V(e.versions.latest)+" is available ",1)):A("",!0)]),_:1},8,["title"])}const _t=M(wo,[["render",Po],["__scopeId","data-v-cd481730"]]),Co={name:"OPDSUrl",props:{title:{type:String,required:!0},subtitle:{type:String,default:void 0},url:{type:String,required:!0}},data(){return{mdiRss:Ke,showTooltip:{show:!1}}},computed:{clipBoardEnabled(){return location.protocol=="https:"},clipBoardIcon(){return this.showTooltip.show?xt:Et},tooltip(){return this.clipBoardEnabled}},methods:{onClickURL(){this.clipBoardEnabled&&co(this.url,this.showTooltip)}}},To=["title"],Ro={key:0},Vo={class:"copied"},Do={key:0,class:"subtitle"},Bo={class:"opdsUrl"};function xo(e,t,o,a,n,s){return k(),q("div",{class:"opdsVersion",title:s.tooltip,onClick:t[0]||(t[0]=(...i)=>s.onClickURL&&s.onClickURL(...i))},[L("h3",null,[D(V(o.title)+" ",1),s.clipBoardEnabled?(k(),q("span",Ro,[r(H,{class:"clipBoardIcon",size:"small"},{default:v(()=>[D(V(s.clipBoardIcon),1)]),_:1}),r(At,null,{default:v(()=>[It(L("span",Vo,"Copied",512),[[Lt,n.showTooltip.show]])]),_:1})])):A("",!0)]),o.subtitle?(k(),q("div",Do,V(o.subtitle),1)):A("",!0),L("div",Bo,V(o.url),1)],8,To)}const Eo=M(Co,[["render",xo],["__scopeId","data-v-68a52a66"]]),Io={name:"OPDSDialog",components:{OPDSUrl:Eo},data(){return{mdiRss:Ke,opdsV1URL:window.origin+window.CODEX.OPDS_V1_PATH,opdsV2URL:window.origin+window.CODEX.OPDS_V2_PATH}}},Lo={id:"opds"};function Ao(e,t,o,a,n,s){const i=ee("OPDSUrl");return k(),C(ft,{"max-width":"30em"},{activator:v(({props:l})=>[r(Ze,G({id:"opdsButton",icon:"",size:"small",variant:"plain"},l),{default:v(()=>[r(H,null,{default:v(()=>[D(V(n.mdiRss),1)]),_:1}),D(" OPDS ")]),_:2},1040)]),default:v(()=>[L("div",Lo,[L("h2",null,[r(H,{size:"x=small",class:"inline"},{default:v(()=>[D(V(n.mdiRss),1)]),_:1}),D(" OPDS ")]),r(i,{title:"v1.2",url:n.opdsV1URL},null,8,["url"]),r(i,{title:"v2.0",url:n.opdsV2URL,subtitle:"OPDS v2 is experimental and not widely or well supported by clients"},null,8,["url"])])]),_:1})}const No=M(Io,[["render",Ao],["__scopeId","data-v-741734ce"]]),$o={name:"SettingsFooter",components:{OPDSDialog:No},data(){return{mdiOpenInNew:qe,mdiSourceRepository:Nt}},computed:{...de(N,["isCodexViewable"])}},Oo={id:"repo",href:"https://github.com/ajslater/codex",title:"Codex Source Repository",target:"_blank"};function Mo(e,t,o,a,n,s){const i=ee("OPDSDialog");return k(),C(pt,{id:"settingsFooter"},{default:v(()=>[e.isCodexViewable?(k(),C(i,{key:0})):A("",!0),L("a",Oo,[r(H,{id:"repoIcon",size:"x-small"},{default:v(()=>[D(V(n.mdiSourceRepository),1)]),_:1}),D(" repository"),r(H,{color:e.$vuetify.theme.current.colors.iconsInactive,size:"x-small"},{default:v(()=>[D(V(n.mdiOpenInNew),1)]),_:1},8,["color"])])]),_:1})}const kt=M($o,[["render",Mo],["__scopeId","data-v-f9eb593e"]]),Fo=te({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...bo(),...po()},"VSwitch"),Uo=oe()({name:"VSwitch",inheritAttrs:!1,props:Fo(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,t){let{attrs:o,slots:a}=t;const n=pe(e,"indeterminate"),s=pe(e,"modelValue"),{loaderClasses:i}=$t(e),{isFocused:l,focus:y,blur:p}=_o(e),m=Je(),d=Ot&&window.matchMedia("(forced-colors: active)").matches,g=b(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),_=Mt(),w=b(()=>e.id||`switch-${_}`);function T(){n.value&&(n.value=!1)}function $(E){var B,R;E.stopPropagation(),E.preventDefault(),(R=(B=m.value)==null?void 0:B.input)==null||R.click()}return ne(()=>{const[E,B]=Ft(o),R=Fe.filterProps(e),F=Ue.filterProps(e);return r(Fe,G({class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":n.value},i.value,e.class]},E,R,{modelValue:s.value,"onUpdate:modelValue":U=>s.value=U,id:w.value,focused:l.value,style:e.style}),{...a,default:U=>{let{id:u,messagesId:c,isDisabled:h,isReadonly:f,isValid:P}=U;const S={model:s,isValid:P};return r(Ue,G({ref:m},F,{modelValue:s.value,"onUpdate:modelValue":[I=>s.value=I,T],id:u.value,"aria-describedby":c.value,type:"checkbox","aria-checked":n.value?"mixed":void 0,disabled:h.value,readonly:f.value,onFocus:y,onBlur:p},B),{...a,default:I=>{let{backgroundColorClasses:z,backgroundColorStyles:O}=I;return r("div",{class:["v-switch__track",d?void 0:z.value],style:O.value,onClick:$},[a["track-true"]&&r("div",{key:"prepend",class:"v-switch__track-true"},[a["track-true"](S)]),a["track-false"]&&r("div",{key:"append",class:"v-switch__track-false"},[a["track-false"](S)])])},input:I=>{let{inputNode:z,icon:O,backgroundColorClasses:se,backgroundColorStyles:ge}=I;return r(De,null,[z,r("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":O||e.loading},e.inset||d?void 0:se.value],style:e.inset?void 0:ge.value},[a.thumb?r(J,{defaults:{VIcon:{icon:O,size:"x-small"}}},{default:()=>[a.thumb({...S,icon:O})]}):r(Ut,null,{default:()=>[e.loading?r(Ht,{name:"v-switch",active:!0,color:P.value===!1?void 0:g.value},{default:K=>a.loader?a.loader(K):r(zt,{active:K.isActive,color:K.color,indeterminate:!0,size:"16",width:"2"},null)}):O&&r(H,{key:String(O),icon:O,size:"x-small"},null)]})])])}})}})}),{}}}),Ho={name:"AuthLoginDialog",components:{SubmitFooter:bt},data(){return{rules:{username:[e=>!!e||"Username is required"],password:[e=>e?this.registerMode&&e.length<this.MIN_PASSWORD_LEN?`Password must be ${this.MIN_PASSWORD_LEN} characters long`:!0:"Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},formModel:{},credentials:{username:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,showDialog:!1,registerMode:!1,mdiLogin:Wt}},computed:{...j(le,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success}),...j(N,{adminFlags:e=>e.adminFlags,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN}),submitButtonLabel:function(){return this.registerMode?"Register":"Login"}},watch:{showDialog(e){e&&(this.loadAdminFlags(),this.$refs.form&&this.$refs.form.reset())},credentials:{handler(){const e=this.$refs.form;e?e.validate().then(({valid:t})=>this.submitButtonEnabled=t).catch(console.error):this.submitButtonEnabled=!1},deep:!0}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyListener)},methods:{...me(N,["loadAdminFlags","login","register"]),doAuth(e){return this[e](this.credentials).then(()=>this.showDialog=this.formErrors&&this.formErrors.length>0).catch(console.error)},submit(){this.$refs.form.validate().then(({valid:t})=>{if(!t)return;const o=this.registerMode?"register":"login";return this.doAuth(o)}).catch(console.error)},_keyListener(e){e.stopImmediatePropagation()}}};function zo(e,t,o,a,n,s){const i=bt;return k(),C(ft,{modelValue:n.showDialog,"onUpdate:modelValue":t[7]||(t[7]=l=>n.showDialog=l),origin:"center-top",transition:"slide-y-transition","max-width":"20em"},{activator:v(({props:l})=>[r(et,jt(Gt(l)),{default:v(()=>[r(Qe,null,{default:v(()=>[r(H,null,{default:v(()=>[D(V(n.mdiLogin),1)]),_:1}),D(" Login ")]),_:1})]),_:2},1040)]),default:v(()=>[r(vo,{id:"authDialog",ref:"form"},{default:v(()=>[r(ve,{modelValue:n.credentials.username,"onUpdate:modelValue":t[0]||(t[0]=l=>n.credentials.username=l),autocomplete:"username",label:"Username",rules:n.rules.username,clearable:"",autofocus:"",onKeydown:t[1]||(t[1]=he(l=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"]),r(ve,{ref:"password",modelValue:n.credentials.password,"onUpdate:modelValue":t[2]||(t[2]=l=>n.credentials.password=l),autocomplete:n.registerMode?"new-password":"current-password",label:"Password",rules:n.rules.password,clearable:"",type:"password",onKeydown:t[3]||(t[3]=he(l=>{n.registerMode?e.$refs.passwordConfirm.focus():s.submit()},["enter"]))},null,8,["modelValue","autocomplete","rules"]),r(tt,null,{default:v(()=>[n.registerMode?(k(),C(ve,{key:0,ref:"passwordConfirm",modelValue:n.credentials.passwordConfirm,"onUpdate:modelValue":t[4]||(t[4]=l=>n.credentials.passwordConfirm=l),autocomplete:"new-password",label:"Confirm Password",rules:n.rules.passwordConfirm,clearable:"",type:"password",onKeydown:he(s.submit,["enter"])},null,8,["modelValue","rules","onKeydown"])):A("",!0)]),_:1}),e.adminFlags.registration?(k(),C(Uo,{key:0,modelValue:n.registerMode,"onUpdate:modelValue":t[5]||(t[5]=l=>n.registerMode=l),label:"Register"},{default:v(()=>[D(" Register ")]),_:1},8,["modelValue"])):A("",!0),r(i,{verb:n.registerMode?"Register":"Login",table:"",disabled:!n.submitButtonEnabled,onSubmit:s.submit,onCancel:t[6]||(t[6]=l=>n.showDialog=!1)},null,8,["verb","disabled","onSubmit"])]),_:1},512)]),_:1},8,["modelValue"])}const Wo=M(Ho,[["render",zo],["__scopeId","data-v-ef06f84f"]]),jo={name:"AuthLogoutItem",data:function(){return{mdiLogout:Yt}},computed:{...j(N,{username:e=>e.user.username})},methods:{...me(N,["logout"])}};function Go(e,t,o,a,n,s){return k(),C(et,{onClick:e.logout},{default:v(()=>[r(Qe,null,{default:v(()=>[r(H,null,{default:v(()=>[D(V(e.mdiLogout),1)]),_:1}),D("Logout "+V(e.username),1)]),_:1})]),_:1},8,["onClick"])}const Yo=M(jo,[["render",Go]]),Xo={name:"AuthMenu",components:{ChangePasswordDialog:vt,AuthLoginDialog:Wo,AuthLogoutItem:Yo},computed:{...j(N,{user:e=>e.user})},methods:{...me(N,["logout"])}};function qo(e,t,o,a,n,s){const i=ee("AuthLogoutItem"),l=vt,y=ee("AuthLoginDialog");return k(),q(De,null,[e.user?(k(),C(i,{key:0})):A("",!0),e.user?(k(),C(l,{key:1,user:e.user},null,8,["user"])):(k(),C(y,{key:2}))],64)}const wt=M(Xo,[["render",qo]]),He=ot(nt(()=>ht(()=>import("./admin-drawer-panel-DffXGW1d.js").then(e=>e.dB),__vite__mapDeps([0,1])))),Ko={name:"SettingsCommonPanel",components:{AuthMenu:wt,AdminMenu:He},props:{adminMenu:{type:Boolean,default:!0}},data(){return{AdminMenu:He}},computed:{...de(N,["isUserAdmin"])}},Zo={id:"commonPanel"};function Jo(e,t,o,a,n,s){const i=wt;return k(),q("div",Zo,[r(i),e.isUserAdmin?(k(),C(_e,{key:0})):A("",!0),e.isUserAdmin?(k(),C(Be(n.AdminMenu),{key:1,menu:o.adminMenu},null,8,["menu"])):A("",!0)])}const Qo=M(Ko,[["render",Jo],["__scopeId","data-v-a21632a4"]]),en=e=>{const t=e.pk,o=at();return e={...e,...o},delete e.pk,xe.get(`c/${t}`,{params:e})},tn=()=>{const e=at();return xe.get("c/settings",{params:e})},on=e=>xe.put("c/settings",e),Mn=({pk:e,mtime:t})=>`${rt(e)}/download/comic-${e}.cbz?mtime=${t}`,Fn=({pk:e,page:t,mtime:o})=>`${rt(e)}/${t}/page.jpg?mtime=${o}`,ze=({pk:e,page:t,mtime:o})=>`${st(e)}/${t}/page.jpg?mtime=${o}`,nn=({pk:e,mtime:t})=>`/c/${e}/book.pdf?mtime=${t}`,be={getPdfBookSource:nn,getReaderBasePath:st,getReaderInfo:en,getReaderSettings:tn,setReaderSettings:on},sn=function(e){let t;return e?t=e.length===4&&!Number.isNaN(e)?" ("+e+")":" v"+e:t="",t},an=function({issueNumber:e,issueSuffix:t},o){let a;try{e==null&&!t&&(e=0);const n=Number.parseFloat(e),s=Math.floor(n);o===void 0&&(o=0),n===s?a=s.toString():(a=n.toString(),o+=a.split(".")[1].length+1),a=a.padStart(o,"0")}catch{a=""}return t&&(a+=t),a},rn=function({issueNumber:e,issueSuffix:t,issueCount:o},a){let n="#"+an({issueNumber:e,issueSuffix:t},a);return o&&(n+=` of ${o}`),n},ln=function({seriesName:e,volumeName:t,issueNumber:o,issueSuffix:a,issueCount:n},s){const i=sn(t),l=rn({issueNumber:o,issueSuffix:a,issueCount:n},s);return[e,i,l].filter(Boolean).join(" ")},yt={fitTo:"",twoPages:null,readingDirection:"",readRtlInReverse:null};Object.freeze(yt);const St={cacheBook:!1};Object.freeze(St);const re=new Set(["",null,void 0]);Object.freeze(re);const Pt={prev:"next",next:"prev"};Object.freeze(Pt);const ke={rel:"prefetch",as:"image"};Object.freeze(ke);const Ee=new Set(["ttb","btt"]);Object.freeze(Ee);const Ct=new Set(["rtl","btt"]);Object.freeze(Ct);const We=1,Tt={S:"Screen",W:"Width",H:"Height",O:"Original"};Object.freeze(Tt);const un=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>600?"HEIGHT":"WIDTH",je=e=>{Ee.has(e.readingDirection)&&e.twoPages&&(e.twoPages=!1)},cn=Xt("reader",{state:()=>({choices:{fitTo:Oe.reader.fitTo,readingDirection:Oe.reader.readingDirection,nullValues:re},readerSettings:{fitTo:un(),twoPages:!1,readingDirection:"ltr",readRtlInReverse:!1},books:{current:void 0,prev:!1,next:!1},arcs:[],arc:{},page:void 0,routes:{prev:!1,next:!1,books:{prev:!1,next:!1}},bookChange:void 0,reactWithScroll:!1,clientSettings:{cacheBook:!1,scale:We}}),getters:{groupBooks(e){const t=[];return e.books.prev[0]&&t.push[e.books.prev[0]],t.push[e.books.current],e.books.next[0]&&t.push[e.books.next[0]],t},activeSettings(e){return e.getSettings(e.books.current)||{}},activeTitle(e){var a;const t=e.books.current;let o;return((a=e.arcs[0])==null?void 0:a.group)==="f"&&(o=t==null?void 0:t.filename),o||(o=t?ln(t):""),o},routeParams(e){return{pk:+e.books.current.pk,page:+e.page}},isVertical(e){return Ee.has(e.activeSettings.readingDirection)},isPDF(e){var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.fileType)=="PDF"},cacheBook(e){return e.clientSettings.cacheBook&&!(this.isPDF&&this.isVertical)},isPagesNotRoutes(e){return e.isVertical||this.cacheBook},isReadInReverse(e){return Ct.has(e.activeSettings.readingDirection)},isBTT(e){return e.activeSettings.readingDirection==="btt"},isFirstPage(e){return e.page===0},isLastPage(e){const t=e.books.current?e.books.current.maxPage:0,o=e.activeSettings.twoPages?1:0,a=t-o;return this.page>=a}},actions:{setReadRTLInReverse(e){return this.readerSettings.readRtlInReverse&&e.readingDirection==="rtl"?{...e,readingDirection:"ltr"}:e},getSettings(e){const t={...re};let o=e?e.settings:{};o=this.setReadRTLInReverse(o);const a=[this.readerSettings,o];for(const n of a)for(const[s,i]of Object.entries(n))re.has(i)||(t[s]=i);return je(t),t},bookChangeLocation(e){let t;return this.isBTT?t=e==="next"?"left":"right":t=e==="next"?"right":"left",t},bookChangeCursorClass(e){let t;return this.isReadInReverse?t=e==="next"?"up":"down":t=e==="next"?"down":"up",t+"Cursor"},bookChangeShow(e){return e==="prev"?this.books.prev&&this.isFirstPage:this.books.next&&this.isLastPage},bookChangeIcon(e){let t=e==="next";return this.isBTT&&(t=!t),t?qt:Kt},isCoverPage(e,t){return e.readLtr!==!1&&t===0||e.readLtr&&t===e.maxPage},_getRouteParams(e,t,o){const a=o==="prev"?-1:1;let n=1;this.getSettings(e).twoPages&&!this.isCoverPage(e,+t+a)&&(n=2),n=n*a;const i=+t+n;let l=!1;return i>=0&&i<=e.maxPage&&(l={pk:e.pk,page:i}),l},fitToClass(e){const t=this.getSettings(e),o={};let a;if(this.clientSettings.scale>We?a="Orig":a=Tt[t.fitTo],a){let n="fitTo";n+=mo(a),this.isVertical?n+="Vertical":t.twoPages&&(n+="Two"),o[n]=!0}return o},_updateSettings(e,t){t?(this.books.current.settings={...this.books.current.settings,...e},je(this.books.current.settings)):this.readerSettings={...this.readerSettings,...e}},_getBookRoutePage(e,t){let o=0;if(t&&e.readLtr!==!1||!t&&e.readLtr===!1){const n=this.getSettings(e).twoPages?-1:0;o=e.maxPage+n}return o},_getBookRoute(e,t){if(!e)return!1;const o=this._getBookRoutePage(e,t);return{pk:e.pk,page:o}},_getBookRoutes(e,t){return{prev:this._getBookRoute(e,!0),next:this._getBookRoute(t,!1)}},async setRoutesAndBookmarkPage(e){const t=this.books.current;this.$patch(o=>{o.routes.prev=this._getRouteParams(t,e,"prev"),o.routes.next=this._getRouteParams(t,e,"next")}),await this._setBookmarkPage(e).then(()=>(this.bookChange=void 0,!0))},setActivePage(e,t=!0){if(e<0)return console.warn("Page out of bounds. Redirecting to 0."),this.routeToPage(0);if(e>this.books.current.maxPage)return console.warn(`Page out of bounds. Redirecting to ${this.books.current.maxPage}.`),this.routeToPage(this.books.current.maxPage);if(this.reactWithScroll=!!t,this.page=+e,this.setRoutesAndBookmarkPage(e),this.isPagesNotRoutes){const o={params:{pk:this.books.current.pk,page:e}},{href:a}=fe.resolve(o);window.history.pushState({},void 0,a)}else window.scrollTo(0,0)},async loadReaderSettings(){return be.getReaderSettings().then(e=>{const t=e.data;return this._updateSettings(t,!1),!0}).catch(console.error)},async loadBooks(e){await be.getReaderInfo(e).then(t=>{const o=t.data,a=[o.books.prevBook,o.books.current,o.books.nextBook];for(const s of a)s&&!s.settings&&(s.settings={});const n=this._getBookRoutes(o.books.prevBook,o.books.nextBook);return this.$patch(s=>{s.books.current=o.books.current,s.books.prev=o.books.prevBook,s.books.next=o.books.nextBook,s.arcs=o.arcs,s.arc=o.arc,s.routes.prev=this._getRouteParams(s.books.current,e.page,"prev"),s.routes.next=this._getRouteParams(s.books.current,e.page,"next"),s.routes.books=n}),!0}).catch(t=>{console.debug(t);const o=io().page,a=o&&o.routes?o.routes.last:{name:"home"};return fe.push(a)})},async _setBookmarkPage(e){const t={group:"c",pk:this.books.current.pk};e=Math.max(Math.min(this.books.current.maxPage,e),0);const o={page:e};await Me.setGroupBookmarks(t,o)},async setSettingsLocal(e){this._updateSettings(e,!0),await Me.setGroupBookmarks({group:"c",pk:+this.books.current.pk},this.books.current.settings)},setSettingsClient(e){this.clientSettings={...this.clientSettings,...e}},async clearSettingsLocal(){await this.setSettingsLocal(yt),this.setSettingsClient(St)},async setSettingsGlobal(e){this._updateSettings(e,!1),await be.setReaderSettings(this.readerSettings),await this.clearSettingsLocal()},setBookChangeFlag(e){e=this.normalizeDirection(e),this.bookChange=this.routes.books[e]?e:void 0},normalizeDirection(e){return this.isReadInReverse?Pt[e]:e},_validateRoute(e,t){if(t||(t=this.books.current),!t)return{};const o=t.maxPage??0;return e.page>o?(e.page=o,console.warn("Tried to navigate past the end of the book.")):e.page<0&&(e.page=0,console.warn("Tried to navigate before the beginning of the book.")),e},_routeTo(e,t){if(e=this._validateRoute(e,t),this.isPagesNotRoutes&&+e.pk===this.books.current.pk)this.setActivePage(+e.page,!0);else{const o={name:"reader",params:e};fe.push(o).catch(console.debug)}},routeToDirectionOne(e){e=this.normalizeDirection(e);const t=e==="prev"?-1:1,o=this.page+=t;if(o<0||o>this.books.current.maxPage)return;const a={pk:this.books.current.pk,page:o};this._routeTo(a)},routeToDirection(e){if(e=this.normalizeDirection(e),this.routes[e]){const t=this.routes[e];this._routeTo(t)}else this.routes.books[e]?this.bookChange===e?this._routeTo(this.routes.books[e],this.books[e]):this.setBookChangeFlag(e):console.debug("No route to direction",e)},routeToPage(e){const t={pk:this.books.current.pk,page:e};this._routeTo(t)},routeToBook(e){this._routeTo(this.routes.books[e],this.books[e])},_prefetchSrc(e,t,o=!1,a=!1){if(!e)return!1;const n=o?this.books[t]:this.books.current;if(!n)return!1;let s=e.page;if(a){if(!this.getSettings(n).twoPages)return!1;s+=1}if(s>n.maxPage)return!1;const i={pk:e.pk,page:s,mtime:n.mtime};return ze(i)},prefetchLinks(e,t,o=!1){if(!o&&this.cacheBook)return{};const a=[this._prefetchSrc(e,t,o,!1),this._prefetchSrc(e,t,o,!0)],n=[];for(const s of a)s&&n.push({...ke,href:s});return{link:n}},prefetchBook(e){if(!this.cacheBook||e.fileType=="PDF")return{};const t=e.pk,o=[];for(let a=0;a<=e.maxPage;a++){const n={pk:t,page:a,mtime:e.mtime},s=ze(n);s&&o.push({...ke,href:s})}return{link:o}},toRoute(e){return e?{params:e}:{}},linkLabel(e,t){return`${e==="prev"?"Previous":"Next"} ${t}`}}});function dn(e){let{rootEl:t,isSticky:o,layoutItemStyles:a}=e;const n=W(!1),s=W(0),i=b(()=>{const p=typeof n.value=="boolean"?"top":n.value;return[o.value?{top:"auto",bottom:"auto",height:void 0}:void 0,n.value?{[p]:X(s.value)}:{top:a.value.top}]});it(()=>{Z(o,p=>{p?window.addEventListener("scroll",y,{passive:!0}):window.removeEventListener("scroll",y)},{immediate:!0})}),lt(()=>{window.removeEventListener("scroll",y)});let l=0;function y(){const p=l>window.scrollY?"up":"down",m=t.value.getBoundingClientRect(),d=parseFloat(a.value.top??0),g=window.scrollY-Math.max(0,s.value-d),_=m.height+Math.max(s.value,d)-window.scrollY-window.innerHeight,w=parseFloat(getComputedStyle(t.value).getPropertyValue("--v-body-scroll-y"))||0;m.height<window.innerHeight-d?(n.value="top",s.value=d):p==="up"&&n.value==="bottom"||p==="down"&&n.value==="top"?(s.value=window.scrollY+m.top-w,n.value=!0):p==="down"&&_<=0?(s.value=0,n.value="bottom"):p==="up"&&g<=0&&(w?n.value!=="top"&&(s.value=-g+w+d,n.value="top"):(s.value=m.top+g,n.value="top")),l=window.scrollY}return{isStuck:n,stickyStyles:i}}const mn=100,gn=20;function Ge(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function Ye(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let t=0;for(let o=e.length-1;o>0;o--){if(e[o].t===e[o-1].t)continue;const a=Ge(t),n=(e[o].d-e[o-1].d)/(e[o].t-e[o-1].t);t+=(n-a)*Math.abs(n),o===e.length-1&&(t*=.5)}return Ge(t)*1e3}function hn(){const e={};function t(n){Array.from(n.changedTouches).forEach(s=>{(e[s.identifier]??(e[s.identifier]=new Zt(gn))).push([n.timeStamp,s])})}function o(n){Array.from(n.changedTouches).forEach(s=>{delete e[s.identifier]})}function a(n){var p;const s=(p=e[n])==null?void 0:p.values().reverse();if(!s)throw new Error(`No samples for touch id ${n}`);const i=s[0],l=[],y=[];for(const m of s){if(i[0]-m[0]>mn)break;l.push({t:m[0],d:m[1].clientX}),y.push({t:m[0],d:m[1].clientY})}return{x:Ye(l),y:Ye(y),get direction(){const{x:m,y:d}=this,[g,_]=[Math.abs(m),Math.abs(d)];return g>_&&m>=0?"right":g>_&&m<=0?"left":_>g&&d>=0?"down":_>g&&d<=0?"up":fn()}}}return{addMovement:t,endTouch:o,getVelocity:a}}function fn(){throw new Error}function vn(e){let{el:t,isActive:o,isTemporary:a,width:n,touchless:s,position:i}=e;it(()=>{window.addEventListener("touchstart",B,{passive:!0}),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",F,{passive:!0})}),lt(()=>{window.removeEventListener("touchstart",B),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",F)});const l=b(()=>["left","right"].includes(i.value)),{addMovement:y,endTouch:p,getVelocity:m}=hn();let d=!1;const g=W(!1),_=W(0),w=W(0);let T;function $(u,c){return(i.value==="left"?u:i.value==="right"?document.documentElement.clientWidth-u:i.value==="top"?u:i.value==="bottom"?document.documentElement.clientHeight-u:Y())-(c?n.value:0)}function E(u){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const h=i.value==="left"?(u-w.value)/n.value:i.value==="right"?(document.documentElement.clientWidth-u-w.value)/n.value:i.value==="top"?(u-w.value)/n.value:i.value==="bottom"?(document.documentElement.clientHeight-u-w.value)/n.value:Y();return c?Math.max(0,Math.min(1,h)):h}function B(u){if(s.value)return;const c=u.changedTouches[0].clientX,h=u.changedTouches[0].clientY,f=25,P=i.value==="left"?c<f:i.value==="right"?c>document.documentElement.clientWidth-f:i.value==="top"?h<f:i.value==="bottom"?h>document.documentElement.clientHeight-f:Y(),S=o.value&&(i.value==="left"?c<n.value:i.value==="right"?c>document.documentElement.clientWidth-n.value:i.value==="top"?h<n.value:i.value==="bottom"?h>document.documentElement.clientHeight-n.value:Y());(P||S||o.value&&a.value)&&(T=[c,h],w.value=$(l.value?c:h,o.value),_.value=E(l.value?c:h),d=w.value>-20&&w.value<80,p(u),y(u))}function R(u){const c=u.changedTouches[0].clientX,h=u.changedTouches[0].clientY;if(d){if(!u.cancelable){d=!1;return}const P=Math.abs(c-T[0]),S=Math.abs(h-T[1]);(l.value?P>S&&P>3:S>P&&S>3)?(g.value=!0,d=!1):(l.value?S:P)>3&&(d=!1)}if(!g.value)return;u.preventDefault(),y(u);const f=E(l.value?c:h,!1);_.value=Math.max(0,Math.min(1,f)),f>1?w.value=$(l.value?c:h,!0):f<0&&(w.value=$(l.value?c:h,!1))}function F(u){if(d=!1,!g.value)return;y(u),g.value=!1;const c=m(u.changedTouches[0].identifier),h=Math.abs(c.x),f=Math.abs(c.y);(l.value?h>f&&h>400:f>h&&f>3)?o.value=c.direction===({left:"right",right:"left",top:"down",bottom:"up"}[i.value]||Y()):o.value=_.value>.5}const U=b(()=>g.value?{transform:i.value==="left"?`translateX(calc(-100% + ${_.value*n.value}px))`:i.value==="right"?`translateX(calc(100% - ${_.value*n.value}px))`:i.value==="top"?`translateY(calc(-100% + ${_.value*n.value}px))`:i.value==="bottom"?`translateY(calc(100% - ${_.value*n.value}px))`:Y(),transition:"none"}:void 0);return ae(g,()=>{var h,f;const u=((h=t.value)==null?void 0:h.style.transform)??null,c=((f=t.value)==null?void 0:f.style.transition)??null;Jt(()=>{var P,S,I,z;(S=t.value)==null||S.style.setProperty("transform",((P=U.value)==null?void 0:P.transform)||"none"),(z=t.value)==null||z.style.setProperty("transition",((I=U.value)==null?void 0:I.transition)||null)}),Qt(()=>{var P,S;(P=t.value)==null||P.style.setProperty("transform",u),(S=t.value)==null||S.style.setProperty("transition",c)})}),{isDragging:g,dragProgress:_,dragStyles:U}}function Y(){throw new Error}const bn=["start","end","left","right","top","bottom"],pn=te({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>bn.includes(e)},sticky:Boolean,...we(),...ue(),...go(),...lo({mobile:null}),...ye(),...mt(),...Se(),...ce({tag:"nav"}),...Pe()},"VNavigationDrawer"),_n=oe()({name:"VNavigationDrawer",props:pn(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,t){let{attrs:o,emit:a,slots:n}=t;const{isRtl:s}=ut(),{themeClasses:i}=Ce(e),{borderClasses:l}=Te(e),{backgroundColorClasses:y,backgroundColorStyles:p}=ie(Q(e,"color")),{elevationClasses:m}=Re(e),{displayClasses:d,mobile:g}=uo(e),{roundedClasses:_}=Ve(e),w=eo(),T=pe(e,"modelValue",null,x=>!!x),{ssrBootStyles:$}=to(),{scopeId:E}=ho(),B=Je(),R=W(!1),{runOpenDelay:F,runCloseDelay:U}=fo(e,x=>{R.value=x}),u=b(()=>e.rail&&e.expandOnHover&&R.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),c=b(()=>oo(e.location,s.value)),h=b(()=>e.persistent),f=b(()=>!e.permanent&&(g.value||e.temporary)),P=b(()=>e.sticky&&!f.value&&c.value!=="bottom");ae(()=>e.expandOnHover&&e.rail!=null,()=>{Z(R,x=>a("update:rail",!x))}),ae(()=>!e.disableResizeWatcher,()=>{Z(f,x=>!e.permanent&&so(()=>T.value=!x))}),ae(()=>!e.disableRouteWatcher&&!!w,()=>{Z(w.currentRoute,()=>f.value&&(T.value=!1))}),Z(()=>e.permanent,x=>{x&&(T.value=!0)}),e.modelValue==null&&!f.value&&(T.value=e.permanent||!g.value);const{isDragging:S,dragProgress:I}=vn({el:B,isActive:T,isTemporary:f,width:u,touchless:Q(e,"touchless"),position:c}),z=b(()=>{const x=f.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):u.value;return S.value?x*I.value:x}),O=b(()=>["top","bottom"].includes(e.location)?0:u.value),{layoutItemStyles:se,layoutItemScrimStyles:ge,layoutIsReady:K}=gt({id:e.name,order:b(()=>parseInt(e.order,10)),position:c,layoutSize:z,elementSize:O,active:b(()=>T.value||S.value),disableTransitions:b(()=>S.value),absolute:b(()=>e.absolute||P.value&&typeof Ie.value!="string")}),{isStuck:Ie,stickyStyles:Rt}=dn({rootEl:B,isSticky:P,layoutItemStyles:se}),Le=ie(b(()=>typeof e.scrim=="string"?e.scrim:null)),Vt=b(()=>({...S.value?{opacity:I.value*.2,transition:"none"}:void 0,...ge.value}));return ct({VList:{bgColor:"transparent"}}),ne(()=>{const x=n.image||e.image;return r(De,null,[r(e.tag,G({ref:B,onMouseenter:F,onMouseleave:U,class:["v-navigation-drawer",`v-navigation-drawer--${c.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":R.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":f.value,"v-navigation-drawer--persistent":h.value,"v-navigation-drawer--active":T.value,"v-navigation-drawer--sticky":P.value},i.value,y.value,l.value,d.value,m.value,_.value,e.class],style:[p.value,se.value,$.value,Rt.value,e.style,["top","bottom"].includes(c.value)?{height:"auto"}:{}]},E,o),{default:()=>{var Ae,Ne,$e;return[x&&r("div",{key:"image",class:"v-navigation-drawer__img"},[n.image?r(J,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},n.image):r(dt,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),n.prepend&&r("div",{class:"v-navigation-drawer__prepend"},[(Ae=n.prepend)==null?void 0:Ae.call(n)]),r("div",{class:"v-navigation-drawer__content"},[(Ne=n.default)==null?void 0:Ne.call(n)]),n.append&&r("div",{class:"v-navigation-drawer__append"},[($e=n.append)==null?void 0:$e.call(n)])]}}),r(no,{name:"fade-transition"},{default:()=>[f.value&&(S.value||T.value)&&!!e.scrim&&r("div",G({class:["v-navigation-drawer__scrim",Le.backgroundColorClasses.value],style:[Vt.value,Le.backgroundColorStyles.value],onClick:()=>{h.value||(T.value=!1)}},E),null)]})])}),K.then(()=>({isStuck:Ie}))}}),kn={name:"SettingsDrawer",components:{SettingsCommonPanel:Qo,SettingsFooter:kt,VersionFooter:_t},props:{title:{type:String,required:!0},panel:{type:Object,required:!0},admin:{type:Boolean,default:!1}},computed:{...de(N,["isCodexViewable"]),...ao(le,["isSettingsDrawerOpen"]),...j(cn,{invisibleHack:e=>e.bookChange==="next"}),adminAndNotSmall(){return this.admin&&!this.$vuetify.display.smAndDown}},mounted(){this.isSettingsDrawerOpen=this.adminAndNotSmall}},wn={class:"settingsDrawerContainer"},yn={id:"topBlock"},Sn={class:"settingsHeader"},Pn={id:"footerGroup"};function Cn(e,t,o,a,n,s){const i=ee("SettingsCommonPanel"),l=kt,y=_t;return k(),C(_n,G(e.$attrs,{modelValue:e.isSettingsDrawerOpen,"onUpdate:modelValue":t[0]||(t[0]=p=>e.isSettingsDrawerOpen=p),"disable-resize-watcher":"","disable-route-watcher":"",location:"right",scrim:!s.adminAndNotSmall,temporary:!s.adminAndNotSmall,touchless:""}),{append:v(()=>[r(y)]),default:v(()=>[L("div",wn,[L("div",yn,[L("header",Sn,[L("h3",null,V(o.title),1)]),e.isCodexViewable?(k(),C(Be(o.panel),{key:0})):A("",!0),e.isCodexViewable?(k(),C(_e,{key:1})):A("",!0),r(i,{"admin-menu":!o.admin},null,8,["admin-menu"]),r(_e)]),L("div",Pn,[r(l)])])]),_:1},16,["modelValue","scrim","temporary"])}const Un=M(kn,[["render",Cn],["__scopeId","data-v-a38da0ea"]]),Xe=ot(nt(()=>ht(()=>import("./admin-drawer-panel-DffXGW1d.js").then(e=>e.dC),__vite__mapDeps([0,1])))),Tn={name:"SettingsDrawerButton",components:{AdminSettingsButtonProgress:Xe},data(){return{mdiMenu:ro,AdminSettingsButtonProgress:Xe}},computed:{...j(N,["isUserAdmin"])}};function Rn(e,t,o,a,n,s){return k(),C(Ze,G(e.$attrs,{icon:"",title:"Settings"}),{default:v(()=>[r(H,null,{default:v(()=>[D(V(n.mdiMenu),1)]),_:1}),e.isUserAdmin?(k(),C(Be(n.AdminSettingsButtonProgress),{key:0})):A("",!0)]),_:1},16)}const Hn=M(Tn,[["render",Rn]]),Vn=te({text:String,...ue(),...ce()},"VToolbarTitle"),Dn=oe()({name:"VToolbarTitle",props:Vn(),setup(e,t){let{slots:o}=t;return ne(()=>{const a=!!(o.default||o.text||e.text);return r(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var n;return[a&&r("div",{class:"v-toolbar-title__placeholder"},[o.text?o.text():e.text,(n=o.default)==null?void 0:n.call(o)])]}})}),{}}}),Bn=[null,"prominent","default","comfortable","compact"],xn=te({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>Bn.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...we(),...ue(),...ye(),...Se(),...ce({tag:"header"}),...Pe()},"VToolbar"),zn=oe()({name:"VToolbar",props:xn(),setup(e,t){var _;let{slots:o}=t;const{backgroundColorClasses:a,backgroundColorStyles:n}=ie(Q(e,"color")),{borderClasses:s}=Te(e),{elevationClasses:i}=Re(e),{roundedClasses:l}=Ve(e),{themeClasses:y}=Ce(e),{rtlClasses:p}=ut(),m=W(!!(e.extended||(_=o.extension)!=null&&_.call(o))),d=b(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),g=b(()=>m.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return ct({VBtn:{variant:"text"}}),ne(()=>{var E;const w=!!(e.title||o.title),T=!!(o.image||e.image),$=(E=o.extension)==null?void 0:E.call(o);return m.value=!!(e.extended||$),r(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},a.value,s.value,i.value,l.value,y.value,p.value,e.class],style:[n.value,e.style]},{default:()=>[T&&r("div",{key:"image",class:"v-toolbar__image"},[o.image?r(J,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},o.image):r(dt,{key:"image-img",cover:!0,src:e.image},null)]),r(J,{defaults:{VTabs:{height:X(d.value)}}},{default:()=>{var B,R,F;return[r("div",{class:"v-toolbar__content",style:{height:X(d.value)}},[o.prepend&&r("div",{class:"v-toolbar__prepend"},[(B=o.prepend)==null?void 0:B.call(o)]),w&&r(Dn,{key:"title",text:e.title},{text:o.title}),(R=o.default)==null?void 0:R.call(o),o.append&&r("div",{class:"v-toolbar__append"},[(F=o.append)==null?void 0:F.call(o)])])]}}),r(J,{defaults:{VTabs:{height:X(g.value)}}},{default:()=>[r(tt,null,{default:()=>[m.value&&r("div",{class:"v-toolbar__extension",style:{height:X(g.value)}},[$])]})]})]})}),{contentHeight:d,extensionHeight:g}}});export{Hn as S,Dn as V,Un as _,zn as a,rn as b,We as c,ze as d,_n as e,sn as f,ln as g,Mn as h,Fn as i,an as j,cn as u};
