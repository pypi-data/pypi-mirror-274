const __vite__fileDeps=["assets/pdf-doc-x5fJF5N8.js","assets/admin-drawer-panel-DffXGW1d.js","assets/admin-drawer-panel-Dv_IY0x2.css","assets/main-DB0zDxIA.js","assets/main-ED57DJUb.css","assets/VToolbar-DCXw9xBt.js","assets/index-DUjeNg4x.js","assets/confirm-footer-CIu2tkFD.js","assets/confirm-footer-BPuy6r_H.css","assets/change-password-dialog-Dr1CYQ46.js","assets/VSlideGroup-BdgkaRxE.js","assets/VSelectionControl-DvHEDoJy.js","assets/VSelectionControl-BFq--28I.css","assets/VSlideGroup-CTW-HJl4.css","assets/change-password-dialog-BRmvkNir.css","assets/VToolbar-D7BgLWdG.css","assets/pdf-doc-CMzaSV_K.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{u as c,c as U,d as Ve,S as Oe,V as Ee,a as xe,e as Ne,h as Ae,i as Fe,_ as re}from"./VToolbar-DCXw9xBt.js";import{_ as N,a as ne,b as ie,P as Ue,c as le,V as K}from"./metadata-dialog-BlvHIpPe.js";import{aA as w,N as P,O as f,_ as m,R as u,P as g,T as i,ae as h,ai as _,L as n,ah as v,aE as S,bm as ze,bi as Me,bh as B,aB as b,aN as We,ba as O,bn as ce,Q as y,af as D,bo as qe,bp as Ge,aG as r,ap as W,aF as G,bq as ue,aD as de,aC as E,M as R,ad as H,bf as He,br as Ke,bs as je,bt as Ye,bu as Xe,ak as x,bv as Ze,k as T,ao as q,bw as Qe,bx as Je,aj as j,b2 as et,by as tt,bz as ot,bA as at,bB as st,bC as rt,bD as nt,aK as it,aL as lt,aW as Y,m as X,bE as ct,bk as Z,bF as ut}from"./admin-drawer-panel-DffXGW1d.js";import{_ as dt,a as he,u as ht,C as pt}from"./main-DB0zDxIA.js";import{b as pe,V as ge}from"./VWindowItem-CCYriq5i.js";import{b as gt,V as mt}from"./VSelect-DfV5vhqb.js";import{V as $,a as z}from"./VRadioGroup-DGplihzh.js";import{V as M}from"./VCheckbox-D7WF5wMC.js";import{V as kt,a as _t,b as bt,c as ft}from"./VExpansionPanels-CDS9qp1D.js";import{V as Pt}from"./VMain-8vjSGbNt.js";import"./index-DUjeNg4x.js";import"./confirm-footer-CIu2tkFD.js";import"./change-password-dialog-Dr1CYQ46.js";import"./VSlideGroup-BdgkaRxE.js";import"./VSelectionControl-DvHEDoJy.js";import"./to-case-kUm8NPpW.js";import"./VCheckboxBtn-CzTNt4cV.js";const vt={name:"ReaderNavButton",components:{PaginationNavButton:N},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...w(c,["isVertical"]),...P(c,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}}}),title(){return"Page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...f(c,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function wt(e,t,a,d,l,o){const s=N;return u(),g(s,{key:e.isVertical,disabled:o.disabled,title:o.title,to:e.toRoute,onClick:o.onClick},{default:i(()=>[h(_(a.value),1)]),_:1},8,["disabled","title","to","onClick"])}const me=m(vt,[["render",wt]]),St={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:N},props:{direction:{type:String,required:!0}},computed:{...w(c,["isBTT"]),...P(c,{toRoute(e){var a;const t=(a=e==null?void 0:e.routes)==null?void 0:a.books[this.direction];return t?{params:{...t}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},disabled(){return!this.toRoute}},methods:{...f(c,["bookChangeIcon"])}};function Ct(e,t,a,d,l,o){const s=N;return u(),g(s,{icon:"",variant:"plain",disabled:o.disabled,title:o.title,to:e.toRoute},{default:i(()=>[n(v,null,{default:i(()=>[h(_(o.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const ke=m(St,[["render",Ct]]),L="prev",V="next",yt={name:"ReaderNavToolbar",components:{PaginationSlider:ne,ReaderNavButton:me,PaginationToolbar:ie,ReaderBookChangeNavButton:ke},computed:{...w(c,["activeSettings","isReadInReverse","isVertical"]),...P(c,{storePage:e=>e.page,key(e){var t,a;return`${(a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(c,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(V):e.shiftKey&&window.scrollY===0&&this.routeToDirection(L);break;case"j":case"ArrowRight":this.routeToDirection(V);break;case"k":case"ArrowLeft":this.routeToDirection(L);break;case",":this.routeToDirectionOne(L);break;case".":this.routeToDirectionOne(V);break;case"n":this.routeToBook(V);break;case"p":this.routeToBook(L);break}}}};function Rt(e,t,a,d,l,o){const s=ke,p=me,k=ne,I=ie;return e.maxPage?(u(),g(I,{key:0},{default:i(()=>[n(s,{direction:o.bookPrev},null,8,["direction"]),n(p,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(u(),g(k,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:o.step,"track-color":o.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=F=>o.onSliderUpdate(F))},null,8,["model-value","max","step","track-color","reverse"])),n(p,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),n(s,{direction:o.bookNext},null,8,["direction"])]),_:1})):S("",!0)}const _e=m(yt,[["render",Rt]]),Bt=.5,Tt={name:"ScaleForScroll",emits:["click"],data(){return{mdiMagnifyMinusOutline:ze}},computed:{...P(c,{scale:e=>e.clientSettings.scale}),showReset(){return this.scale!=U},style(){return{cursor:this.scale==U?"zoom-in":"all-scroll"}}},methods:{...f(c,["setSettingsClient"]),clearSelection(){window.getSelection&&window.getSelection().removeAllRanges()},onDoubleClick(){this.clearSelection();const e=this.scale+Bt;this.setSettingsClient({scale:e})},scaleReset(){this.setSettingsClient({scale:U})}}};function Dt(e,t,a,d,l,o){const s=Me("drag-scroller");return B((u(),b("div",{class:"scaleForScroll",style:ce(o.style),onDblclick:t[0]||(t[0]=(...p)=>o.onDoubleClick&&o.onDoubleClick(...p))},[We(e.$slots,"default",{},void 0,!0),o.showReset?(u(),g(v,{key:0,class:"resetIcon",onClick:O(o.scaleReset,["stop"])},{default:i(()=>[h(_(l.mdiMagnifyMinusOutline),1)]),_:1},8,["onClick"])):S("",!0)],36)),[[s,,void 0,{onlyX:!0}]])}const A=m(Tt,[["render",Dt],["__scopeId","data-v-b24267c0"]]),It={name:"LoadingPage",components:{Placeholder:Ue},props:{twoPages:{type:Boolean,required:!0}}};function $t(e,t,a,d,l,o){const s=y("Placeholder");return u(),b("div",{class:D(["pageLoading",{twoPages:a.twoPages}])},[n(s,{class:"pagePlaceholder"})],2)}const Lt=m(It,[["render",$t],["__scopeId","data-v-04027168"]]),Q="unauthorized",Vt={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===Q?"Protected page":"Failed to load page"},icon(){return this.type===Q?qe:Ge}}},Ot={class:"pageErrorContainer"},Et={class:"pageErrorText"};function xt(e,t,a,d,l,o){return u(),b("div",{class:D(["pageError",{twoPages:a.twoPages}])},[r("div",Ot,[r("div",Et,_(o.text),1),n(v,{class:"pageErrorIcon"},{default:i(()=>[h(_(o.icon),1)]),_:1})])],2)}const Nt=m(Vt,[["render",xt],["__scopeId","data-v-cea0843d"]]),At={name:"ImgPage",props:{book:{type:Object,required:!0},src:{type:String,required:!0}},emits:["load","error"],computed:{...P(c,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.scale==1)return e;const t=this.$el;if(!(t!=null&&t.naturalWidth))return e;const a=t.naturalWidth/2;return e.transformOrigin=`${a}px top`,e.transform=`scale(${this.scale})`,e},classes(){return this.fitToClass(this.book)}},methods:{...f(c,["fitToClass"])}},Ft=["src"];function Ut(e,t,a,d,l,o){return u(),b("img",W({class:[o.classes,"img"],draggable:"false",src:a.src,style:o.style},e.$attrs,{onError:t[0]||(t[0]=s=>e.$emit("error",s)),onLoad:t[1]||(t[1]=s=>e.$emit("load",s))}),null,16,Ft)}const J=m(At,[["render",Ut],["__scopeId","data-v-559e2ecc"]]),ee=G(ue(()=>dt(()=>import("./pdf-doc-x5fJF5N8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])))),zt=333,Mt={name:"BookPage",components:{ErrorPage:Nt,LoadingPage:Lt,PDFDoc:ee,ImgPage:J},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{...w(c,["isVertical"]),...P(c,{scale:e=>e.clientSettings.scale}),style(){var a;const e={};if(this.book.fileType==="PDF"||this.scale==1)return e;const t=(a=this.$refs.pageComponent)==null?void 0:a.$el;return t!=null&&t.naturalHeight&&(e.height=t.naturalHeight*this.scale+"px",e.width=t.naturalWidth*this.scale+"px"),e},src(){const e={pk:this.book.pk,page:this.page,mtime:this.book.mtime};return Ve(e)},component(){return this.book.fileType==="PDF"?ee:J},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},zt)},methods:{...f(c,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Wt=["id","data-page"];function qt(e,t,a,d,l,o){const s=y("ErrorPage"),p=y("LoadingPage");return u(),b("div",{id:`page${a.page}`,"data-page":a.page,class:"page",style:ce(o.style)},[l.error?(u(),g(s,{key:0,"two-pages":o.settings.twoPages,type:l.error},null,8,["two-pages","type"])):l.showProgress&&!l.loaded?(u(),g(p,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(u(),g(de(o.component),{key:2,ref:"pageComponent",book:a.book,page:1,src:o.src,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["book","src","onError","onLoad","onUnauthorized"]))],12,Wt)}const be=m(Mt,[["render",qt],["__scopeId","data-v-87996fa1"]]),Gt={name:"HorizontalPages",components:{BookPage:be,ScaleForScroll:A},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},emits:["click"],computed:{...w(c,["isCoverPage","isReadInReverse"]),showSecondPage(){return this.getSettings(this.book).twoPages&&this.page<this.book.maxPage&&!this.isCoverPage(this.book,this.page)},showPageOne(){return!this.isReadInReverse||this.showSecondPage},showPageTwo(){return this.isReadInReverse||this.showSecondPage},pageOne(){return this.isReadInReverse?this.page+1:this.page},pageTwo(){return this.isReadInReverse?this.page:this.page+1}},methods:{...f(c,["getSettings"])}};function Ht(e,t,a,d,l,o){const s=y("BookPage"),p=A;return u(),g(p,{class:"noWrap"},{default:i(()=>[o.showPageOne?(u(),g(s,{key:0,ref:"pageOne",book:a.book,page:o.pageOne,class:"horizontalPage"},null,8,["book","page"])):S("",!0),o.showPageTwo?(u(),g(s,{key:1,book:a.book,page:o.pageTwo,class:"horizontalPage"},null,8,["book","page"])):S("",!0)]),_:1})}const fe=m(Gt,[["render",Ht],["__scopeId","data-v-9a560964"]]),Kt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...w(c,["isVertical","isFirstPage","isLastPage"]),...P(c,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){let e="pageChange";return e+=this.isVertical?"Row":"Column",e},directionClass(){let e=this.direction;return this.isVertical&&(e+="Vertical"),e},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...f(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function jt(e,t,a,d,l,o){const s=y("router-link");return o.show?(u(),g(s,{key:0,to:o.route,"aria-label":o.label,class:D({[o.pageChangeClass]:!0,[o.directionClass]:!0}),onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},null,8,["to","aria-label","class"])):S("",!0)}const Pe=m(Kt,[["render",jt],["__scopeId","data-v-9ade7d96"]]),Yt=48,Xt=48,Zt={name:"PagerHorizontal",components:{HorizontalPages:fe,PageChangeLink:Pe},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...w(c,["isReadInReverse"]),...P(c,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),twoPages(){return this.getSettings(this.book).twoPages},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...f(c,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Yt,0),t=Math.min(this.activePage+Xt,this.book.maxPage),a=he.range(e,t+1);this.pages=a}}};function Qt(e,t,a,d,l,o){const s=Pe,p=fe;return u(),g(ge,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:e.isReadInReverse},{prev:i(()=>[n(s,{direction:"prev"})]),next:i(()=>[n(s,{direction:"next"})]),default:i(()=>[(u(!0),b(R,null,E(l.pages,k=>(u(),g(pe,{key:`c/${a.book.pk}/${k}`,class:"windowItem",disabled:"",eager:k>=e.storePage-1&&k<=e.storePage+2,"model-value":k,transition:!0},{default:i(()=>[n(p,{book:a.book,page:k},null,8,["book","page"])]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const te=m(Zt,[["render",Qt],["__scopeId","data-v-e04bbc00"]]);function ve(e,t){const{self:a=!1}=t.modifiers??{},d=t.value,l=typeof d=="object"&&d.options||{passive:!0},o=typeof d=="function"||"handleEvent"in d?d:d.handler,s=a?e:t.arg?document.querySelector(t.arg):window;s&&(s.addEventListener("scroll",o,l),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:l,target:a?void 0:s})}function we(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:d,target:l=e}=e._onScroll[t.instance.$.uid];l.removeEventListener("scroll",a,d),delete e._onScroll[t.instance.$.uid]}function Jt(e,t){t.value!==t.oldValue&&(we(e,t),ve(e,t))}const eo={mounted:ve,unmounted:we,updated:Jt},to=12,oe=250,oo={name:"PagerVertical",components:{BookPage:be,ScaleForScroll:A},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...P(c,{storePage:e=>e.page}),...H(c,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=(a=this.book)!=null&&a.maxPage?this.book.maxPage+1:0,t=he.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,to)}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},oe)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...f(c,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const d=+t[0].target.dataset.page;this.setActivePage(d,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},oe)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},ao=["data-page"];function so(e,t,a,d,l,o){const s=y("BookPage"),p=A;return u(),g(p,null,{default:i(()=>[B((u(),g(gt,{id:"verticalScroll",key:o.readInReverse,ref:"verticalScroll",items:o.items,height:l.innerHeight,width:l.innerWidth},{default:i(({item:k})=>[n(s,{book:a.book,page:k,class:"verticalPage"},null,8,["book","page"]),B(r("div",{class:"pageTracker","data-page":k},null,8,ao),[[He,{handler:o.onIntersect,options:{threshold:[.75]}},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[eo,o.onScroll,"#verticalScroll"]])]),_:1})}const ae=m(oo,[["render",so],["__scopeId","data-v-97638fc3"]]),se=G(ue(()=>"@/components/reader/pager/pager-full-pdf.vue")),ro={name:"PagerSelector",components:{PagerHorizontal:te,PagerPDF:se,PagerVertical:ae},props:{book:{type:Object,required:!0}},emits:["click"],head(){return this.prefetchBook(this.book)},computed:{...w(c,["isVertical","cacheBook"]),...P(c,{storePk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0}}),readFullPdf(){return this.book.fileType=="PDF"&&this.cacheBook},component(){return this.readFullPdf?se:this.isVertical?ae:te}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...f(c,["getSettings","setActivePage","prefetchBook"])}};function no(e,t,a,d,l,o){return u(),g(de(o.component),{book:a.book},null,8,["book"])}const Se=m(ro,[["render",no]]),io={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)},show(){return this.bookChangeShow(this.computedDirection)}},methods:{...f(c,["setBookChangeFlag","normalizeDirection","bookChangeLocation","bookChangeCursorClass","bookChangeShow"])}};function lo(e,t,a,d,l,o){return o.show?(u(),b("div",{key:0,class:D(["bookChangeColumn",{[o.positionClass]:!0,[o.cursorClass]:!0}]),onClick:t[0]||(t[0]=O(s=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):S("",!0)}const Ce=m(io,[["render",lo],["__scopeId","data-v-2b81f2ae"]]),co={name:"BooksWindow",components:{BookChangeActivator:Ce,Pager:Se},emits:["click"],computed:{...w(c,["isBTT"]),...P(c,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0},bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag(),this.loadBooks(this.$route.params)},methods:{...f(c,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function uo(e,t,a,d,l,o){const s=Ce,p=Se;return u(),g(ge,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:o.click},{prev:i(()=>[n(s,{direction:"prev"})]),next:i(()=>[n(s,{direction:"next"})]),default:i(()=>[(u(!0),b(R,null,E(e.books,k=>(u(),g(pe,{key:`c/${k.pk}`,class:"windowItem",disabled:"",eager:o.eager(k.pk),value:k.pk,transition:!0},{default:i(()=>[n(p,{book:k,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const ye=m(co,[["render",uo],["__scopeId","data-v-2a90783e"]]),ho={a:je,f:Ye,s:Xe},po={a:"Story Arc",f:"Folder",s:"Series"},go={name:"ReaderArcSelect",computed:{...P(c,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pk===t.pk)return t.name;return"Unknown"},arcKey:e=>`${e.arc.group}:${e.arc.pk}`,arcItems:e=>{const t=[];for(const a of e.arcs){const d={value:`${a.group}:${a.pk}`,title:a.name,group:a.group};t.push(d)}return t},arcPosition:function(e){const t=e.arc;return t&&t.index&&t.count?`${t.index}/${t.count}`:""}}),arc:{get(){return this.arcKey},set(e){const t=this.$route.params;if(!t)return;const[a,d]=e.split(":"),l={...t,arcGroup:a,arcPk:d};this.loadBooks(l)}}},methods:{...f(c,["loadBooks"]),arcIcon(e){return ho[e]},arcLabel(e){return po[e]},checkIcon(e){return e===this.arc?Ke:""}}},mo={key:2,id:"arcPosition"};function ko(e,t,a,d,l,o){return u(),b(R,null,[e.arcItems.length>1?(u(),g(mt,{key:0,modelValue:o.arc,"onUpdate:modelValue":t[0]||(t[0]=s=>o.arc=s),class:"arcSelect",density:"compact","hide-details":"auto",label:"Order",variant:"plain",items:e.arcItems},{item:i(({item:s,props:p})=>[n(x,W(p,{density:"compact",variant:"plain","prepend-icon":o.arcIcon(s.raw.group),subtitle:o.arcLabel(s.raw.group),"append-icon":o.checkIcon(p.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:i(({item:s,props:p})=>[n(x,W(p,{density:"compact",variant:"plain"}),{default:i(()=>[n(v,null,{default:i(()=>[h(_(o.arcIcon(s.raw.group)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items"])):(u(),g(v,{key:1,id:"onlyArc",title:e.arcName},{default:i(()=>[h(_(o.arcIcon(e.arcGroup)),1)]),_:1},8,["title"])),e.arcPosition?(u(),b("span",mo,_(e.arcPosition),1)):S("",!0)],64)}const Re=m(go,[["render",ko],["__scopeId","data-v-90090a3c"]]),_o={name:"ReaderTitleToolbar",components:{MetadataDialog:le,ReaderArcSelect:Re,SettingsDrawerButton:Oe},data(){return{mdiClose:Ze,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...w(c,["activeTitle"]),...P(c,{currentBook:e=>{var t;return((t=e.books)==null?void 0:t.current)||{}}}),...P(ht,{lastRoute:e=>e.page.routes.last}),...H(T,["isSettingsDrawerOpen"]),closeBookRoute:function(){var t;const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${(t=this.currentBook)==null?void 0:t.pk}`:e.params=window.CODEX.LAST_ROUTE||pt.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...f(T,["setTimestamp"]),...f(c,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyUpListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},bo={key:0};function fo(e,t,a,d,l,o){const s=Re,p=le,k=y("SettingsDrawerButton");return u(),g(xe,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:i(()=>[n(K,null,{default:i(()=>[n(q,{id:"closeBook",ref:"closeBook",to:o.closeBookRoute,size:"large",onClick:o.onCloseBook},{default:i(()=>[e.$vuetify.display.smAndDown?(u(),g(v,{key:1,title:"Close Book"},{default:i(()=>[h(_(l.mdiClose),1)]),_:1})):(u(),b("span",bo,"close book"))]),_:1},8,["to","onClick"])]),_:1}),n(Ee,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:i(()=>[h(_(e.activeTitle),1)]),_:1}),n(K,null,{default:i(()=>[n(s),n(q,{id:"tagButton",onClick:O(o.openMetadata,["stop"])},{default:i(()=>[n(p,{ref:"metadataDialog",group:"c",book:e.currentBook},null,8,["book"])]),_:1},8,["onClick"]),n(k,{id:"settingsButton",onClick:t[0]||(t[0]=O(I=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const Be=m(_o,[["render",fo],["__scopeId","data-v-5d12ffc0"]]),Po={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...w(c,["isBTT"]),...P(c,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...f(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function vo(e,t,a,d,l,o){const s=y("router-link");return o.show?(u(),g(Ne,{key:0,class:"bookChangeDrawer","disable-resize-watcher":"","disable-route-watcher":"",location:o.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:i(()=>[n(s,{class:D({navLink:!0,[o.cursorClass]:!0}),to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},{default:i(()=>[n(v,{class:"bookChangeIcon"},{default:i(()=>[h(_(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value"])):S("",!0)}const Te=m(Po,[["render",vo],["__scopeId","data-v-457facfc"]]),wo={name:"DownloadPanel",data(){return{mdiDownload:Qe,mdiFileImage:Je}},computed:{...w(c,["activeTitle","routeParams"]),...P(c,{currentBook:e=>{var t;return(t=e.books)==null?void 0:t.current},storePage:e=>e.page}),downloadURL(){return Ae(this.currentBook)},filename(){var e;return(e=this.currentBook)==null?void 0:e.filename},pageSrc(){const{pk:e,mtime:t}=this.currentBook;return Fe({pk:e,page:this.storePage,mtime:t})},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...f(T,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},So={id:"downloadPanel"};function Co(e,t,a,d,l,o){return u(),b("div",So,[n(x,{onClick:o.downloadPage},{default:i(()=>[n(j,null,{default:i(()=>[n(v,null,{default:i(()=>[h(_(l.mdiFileImage),1)]),_:1}),h("Download Page "+_(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),n(x,{onClick:o.downloadBook},{default:i(()=>[n(j,null,{default:i(()=>[n(v,null,{default:i(()=>[h(_(l.mdiDownload),1)]),_:1}),h("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const De=m(wo,[["render",Co],["__scopeId","data-v-079b7d8d"]]),Ie=["fitTo","readingDirection","twoPages"];Object.freeze(Ie);const yo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1,mdiOpenInNew:et}},computed:{...w(c,["isVertical","isPDF","cacheBook"]),...P(c,{choices:e=>e.choices,selectedSettings(e){var t,a;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(a=e.books)==null?void 0:a.current.settings},isClearSettingsButtonDisabled(e){var t,a;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const d of Ie){const l=(a=e.books)==null?void 0:a.current.settings[d];if(!e.choices.nullValues.has(l))return!1}return!0},bookInBrowserURL(e){var t;return tt((t=e.books)==null?void 0:t.current)}}),...H(c,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")},disableTwoPages(){return this.isVertical||this.isPDF&&this.cacheBook},disableCacheBook(){return this.isVertical&&this.isPDF}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...f(c,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal","setSettingsClient"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const a of this.choices[e])a.value&&t.push(a);return Object.freeze(t),t},_keyUpListener(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},Ro={id:"readerSettings"},Bo=["href"];function To(e,t,a,d,l,o){return u(),b("div",Ro,[n(z,{modelValue:l.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=s=>l.isGlobalScope=s),density:"compact",label:"Scope","hide-details":"auto"},{default:i(()=>[n($,{label:"Only this comic",value:!1}),n($,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(z,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=s=>o.settingsDialogChanged({fitTo:s}))},{default:i(()=>[(u(!0),b(R,null,E(o.fitToChoices,s=>(u(),g($,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(M,{disabled:o.disableTwoPages,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=s=>o.settingsDialogChanged({twoPages:s}))},null,8,["disabled","model-value","indeterminate"]),n(z,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=s=>o.settingsDialogChanged({readingDirection:s}))},{default:i(()=>[(u(!0),b(R,null,E(o.readingDirectionChoices,s=>(u(),g($,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(M,{"model-value":e.cacheBook,class:"cacheBook",density:"compact",disabled:o.disableCacheBook,label:"Cache Entire Book","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=s=>e.setSettingsClient({cacheBook:s}))},null,8,["model-value","disabled"]),e.isPDF?(u(),b("a",{key:0,id:"readPDFInBrowser",href:e.bookInBrowserURL,target:"_blank"},[n(v,null,{default:i(()=>[h(_(l.mdiOpenInNew),1)]),_:1}),h("Read PDF in Browser ")],8,Bo)):S("",!0),l.isGlobalScope?(u(),g(M,{key:1,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL Comics as LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=s=>o.settingsDialogChanged({readRtlInReverse:s}))},null,8,["model-value"])):S("",!0),l.isGlobalScope?S("",!0):(u(),g(q,{key:2,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:e.clearSettingsLocal},{default:i(()=>[h(" Clear Comic Settings ")]),_:1},8,["disabled","onClick"]))])}const $e=m(yo,[["render",To],["__scopeId","data-v-953d00f1"]]),Do={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:ot,mdiMenuRight:at,mdiKeyboardOutline:st,mdiKeyboardSpace:rt,mdiAppleKeyboardShift:nt}},computed:{...w(T,["isMobile"])}},C=e=>(it("data-v-a8b4ac47"),e=e(),lt(),e),Io=C(()=>r("h4",null,"Navigation",-1)),$o={class:"highlight-table"},Lo=C(()=>r("td",null,"Previous page",-1)),Vo=C(()=>r("td",null,"Next page",-1)),Oo=C(()=>r("tr",null,[r("td",null,","),r("td",null,[h("Next "),r("em",null,"only"),h(" one page in two page mode.")])],-1)),Eo=C(()=>r("tr",null,[r("td",null,"."),r("td",null,[h("Previous "),r("em",null,"only"),h(" one page in two page mode.")])],-1)),xo=C(()=>r("tr",null,[r("td",null,"p"),r("td",null,"Previous Book")],-1)),No=C(()=>r("tr",null,[r("td",null,"n"),r("td",null,"Next Book")],-1)),Ao=C(()=>r("tr",null,[r("td",null,"esc"),r("td",null,"Close book")],-1)),Fo=C(()=>r("h4",null,"Fit Page To",-1)),Uo=C(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"s"),r("td",null,"screen")]),r("tr",null,[r("td",null,"h"),r("td",null,"screen height")]),r("tr",null,[r("td",null,"w"),r("td",null,"screen width")]),r("tr",null,[r("td",null,"o"),r("td",null,"Show page at original size")]),r("tr",null,[r("td",null,"2"),r("td",null,"Toggle two page view")]),r("tr",null,[r("td",null,"r"),r("td",null,"Read Right to Left")]),r("tr",null,[r("td",null,"l"),r("td",null,"Read Left to Right")]),r("tr",null,[r("td",null,"t"),r("td",null,"Read Top to Bottom")]),r("tr",null,[r("td",null,"b"),r("td",null,"Read in Bottom to Top")])])],-1)),zo=C(()=>r("h4",null,"Other",-1)),Mo=C(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"m"),r("td",null,"Show comic's metadata")]),r("tr",null,[r("td",null,"double click"),r("td",null,"Zoom page")])])],-1));function Wo(e,t,a,d,l,o){return e.isMobile?S("",!0):(u(),g(ft,{key:0},{default:i(()=>[n(kt,{id:"readerKeyboardShortcuts"},{default:i(()=>[n(_t,{id:"shortcutsTitle"},{default:i(()=>[n(v,{id:"keyboardIcon"},{default:i(()=>[h(_(l.mdiKeyboardOutline),1)]),_:1}),h("Keyboard Shortcuts ")]),_:1}),n(bt,null,{default:i(()=>[Io,r("table",$o,[r("tbody",null,[r("tr",null,[r("td",null,[n(v,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiMenuLeft),1)]),_:1}),h(", j, "),r("div",null,[n(v,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiAppleKeyboardShift),1)]),_:1}),n(v,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiKeyboardSpace),1)]),_:1})])]),Lo]),r("tr",null,[r("td",null,[n(v,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiMenuRight),1)]),_:1}),h(", k, "),n(v,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiKeyboardSpace),1)]),_:1})]),Vo]),Oo,Eo,xo,No,Ao])]),Fo,Uo,zo,Mo]),_:1})]),_:1})]),_:1}))}const qo=m(Do,[["render",Wo],["__scopeId","data-v-a8b4ac47"]]),Go={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:De,ReaderKeyboardShortcutsPanel:qo,ReaderSettingsPanel:$e}};function Ho(e,t,a,d,l,o){const s=$e,p=y("ReaderKeyboardShortcutsPanel"),k=De;return u(),b(R,null,[n(s),n(Y),n(p),n(Y),n(k)],64)}const Ko=m(Go,[["render",Ho]]),jo={name:"MainReader",components:{BookChangeDrawer:Te,BooksWindow:ye,ReaderNavToolbar:_e,ReaderTitleToolbar:Be,SettingsDrawer:re},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:G(Ko)}},computed:{...w(X,["isCodexViewable"]),...P(X,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){T().isSettingsDrawerOpen=!1},beforeMount(){c().$reset,this.loadReaderSettings()},methods:{...f(c,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},Yo={key:0,id:"readerContainer"},Xo={key:1,id:"announcement"};function Zo(e,t,a,d,l,o){const s=Te,p=Be,k=ye,I=_e,F=y("router-link"),Le=re;return u(),b(R,null,[n(Pt,{id:"readerWrapper"},{default:i(()=>[n(s,{direction:"prev"}),e.isCodexViewable?(u(),b("div",Yo,[n(ct,null,{default:i(()=>[B(n(p,null,null,512),[[Z,l.showToolbars]])]),_:1}),n(k,{onClick:o.toggleToolbars},null,8,["onClick"]),n(ut,null,{default:i(()=>[B(n(I,null,null,512),[[Z,l.showToolbars]])]),_:1})])):(u(),b("div",Xo,[r("h1",null,[n(F,{to:{name:"home"}},{default:i(()=>[h(" Log in ")]),_:1}),h(" to read comics ")])]))]),_:1}),n(s,{direction:"next"}),n(Le,{title:"Reader Settings",panel:l.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const ma=m(jo,[["render",Zo],["__scopeId","data-v-fd949081"]]);export{ma as default};
