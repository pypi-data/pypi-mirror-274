Metadata-Version: 2.3
Name: pyunifiprotect
Version: 6.0.1
Summary: Unofficial UniFi Protect Python API and CLI
Project-URL: Source Code, https://github.com/AngellusMortis/pyunifiprotect/
Project-URL: Documentation, https://angellusmortis.github.io/pyunifiprotect/latest/
Project-URL: Bug Reports, https://github.com/AngellusMortis/pyunifiprotect/issues/
Project-URL: Changelog, https://github.com/AngellusMortis/pyunifiprotect/releases/
Author-email: Bjarne Riis <bjarne@briis.com>, Christopher Bailey <cbailey@mort.is>
Maintainer-email: Christopher Bailey <cbailey@mort.is>, "J. Nick Koston" <nick@koston.org>
License: Business Source License
        
        Copyright (c) 2024 Christopher Bailey
        
        Change Date: 6 months from release
        Change License: MIT
        
        The Licensor hereby grants you the right to copy, modify, create derivative
        works, redistribute, and make non-production use of the Licensed Work. The
        Licensor may make an Additional Use Grant, above, permitting limited
        production use.
        
        Effective on the Change Date, or six months after the first publicly
        available distribution of a specific version of the Licensed Work under this
        License, whichever comes first, the Licensor hereby grants you rights under
        the terms of the Change License, and the rights granted in the paragraph above terminate.
        
        If your use of the Licensed Work does not comply with the requirements
        currently in effect as described in this License, you must purchase a commercial
        license from the Licensor, its affiliated entities, or authorized resellers, or
        you must refrain from using the Licensed Work.
        
        All copies of the original and modified Licensed Work, and derivative works of
        the Licensed Work, are subject to this License. This License applies separately
        for each version of the Licensed Work and the Change Date may vary for each
        version of the Licensed Work released by Licensor.
        
        You must conspicuously display this License on each original or modified copy of
        the Licensed Work. If you receive the Licensed Work in original or modified form
        from a third party, the terms and conditions set forth in this License apply to
        your use of that work.
        
        Any use of the Licensed Work in violation of this License will automatically
        terminate your rights under this License for the current and all other versions
        of the Licensed Work.
        
        This License does not grant you any right in any trademark or logo of Licensor or
        its affiliates (provided that you may use a trademark or logo of Licensor as
        expressly required by this License).
        
        TO THE EXTENT PERMITTED BY APPLICABLE LAW, THE LICENSED WORK IS PROVIDED ON AN
        "AS IS" BASIS. LICENSOR HEREBY DISCLAIMS ALL WARRANTIES AND CONDITIONS, EXPRESS OR
        IMPLIED, INCLUDING (WITHOUT LIMITATION) WARRANTIES OF MERCHANTABILITY, FITNESS FOR
        A PARTICULAR PURPOSE, NON-INFRINGEMENT, AND TITLE.
        
        
        Additional Use Grants
        
        For all use cases, this software is considered licensed as the Change License
        and may be used under those terms. There are only two exceptions that are not
        granted usage:
        
        * Ubiquiti may not use the Licensed Work for any "professional" use, including,
          but not limited to development, tooling or documentation
        * The Licensed Work may not be forked and used for the purpose of making any
          kind of add-on, integration or component for Home Assistant. Third party or
          otherwise. The only version of the Licensed Work that may be used in Home
          Assistant (before the Change Date) is original one.
License-File: LICENSE
License-File: LICENSE.CHANGE
Keywords: Home Assistant,Python,Surveilance,UniFi,UniFi Protect,UniFiProtect
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Build Tools
Requires-Python: >=3.9
Requires-Dist: aiofiles
Requires-Dist: aiohttp
Requires-Dist: aioshutil
Requires-Dist: async-timeout; python_version < '3.11'
Requires-Dist: dateparser
Requires-Dist: orjson
Requires-Dist: packaging
Requires-Dist: pillow
Requires-Dist: platformdirs
Requires-Dist: pydantic!=1.9.1
Requires-Dist: pyjwt
Requires-Dist: typer[all]>0.6
Requires-Dist: yarl>=1.9
Provides-Extra: backup
Requires-Dist: aiosqlite; extra == 'backup'
Requires-Dist: asyncify; extra == 'backup'
Requires-Dist: av; extra == 'backup'
Requires-Dist: sqlalchemy[asyncio]; extra == 'backup'
Provides-Extra: dev
Requires-Dist: base36; extra == 'dev'
Requires-Dist: black; extra == 'dev'
Requires-Dist: build; extra == 'dev'
Requires-Dist: coverage[toml]; extra == 'dev'
Requires-Dist: ipython<8.19; extra == 'dev'
Requires-Dist: isort; extra == 'dev'
Requires-Dist: mike; extra == 'dev'
Requires-Dist: mkdocs-git-revision-date-localized-plugin; extra == 'dev'
Requires-Dist: mkdocs-include-markdown-plugin; extra == 'dev'
Requires-Dist: mkdocs-material; extra == 'dev'
Requires-Dist: mkdocstrings[python]; extra == 'dev'
Requires-Dist: mypy; extra == 'dev'
Requires-Dist: pydocstyle; extra == 'dev'
Requires-Dist: pytest; extra == 'dev'
Requires-Dist: pytest-asyncio; extra == 'dev'
Requires-Dist: pytest-benchmark; extra == 'dev'
Requires-Dist: pytest-cov; extra == 'dev'
Requires-Dist: pytest-sugar; extra == 'dev'
Requires-Dist: pytest-timeout>=1.2.1; extra == 'dev'
Requires-Dist: pytest-xdist[psutil]; extra == 'dev'
Requires-Dist: ruff; extra == 'dev'
Requires-Dist: sqlalchemy[asyncio,mypy]; extra == 'dev'
Requires-Dist: termcolor; extra == 'dev'
Requires-Dist: types-aiofiles; extra == 'dev'
Requires-Dist: types-dateparser; extra == 'dev'
Requires-Dist: types-pillow; extra == 'dev'
Requires-Dist: types-pyjwt; extra == 'dev'
Requires-Dist: types-termcolor; extra == 'dev'
Requires-Dist: tzdata; extra == 'dev'
Provides-Extra: full
Requires-Dist: aiosqlite; extra == 'full'
Requires-Dist: asyncify; extra == 'full'
Requires-Dist: av; extra == 'full'
Requires-Dist: ipython<8.19; extra == 'full'
Requires-Dist: python-dotenv; extra == 'full'
Requires-Dist: sqlalchemy[asyncio]; extra == 'full'
Requires-Dist: termcolor; extra == 'full'
Provides-Extra: shell
Requires-Dist: ipython<8.19; extra == 'shell'
Requires-Dist: python-dotenv; extra == 'shell'
Requires-Dist: termcolor; extra == 'shell'
Provides-Extra: tz
Requires-Dist: tzdata; extra == 'tz'
Description-Content-Type: text/markdown

# Unofficial UniFi Protect Python API and CLI

[![Latest PyPI version](https://img.shields.io/pypi/v/pyunifiprotect)](https://pypi.org/project/pyunifiprotect/) [![Supported Python](https://img.shields.io/pypi/pyversions/pyunifiprotect)](https://pypi.org/project/pyunifiprotect/) [![Code Style](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black) [![CI](https://github.com/AngellusMortis/pyunifiprotect/actions/workflows/ci.yaml/badge.svg)](https://github.com/AngellusMortis/pyunifiprotect/actions/workflows/ci.yaml) [![Documentation](https://github.com/AngellusMortis/pyunifiprotect/actions/workflows/pages/pages-build-deployment/badge.svg)](https://angellusmortis.github.io/pyunifiprotect/)

`pyunifiprotect` is an unofficial API for UniFi Protect. There is no affiliation with Ubiquiti.

This module communicates with UniFi Protect surveillance software installed on a UniFi OS Console such as a Ubiquiti CloudKey+ or UniFi Dream Machine Pro.

The API is not documented by Ubiquiti, so there might be misses and/or frequent changes in this module, as Ubiquiti evolves the software.

The module is primarily written for the purpose of being used in Home Assistant core [integration for UniFi Protect](https://www.home-assistant.io/integrations/unifiprotect) but might be used for other purposes also.

## Smart Detections now Require Remote Access to enable

Smart Detections (person, vehicle, animal, face), a feature that previously could be used with local only console, [now requires you to enable remote access to enable](https://community.ui.com/questions/Cannot-enable-Smart-Detections/e3d50641-5c00-4607-9723-453cda557e35#answer/1d146426-89aa-4022-a0ae-fd5000846028).

Enabling Remote Access may grant other users access to your console [due to the fact Ubiquiti can reconfigure access controls at any time](https://community.ui.com/questions/Bug-Fix-Cloud-Access-Misconfiguration/fe8d4479-e187-4471-bf95-b2799183ceb7).

If you are not okay with the feature being locked behind Remote Access access, [let Ubiquiti know](https://community.ui.com/questions/Cannot-enable-Smart-Detections/e3d50641-5c00-4607-9723-453cda557e35).

## Documentation

[Full documentation for the project](https://angellusmortis.github.io/pyunifiprotect/).

## Requirements

If you want to install `pyunifiprotect` natively, the below are the requirements:

* [UniFi Protect](https://ui.com/camera-security) version 1.20+
    * Latest version of library is generally only tested against the two latest minor version. This is either two latest stable versions (such as 1.21.x and 2.0.x) or the latest EA version and stable version (such as 2.2.x EA and 2.1.x).
* [Python](https://www.python.org/) 3.9+
* POSIX compatible system
    * Library is only test on Linux, specifically the latest Debian version available for the official Python Docker images, but there is no reason the library should not work on any Linux distro or MacOS.
* [ffmpeg](https://ffmpeg.org/)
    * ffmpeg is primarily only for streaming audio to Protect cameras, this can be considered a soft requirement

Alternatively you can use the [provided Docker container](#using-docker-container), in which case the only requirement is [Docker](https://docs.docker.com/desktop/) or another OCI compatible orchestrator (such as Kubernetes or podman).

Windows is **not supported**. If you need to use `pyunifiprotect` on Windows, use Docker Desktop and the provided docker container or [WSL](https://docs.microsoft.com/en-us/windows/wsl/install).

## Install

### From PyPi

`pyunifiprotect` is available on PyPi:

```bash
pip install pyunifiprotect
```

### From Github

```bash
pip install git+https://github.com/AngellusMortis/pyunifiprotect.git#egg=pyunifiprotect
```

### Using Docker Container

A Docker container is also provided so you do not need to install/manage Python as well. You can add the following to your `.bashrc` or similar.

```bash
function unifi-protect() {
    docker run --rm -it \
      -e UFP_USERNAME=YOUR_USERNAME_HERE \
      -e UFP_PASSWORD=YOUR_PASSWORD_HERE \
      -e UFP_ADDRESS=YOUR_IP_ADDRESS \
      -e UFP_PORT=443 \
      -e UFP_SSL_VERIFY=True \
      -e TZ=America/New_York \
      -v $PWD:/data ghcr.io/angellusmortis/pyunifiprotect:latest "$@"
}
```

Some notes about the Docker version since it is running inside of a container:

* You can update at any time using the command `docker pull ghcr.io/AngellusMortis/pyunifiprotect:latest`
* Your local current working directory (`$PWD`) will automatically be mounted to `/data` inside of the container. For commands that output files, this is the _only_ path you can write to and have the file persist.
* The container supports `linux/amd64` and `linux/arm64` natively. This means it will also work well on MacOS or Windows using Docker Desktop.
* For versions of `pyunifiprotect` before v4.1.5, you need to use the `ghcr.io/briis/pyunifiprotect` image instead.
* `TZ` should be the [Olson timezone name](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) for the timezone your UniFi Protect instance is in.
* For more details on `TZ` and other environment variables, check the [command line docs](https://angellusmortis.github.io/pyunifiprotect/latest/cli/)

## Quickstart

### CLI

!!! warning "About Ubiquiti SSO accounts"
    Ubiquiti SSO accounts are not supported and actively discouraged from being used. There is no option to use MFA. You are expected to use local access user. `pyunifiprotect` is not designed to allow you to use your owner account to access the your console or to be used over the public Internet as both pose a security risk.

```bash
export UFP_USERNAME=YOUR_USERNAME_HERE
export UFP_PASSWORD=YOUR_PASSWORD_HERE
export UFP_ADDRESS=YOUR_IP_ADDRESS
export UFP_PORT=443
# change to false if you do not have a valid HTTPS Certificate for your instance
export UFP_SSL_VERIFY=True

unifi-protect --help
unifi-protect nvr
```

### Python

UniFi Protect itself is 100% async, so as such this library is primarily designed to be used in an async context.

The main interface for the library is the `pyunifiprotect.ProtectApiClient`:

```python
from pyunifiprotect import ProtectApiClient

protect = ProtectApiClient(host, port, username, password, verify_ssl=True)

await protect.update() # this will initialize the protect .bootstrap and open a Websocket connection for updates

# get names of your cameras
for camera in protect.bootstrap.cameras.values():
    print(camera.name)

# subscribe to Websocket for updates to UFP
def callback(msg: WSSubscriptionMessage):
    # do stuff

unsub = protect.subscribe_websocket(callback)

# remove subscription
unsub()

```

## TODO / Planned / Not Implemented

Generally any feature missing from the library is planned to be done eventually / nice to have with the following exceptions

### UniFi OS Features

Anything that is strictly a UniFi OS feature. If it ever done, it will be in a separate library that interacts with this one. Examples include:

* Managing RAID and disks
* Creating and managing users

### Remote Access / Ubiquiti Cloud Features

Anything that requires a Ubiquiti Account or "Remote Access" to be enabled is never going to be implemented by me
([@AngellusMortis](https://github.com/AngellusMortis/)) as I support UniFi Protect as a 100% local only product. PRs are welcome to implement any related
features though.

Examples include:

* Stream sharing
* Smart Detections, including person, vehicle, animals license plate and faces

## Credits

* Bjarne Riis ([@briis](https://github.com/briis/)) for the original pyunifiprotect package
