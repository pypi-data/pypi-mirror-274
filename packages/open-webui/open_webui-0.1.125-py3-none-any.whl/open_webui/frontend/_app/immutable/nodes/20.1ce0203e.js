import{s as ie,a as q,e as $,M as ne,d as p,c as A,i as F,w as U,P as me,p as R,f as v,l as ee,g as y,h as S,m as se,j as b,r as _,n as te,Y as C,t as G}from"../chunks/scheduler.bcadb9af.js";import{S as ue,i as de,a as H,t as K,c as fe,f as J,b as ce,d as ge,m as _e,e as pe,g as he}from"../chunks/index.bbb895f1.js";import{g as ve}from"../chunks/globals.7f7f1b26.js";import{g as oe}from"../chunks/navigation.8ebd9be9.js";import{p as ye}from"../chunks/stores.bf65820e.js";import{d as ae}from"../chunks/dayjs.min.e4172223.js";import{g as le,l as be,W as Ie,e as we}from"../chunks/index.4db2cdd2.js";import{y as Me}from"../chunks/index.af7f8f90.js";import{q as Ee}from"../chunks/index.6f34baee.js";import{M as Se}from"../chunks/Messages.5c5807c3.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.a4036649.js";import"../chunks/create.324e2fd2.js";/* empty css                                                       */import"../chunks/FileSaver.min.898eb36f.js";import{e as De}from"../chunks/index.973e1bb8.js";import"../chunks/index.c4ca6160.js";const{document:z}=ve;function re(s){let f,t,r,n,o,a,c,I,D=ae(s[5].chat.timestamp).format(s[11].t("MMMM DD, YYYY"))+"",w,Y,B,M,h,E,k,i,g,P,j,V;function O(l){s[16](l)}function e(l){s[17](l)}function u(l){s[18](l)}let T={user:s[6],chatId:s[9],readOnly:!0,selectedModels:s[0],selectedModelfiles:s[4],processing:Ve,bottomPadding:s[13].length>0,sendPrompt:Ye,continueGeneration:Be,regenerateResponse:Ne};return s[1]!==void 0&&(T.history=s[1]),s[8]!==void 0&&(T.messages=s[8]),s[3]!==void 0&&(T.autoScroll=s[3]),i=new Se({props:T}),R.push(()=>J(i,"history",O)),R.push(()=>J(i,"messages",e)),R.push(()=>J(i,"autoScroll",u)),{c(){f=v("div"),t=v("div"),r=v("div"),n=v("div"),o=v("div"),a=ee(s[7]),c=q(),I=v("div"),w=ee(D),Y=q(),B=v("hr"),M=q(),h=v("div"),E=v("div"),k=v("div"),ce(i.$$.fragment),this.h()},l(l){f=y(l,"DIV",{class:!0});var m=S(f);t=y(m,"DIV",{class:!0});var d=S(t);r=y(d,"DIV",{class:!0});var N=S(r);n=y(N,"DIV",{});var W=S(n);o=y(W,"DIV",{class:!0});var L=S(o);a=se(L,s[7]),L.forEach(p),c=A(W),I=y(W,"DIV",{class:!0});var Q=S(I);w=se(Q,D),Q.forEach(p),W.forEach(p),Y=A(N),B=y(N,"HR",{class:!0}),N.forEach(p),M=A(d),h=y(d,"DIV",{class:!0,id:!0});var X=S(h);E=y(X,"DIV",{class:!0});var Z=S(E);k=y(Z,"DIV",{class:!0});var x=S(k);ge(i.$$.fragment,x),x.forEach(p),Z.forEach(p),X.forEach(p),d.forEach(p),m.forEach(p),this.h()},h(){b(o,"class","text-3xl font-semibold line-clamp-1"),b(I,"class","mt-1 text-gray-400"),b(B,"class","dark:border-gray-800 mt-6 mb-2"),b(r,"class","px-3 w-full max-w-5xl mx-auto"),b(k,"class","py-2"),b(E,"class","h-full w-full flex flex-col py-4"),b(h,"class","flex flex-col w-full flex-auto overflow-auto h-0"),b(h,"id","messages-container"),b(t,"class","flex flex-col flex-auto justify-center py-8"),b(f,"class","min-h-screen max-h-screen w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900")},m(l,m){F(l,f,m),_(f,t),_(t,r),_(r,n),_(n,o),_(o,a),_(n,c),_(n,I),_(I,w),_(r,Y),_(r,B),_(t,M),_(t,h),_(h,E),_(E,k),_e(i,k,null),V=!0},p(l,m){(!V||m&128)&&te(a,l[7]),(!V||m&2080)&&D!==(D=ae(l[5].chat.timestamp).format(l[11].t("MMMM DD, YYYY"))+"")&&te(w,D);const d={};m&64&&(d.user=l[6]),m&512&&(d.chatId=l[9]),m&1&&(d.selectedModels=l[0]),m&16&&(d.selectedModelfiles=l[4]),!g&&m&2&&(g=!0,d.history=l[1],C(()=>g=!1)),!P&&m&256&&(P=!0,d.messages=l[8],C(()=>P=!1)),!j&&m&8&&(j=!0,d.autoScroll=l[3],C(()=>j=!1)),i.$set(d)},i(l){V||(H(i.$$.fragment,l),V=!0)},o(l){K(i.$$.fragment,l),V=!1},d(l){l&&p(f),pe(i)}}}function ke(s){let f,t,r,n;z.title=f=`
		`+(s[7]?`${s[7].length>30?`${s[7].slice(0,30)}...`:s[7]} | ${s[10]}`:`${s[10]}`)+`
	`;let o=s[2]&&re(s);return{c(){t=q(),o&&o.c(),r=$()},l(a){ne("svelte-1123lr8",z.head).forEach(p),t=A(a),o&&o.l(a),r=$()},m(a,c){F(a,t,c),o&&o.m(a,c),F(a,r,c),n=!0},p(a,[c]){(!n||c&1152)&&f!==(f=`
		`+(a[7]?`${a[7].length>30?`${a[7].slice(0,30)}...`:a[7]} | ${a[10]}`:`${a[10]}`)+`
	`)&&(z.title=f),a[2]?o?(o.p(a,c),c&4&&H(o,1)):(o=re(a),o.c(),H(o,1),o.m(r.parentNode,r)):o&&(he(),K(o,1,1,()=>{o=null}),fe())},i(a){n||(H(o),n=!0)},o(a){K(o),n=!1},d(a){a&&(p(t),p(r)),o&&o.d(a)}}}let Ve="";const Ye=()=>{},Be=()=>{},Ne=()=>{};function Pe(s,f,t){let r,n,o,a,c;U(s,le,e=>t(9,r=e)),U(s,ye,e=>t(14,n=e)),U(s,be,e=>t(15,o=e)),U(s,Ie,e=>t(10,a=e));const I=me("i18n");U(s,I,e=>t(11,c=e));let D=!1,w=!0,Y=[""],B={},M=null,h=null,E="",k=[],i=[],g={messages:{},currentId:null};const P=async()=>{if(await le.set(n.params.id),t(5,M=await Ee(localStorage.token,r).catch(async e=>(await oe("/"),null))),M){t(6,h=await De(localStorage.token,M.user_id).catch(u=>(console.error(u),null)));const e=M.chat;if(e){console.log(e),t(0,Y=((e==null?void 0:e.models)??void 0)!==void 0?e.models:[e.models??""]),t(1,g=((e==null?void 0:e.history)??void 0)!==void 0?e.history:Me(e.messages)),t(7,E=e.title);let u=JSON.parse(localStorage.getItem("settings")??"{}");return await we.set({...u,system:e.system??u.system,options:e.options??u.options}),t(3,w=!0),await G(),i.length>0&&t(1,g.messages[i.at(-1).id].done=!0,g),await G(),!0}else return null}};function j(e){g=e,t(1,g)}function V(e){i=e,t(8,i),t(1,g)}function O(e){w=e,t(3,w)}return s.$$.update=()=>{if(s.$$.dirty&32769&&t(4,B=Y.reduce((e,u,T,l)=>{var d;const m=((d=o.filter(N=>N.tagName===u))==null?void 0:d.at(0))??void 0;return{...e,...m&&{[u]:m}}},{})),s.$$.dirty&2)if(g.currentId!==null){let e=[],u=g.messages[g.currentId];for(;u!==null;)e.unshift({...u}),u=u.parentId!==null?g.messages[u.parentId]:null;t(8,i=e)}else t(8,i=[]);s.$$.dirty&16384&&n.params.id&&(async()=>{if(await P()){await G(),t(2,D=!0),window.setTimeout(()=>scrollToBottom(),0);const e=document.getElementById("chat-textarea");e==null||e.focus()}else await oe("/")})()},[Y,g,D,w,B,M,h,E,i,r,a,c,I,k,n,o,j,V,O]}class Qe extends ue{constructor(f){super(),de(this,f,Pe,ke,ie,{})}}export{Qe as component};
