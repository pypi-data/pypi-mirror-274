import{s as Yt,E as ee,F as le,G as ne,H as se,w as st,e as Ut,i as N,d as m,I as Ie,x as $t,y as Tl,p as it,f as M,g as C,h as E,L as Gt,Z as ge,u as X,v as oe,T as Ae,C as zt,P as ie,a as Q,l as at,R as Qt,c as K,m as ct,j as d,r as b,n as Et,K as Ee,t as vt,X as Vl,z as pt,A as _t,Q as Le,O as Fl,Y as Lt,o as Bl,S as me,B as ql,M as Wl}from"./scheduler.bcadb9af.js";import{S as Jt,i as Zt,a as q,t as G,g as qt,c as Wt,h as Al,j as Ol,k as Ne,f as Nt,b as dt,d as mt,m as ht,e as gt}from"./index.bbb895f1.js";import{g as Gl}from"./globals.7f7f1b26.js";import{a as ft}from"./Toaster.svelte_svelte_type_style_lang.a4036649.js";import{g as Ce}from"./navigation.8ebd9be9.js";import{p as Yl}from"./stores.bf65820e.js";import{p as Jl,n as Zl,d as Oe,e as de,h as De,l as Pl,m as Ll,a as Me,S as Ue,o as He,u as Nl,W as Ul,g as fe,i as Xl,c as Ql,f as ke,L as Re,O as je,q as Kl}from"./index.4db2cdd2.js";import{p as Hl,r as Se,q as ze,t as Fe,v as qe,s as xl,a as We,w as $l,x as tn,y as en}from"./index.af7f8f90.js";import{h as ln,c as Ge}from"./index.b093923e.js";import{c as nn,b as ye,u as Te,i as sn,m as on}from"./index.6f34baee.js";import{e as te}from"./each.f3e982ad.js";import{A as rn,u as an,a as cn,b as un}from"./AddFilesPlaceholder.69037e9a.js";import{t as Ye}from"./index.5bbd5323.js";import{M as fn}from"./Messages.5c5807c3.js";import{T as he}from"./create.324e2fd2.js";import{c as dn,D as mn,M as Be,T as hn,S as gn,U as pn,q as _n}from"./UserMenu.7e500d0a.js";import{S as vn}from"./Selector.10317233.js";import{d as bn}from"./index.33abb791.js";import{s as wn,g as kn,u as yn,a as En,M as In}from"./menu-trigger.9c7a531b.js";import{g as pe}from"./spread.8a54911c.js";import{a as Rl,d as Dn}from"./updater.a83b9f1f.js";import{f as Mn}from"./FileSaver.min.898eb36f.js";import{f as jl}from"./index.1df8947f.js";import{a as Cn}from"./index.c2102944.js";import"./singletons.d5eea5b9.js";import{M as Sn}from"./MenuLines.ccad0b33.js";const Tn=l=>({subIds:l&1}),Je=l=>({subIds:l[0]});function Vn(l){let t;const e=l[6].default,n=ee(e,l,l[5],Je);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),t=!0},p(s,[r]){n&&n.p&&(!t||r&33)&&le(n,e,s,s[5],t?se(e,s[5],r,Tn):ne(s[5]),Je)},i(s){t||(q(n,s),t=!0)},o(s){G(n,s),t=!1},d(s){n&&n.d(s)}}}function Bn(l,t,e){let n,{$$slots:s={},$$scope:r}=t,{disabled:o=void 0}=t,{open:i=void 0}=t,{onOpenChange:a=void 0}=t;const{updateOption:c,ids:u,states:{subOpen:f}}=wn({disabled:o,onOpenChange:({next:g})=>(i!==g&&(a==null||a(g),e(2,i=g)),g)}),v=bn([u.menu,u.trigger],([g,p])=>({menu:g,trigger:p}));return st(l,v,g=>e(0,n=g)),l.$$set=g=>{"disabled"in g&&e(3,o=g.disabled),"open"in g&&e(2,i=g.open),"onOpenChange"in g&&e(4,a=g.onOpenChange),"$$scope"in g&&e(5,r=g.$$scope)},l.$$.update=()=>{l.$$.dirty&4&&i!==void 0&&f.set(i),l.$$.dirty&8&&c("disabled",o)},[n,v,i,o,a,r,s]}class An extends Jt{constructor(t){super(),Zt(this,t,Bn,Vn,Yt,{disabled:3,open:2,onOpenChange:4})}}const On=l=>({builder:l[0]&256}),Ze=l=>({builder:l[8]}),Pn=l=>({builder:l[0]&256}),Xe=l=>({builder:l[8]}),Ln=l=>({builder:l[0]&256}),Qe=l=>({builder:l[8]}),Nn=l=>({builder:l[0]&256}),Ke=l=>({builder:l[8]}),Un=l=>({builder:l[0]&256}),xe=l=>({builder:l[8]}),Hn=l=>({builder:l[0]&256}),$e=l=>({builder:l[8]});function Rn(l){let t,e,n,s;const r=l[28].default,o=ee(r,l,l[27],Ze);let i=[l[8],l[13]],a={};for(let c=0;c<i.length;c+=1)a=$t(a,i[c]);return{c(){t=M("div"),o&&o.c(),this.h()},l(c){t=C(c,"DIV",{});var u=E(t);o&&o.l(u),u.forEach(m),this.h()},h(){Gt(t,a)},m(c,u){N(c,t,u),o&&o.m(t,null),l[33](t),e=!0,n||(s=[ge(l[8].action(t)),X(t,"m-focusout",l[12]),X(t,"m-keydown",l[12]),X(t,"m-pointermove",l[12])],n=!0)},p(c,u){o&&o.p&&(!e||u[0]&134217984)&&le(o,r,c,c[27],e?se(r,c[27],u,On):ne(c[27]),Ze),Gt(t,a=pe(i,[u[0]&256&&c[8],u[0]&8192&&c[13]]))},i(c){e||(q(o,c),e=!0)},o(c){G(o,c),e=!1},d(c){c&&m(t),o&&o.d(c),l[33](null),n=!1,oe(s)}}}function jn(l){let t,e,n,s,r;const o=l[28].default,i=ee(o,l,l[27],Xe);let a=[l[8],l[13]],c={};for(let u=0;u<a.length;u+=1)c=$t(c,a[u]);return{c(){t=M("div"),i&&i.c(),this.h()},l(u){t=C(u,"DIV",{});var f=E(t);i&&i.l(f),f.forEach(m),this.h()},h(){Gt(t,c)},m(u,f){N(u,t,f),i&&i.m(t,null),l[32](t),n=!0,s||(r=[ge(l[8].action(t)),X(t,"m-focusout",l[12]),X(t,"m-keydown",l[12]),X(t,"m-pointermove",l[12])],s=!0)},p(u,f){l=u,i&&i.p&&(!n||f[0]&134217984)&&le(i,o,l,l[27],n?se(o,l[27],f,Pn):ne(l[27]),Xe),Gt(t,c=pe(a,[f[0]&256&&l[8],f[0]&8192&&l[13]]))},i(u){n||(q(i,u),e&&e.end(1),n=!0)},o(u){G(i,u),u&&(e=Al(t,l[5],l[6])),n=!1},d(u){u&&m(t),i&&i.d(u),l[32](null),u&&e&&e.end(),s=!1,oe(r)}}}function zn(l){let t,e,n,s,r;const o=l[28].default,i=ee(o,l,l[27],Qe);let a=[l[8],l[13]],c={};for(let u=0;u<a.length;u+=1)c=$t(c,a[u]);return{c(){t=M("div"),i&&i.c(),this.h()},l(u){t=C(u,"DIV",{});var f=E(t);i&&i.l(f),f.forEach(m),this.h()},h(){Gt(t,c)},m(u,f){N(u,t,f),i&&i.m(t,null),l[31](t),n=!0,s||(r=[ge(l[8].action(t)),X(t,"m-focusout",l[12]),X(t,"m-keydown",l[12]),X(t,"m-pointermove",l[12])],s=!0)},p(u,f){l=u,i&&i.p&&(!n||f[0]&134217984)&&le(i,o,l,l[27],n?se(o,l[27],f,Ln):ne(l[27]),Qe),Gt(t,c=pe(a,[f[0]&256&&l[8],f[0]&8192&&l[13]]))},i(u){n||(q(i,u),u&&(e||Ae(()=>{e=Ol(t,l[3],l[4]),e.start()})),n=!0)},o(u){G(i,u),n=!1},d(u){u&&m(t),i&&i.d(u),l[31](null),s=!1,oe(r)}}}function Fn(l){let t,e,n,s,r,o;const i=l[28].default,a=ee(i,l,l[27],Ke);let c=[l[8],l[13]],u={};for(let f=0;f<c.length;f+=1)u=$t(u,c[f]);return{c(){t=M("div"),a&&a.c(),this.h()},l(f){t=C(f,"DIV",{});var v=E(t);a&&a.l(v),v.forEach(m),this.h()},h(){Gt(t,u)},m(f,v){N(f,t,v),a&&a.m(t,null),l[30](t),s=!0,r||(o=[ge(l[8].action(t)),X(t,"m-focusout",l[12]),X(t,"m-keydown",l[12]),X(t,"m-pointermove",l[12])],r=!0)},p(f,v){l=f,a&&a.p&&(!s||v[0]&134217984)&&le(a,i,l,l[27],s?se(i,l[27],v,Nn):ne(l[27]),Ke),Gt(t,u=pe(c,[v[0]&256&&l[8],v[0]&8192&&l[13]]))},i(f){s||(q(a,f),f&&Ae(()=>{s&&(n&&n.end(1),e=Ol(t,l[3],l[4]),e.start())}),s=!0)},o(f){G(a,f),e&&e.invalidate(),f&&(n=Al(t,l[5],l[6])),s=!1},d(f){f&&m(t),a&&a.d(f),l[30](null),f&&n&&n.end(),r=!1,oe(o)}}}function qn(l){let t,e,n,s,r;const o=l[28].default,i=ee(o,l,l[27],xe);let a=[l[8],l[13]],c={};for(let u=0;u<a.length;u+=1)c=$t(c,a[u]);return{c(){t=M("div"),i&&i.c(),this.h()},l(u){t=C(u,"DIV",{});var f=E(t);i&&i.l(f),f.forEach(m),this.h()},h(){Gt(t,c)},m(u,f){N(u,t,f),i&&i.m(t,null),l[29](t),n=!0,s||(r=[ge(l[8].action(t)),X(t,"m-focusout",l[12]),X(t,"m-keydown",l[12]),X(t,"m-pointermove",l[12])],s=!0)},p(u,f){l=u,i&&i.p&&(!n||f[0]&134217984)&&le(i,o,l,l[27],n?se(o,l[27],f,Un):ne(l[27]),xe),Gt(t,c=pe(a,[f[0]&256&&l[8],f[0]&8192&&l[13]]))},i(u){n||(q(i,u),u&&Ae(()=>{n&&(e||(e=Ne(t,l[1],l[2],!0)),e.run(1))}),n=!0)},o(u){G(i,u),u&&(e||(e=Ne(t,l[1],l[2],!1)),e.run(0)),n=!1},d(u){u&&m(t),i&&i.d(u),l[29](null),u&&e&&e.end(),s=!1,oe(r)}}}function Wn(l){let t;const e=l[28].default,n=ee(e,l,l[27],$e);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),t=!0},p(s,r){n&&n.p&&(!t||r[0]&134217984)&&le(n,e,s,s[27],t?se(e,s[27],r,Hn):ne(s[27]),$e)},i(s){t||(q(n,s),t=!0)},o(s){G(n,s),t=!1},d(s){n&&n.d(s)}}}function Gn(l){let t,e,n,s;const r=[Wn,qn,Fn,zn,jn,Rn],o=[];function i(a,c){return a[7]&&a[9]?0:a[1]&&a[9]?1:a[3]&&a[5]&&a[9]?2:a[3]&&a[9]?3:a[5]&&a[9]?4:a[9]?5:-1}return~(t=i(l))&&(e=o[t]=r[t](l)),{c(){e&&e.c(),n=Ut()},l(a){e&&e.l(a),n=Ut()},m(a,c){~t&&o[t].m(a,c),N(a,n,c),s=!0},p(a,c){let u=t;t=i(a),t===u?~t&&o[t].p(a,c):(e&&(qt(),G(o[u],1,1,()=>{o[u]=null}),Wt()),~t?(e=o[t],e?e.p(a,c):(e=o[t]=r[t](a),e.c()),q(e,1),e.m(n.parentNode,n)):e=null)},i(a){s||(q(e),s=!0)},o(a){G(e),s=!1},d(a){a&&m(n),~t&&o[t].d(a)}}}function Yn(l,t,e){let n;const s=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let r=Ie(t,s),o,i,{$$slots:a={},$$scope:c}=t,{transition:u=void 0}=t,{transitionConfig:f=void 0}=t,{inTransition:v=void 0}=t,{inTransitionConfig:g=void 0}=t,{outTransition:p=void 0}=t,{outTransitionConfig:w=void 0}=t,{asChild:_=!1}=t,{id:k=void 0}=t,{side:y="right"}=t,{align:V="start"}=t,{sideOffset:T=0}=t,{alignOffset:Z=0}=t,{collisionPadding:I=8}=t,{avoidCollisions:U=!0}=t,{collisionBoundary:B=void 0}=t,{sameWidth:O=!1}=t,{fitViewport:$=!1}=t,{strategy:H="absolute"}=t,{overlap:R=!1}=t,{el:A=void 0}=t;const{elements:{subMenu:ot},states:{subOpen:Ht},ids:bt,getAttrs:Vt}=kn();st(l,ot,P=>e(26,o=P)),st(l,Ht,P=>e(9,i=P));const Ot=Rl(),ut=Vt("sub-content");function wt(P){it[P?"unshift":"push"](()=>{A=P,e(0,A)})}function Bt(P){it[P?"unshift":"push"](()=>{A=P,e(0,A)})}function jt(P){it[P?"unshift":"push"](()=>{A=P,e(0,A)})}function j(P){it[P?"unshift":"push"](()=>{A=P,e(0,A)})}function et(P){it[P?"unshift":"push"](()=>{A=P,e(0,A)})}return l.$$set=P=>{t=$t($t({},t),Tl(P)),e(13,r=Ie(t,s)),"transition"in P&&e(1,u=P.transition),"transitionConfig"in P&&e(2,f=P.transitionConfig),"inTransition"in P&&e(3,v=P.inTransition),"inTransitionConfig"in P&&e(4,g=P.inTransitionConfig),"outTransition"in P&&e(5,p=P.outTransition),"outTransitionConfig"in P&&e(6,w=P.outTransitionConfig),"asChild"in P&&e(7,_=P.asChild),"id"in P&&e(14,k=P.id),"side"in P&&e(15,y=P.side),"align"in P&&e(16,V=P.align),"sideOffset"in P&&e(17,T=P.sideOffset),"alignOffset"in P&&e(18,Z=P.alignOffset),"collisionPadding"in P&&e(19,I=P.collisionPadding),"avoidCollisions"in P&&e(20,U=P.avoidCollisions),"collisionBoundary"in P&&e(21,B=P.collisionBoundary),"sameWidth"in P&&e(22,O=P.sameWidth),"fitViewport"in P&&e(23,$=P.fitViewport),"strategy"in P&&e(24,H=P.strategy),"overlap"in P&&e(25,R=P.overlap),"el"in P&&e(0,A=P.el),"$$scope"in P&&e(27,c=P.$$scope)},l.$$.update=()=>{l.$$.dirty[0]&16384&&k&&bt.menu.set(k),l.$$.dirty[0]&67108864&&e(8,n=o),l.$$.dirty[0]&256&&Object.assign(n,ut),l.$$.dirty[0]&67076096&&yn({side:y,align:V,sideOffset:T,alignOffset:Z,collisionPadding:I,avoidCollisions:U,collisionBoundary:B,sameWidth:O,fitViewport:$,strategy:H,overlap:R})},[A,u,f,v,g,p,w,_,n,i,ot,Ht,Ot,r,k,y,V,T,Z,I,U,B,O,$,H,R,o,c,a,wt,Bt,jt,j,et]}class Jn extends Jt{constructor(t){super(),Zt(this,t,Yn,Gn,Yt,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const Zn=l=>({builder:l&4}),tl=l=>({builder:l[2]}),Xn=l=>({builder:l&4}),el=l=>({builder:l[2]});function Qn(l){let t,e,n,s;const r=l[13].default,o=ee(r,l,l[12],tl);let i=[l[2],l[6]],a={};for(let c=0;c<i.length;c+=1)a=$t(a,i[c]);return{c(){t=M("div"),o&&o.c(),this.h()},l(c){t=C(c,"DIV",{});var u=E(t);o&&o.l(u),u.forEach(m),this.h()},h(){Gt(t,a)},m(c,u){N(c,t,u),o&&o.m(t,null),l[14](t),e=!0,n||(s=[ge(l[2].action(t)),X(t,"m-click",l[5]),X(t,"m-focusin",l[5]),X(t,"m-focusout",l[5]),X(t,"m-keydown",l[5]),X(t,"m-pointerleave",l[5]),X(t,"m-pointermove",l[5])],n=!0)},p(c,u){o&&o.p&&(!e||u&4100)&&le(o,r,c,c[12],e?se(r,c[12],u,Zn):ne(c[12]),tl),Gt(t,a=pe(i,[u&4&&c[2],u&64&&c[6]]))},i(c){e||(q(o,c),e=!0)},o(c){G(o,c),e=!1},d(c){c&&m(t),o&&o.d(c),l[14](null),n=!1,oe(s)}}}function Kn(l){let t;const e=l[13].default,n=ee(e,l,l[12],el);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),t=!0},p(s,r){n&&n.p&&(!t||r&4100)&&le(n,e,s,s[12],t?se(e,s[12],r,Xn):ne(s[12]),el)},i(s){t||(q(n,s),t=!0)},o(s){G(n,s),t=!1},d(s){n&&n.d(s)}}}function xn(l){let t,e,n,s;const r=[Kn,Qn],o=[];function i(a,c){return a[1]?0:1}return t=i(l),e=o[t]=r[t](l),{c(){e.c(),n=Ut()},l(a){e.l(a),n=Ut()},m(a,c){o[t].m(a,c),N(a,n,c),s=!0},p(a,[c]){let u=t;t=i(a),t===u?o[t].p(a,c):(qt(),G(o[u],1,1,()=>{o[u]=null}),Wt(),e=o[t],e?e.p(a,c):(e=o[t]=r[t](a),e.c()),q(e,1),e.m(n.parentNode,n))},i(a){s||(q(e),s=!0)},o(a){G(e),s=!1},d(a){a&&m(n),o[t].d(a)}}}function $n(l,t,e){let n,s;const r=["disabled","asChild","id","el"];let o=Ie(t,r),i,a,{$$slots:c={},$$scope:u}=t,{disabled:f=!1}=t,{asChild:v=!1}=t,{id:g=void 0}=t,{el:p=void 0}=t;const{elements:{subTrigger:w},ids:_,getAttrs:k,options:y}=En();st(l,w,I=>e(11,a=I));const{disabled:V}=y;st(l,V,I=>e(10,i=I));const T=Rl();function Z(I){it[I?"unshift":"push"](()=>{p=I,e(0,p)})}return l.$$set=I=>{t=$t($t({},t),Tl(I)),e(6,o=Ie(t,r)),"disabled"in I&&e(7,f=I.disabled),"asChild"in I&&e(1,v=I.asChild),"id"in I&&e(8,g=I.id),"el"in I&&e(0,p=I.el),"$$scope"in I&&e(12,u=I.$$scope)},l.$$.update=()=>{l.$$.dirty&256&&g&&_.trigger.set(g),l.$$.dirty&2048&&e(2,n=a),l.$$.dirty&1152&&e(9,s={...k("sub-trigger"),...Dn(f||i)}),l.$$.dirty&516&&Object.assign(n,s)},[p,v,n,w,V,T,o,f,g,s,i,a,u,c,Z]}class ts extends Jt{constructor(t){super(),Zt(this,t,$n,xn,Yt,{disabled:7,asChild:1,id:8,el:0})}}function ll(l,t,e){const n=l.slice();return n[11]=t[e],n[13]=e,n}function nl(l){let t,e,n,s='<div class="text-lg font-semibold mt-2">/</div>',r,o,i,a,c,u,f='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',v,g,p=l[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",w,_=te(l[1]),k=[];for(let y=0;y<_.length;y+=1)k[y]=sl(ll(l,_,y));return{c(){t=M("div"),e=M("div"),n=M("div"),n.innerHTML=s,r=Q(),o=M("div"),i=M("div");for(let y=0;y<k.length;y+=1)k[y].c();a=Q(),c=M("div"),u=M("div"),u.innerHTML=f,v=Q(),g=M("div"),w=at(p),this.h()},l(y){t=C(y,"DIV",{class:!0});var V=E(t);e=C(V,"DIV",{class:!0});var T=E(e);n=C(T,"DIV",{class:!0,"data-svelte-h":!0}),Qt(n)!=="svelte-1ynv172"&&(n.innerHTML=s),r=K(T),o=C(T,"DIV",{class:!0});var Z=E(o);i=C(Z,"DIV",{class:!0});var I=E(i);for(let O=0;O<k.length;O+=1)k[O].l(I);I.forEach(m),a=K(Z),c=C(Z,"DIV",{class:!0});var U=E(c);u=C(U,"DIV",{"data-svelte-h":!0}),Qt(u)!=="svelte-cdi12d"&&(u.innerHTML=f),v=K(U),g=C(U,"DIV",{class:!0});var B=E(g);w=ct(B,p),B.forEach(m),U.forEach(m),Z.forEach(m),T.forEach(m),V.forEach(m),this.h()},h(){d(n,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),d(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),d(g,"class","line-clamp-1"),d(c,"class","px-2 pb-1 text-xs text-gray-600 bg-white rounded-br-xl flex items-center space-x-1"),d(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),d(e,"class","flex w-full px-2"),d(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(y,V){N(y,t,V),b(t,e),b(e,n),b(e,r),b(e,o),b(o,i);for(let T=0;T<k.length;T+=1)k[T]&&k[T].m(i,null);b(o,a),b(o,c),b(c,u),b(c,v),b(c,g),b(g,w)},p(y,V){if(V&19){_=te(y[1]);let T;for(T=0;T<_.length;T+=1){const Z=ll(y,_,T);k[T]?k[T].p(Z,V):(k[T]=sl(Z),k[T].c(),k[T].m(i,null))}for(;T<k.length;T+=1)k[T].d(1);k.length=_.length}V&4&&p!==(p=y[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Et(w,p)},d(y){y&&m(t),Ee(k,y)}}}function sl(l){let t,e,n=l[11].command+"",s,r,o,i=l[11].title+"",a,c,u,f,v;function g(){return l[9](l[11])}function p(){return l[10](l[13])}return{c(){t=M("button"),e=M("div"),s=at(n),r=Q(),o=M("div"),a=at(i),c=Q(),this.h()},l(w){t=C(w,"BUTTON",{class:!0,type:!0});var _=E(t);e=C(_,"DIV",{class:!0});var k=E(e);s=ct(k,n),k.forEach(m),r=K(_),o=C(_,"DIV",{class:!0});var y=E(o);a=ct(y,i),y.forEach(m),c=K(_),_.forEach(m),this.h()},h(){d(e,"class","font-medium text-black"),d(o,"class","text-xs text-gray-600"),d(t,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(l[13]===l[0]?" bg-gray-100 selected-command-option-button":"")),d(t,"type","button")},m(w,_){N(w,t,_),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),b(t,c),f||(v=[X(t,"click",g),X(t,"mousemove",p),X(t,"focus",ls)],f=!0)},p(w,_){l=w,_&2&&n!==(n=l[11].command+"")&&Et(s,n),_&2&&i!==(i=l[11].title+"")&&Et(a,i),_&1&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(l[13]===l[0]?" bg-gray-100 selected-command-option-button":""))&&d(t,"class",u)},d(w){w&&m(t),f=!1,oe(v)}}}function es(l){let t,e=l[1].length>0&&nl(l);return{c(){e&&e.c(),t=Ut()},l(n){e&&e.l(n),t=Ut()},m(n,s){e&&e.m(n,s),N(n,t,s)},p(n,[s]){n[1].length>0?e?e.p(n,s):(e=nl(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:zt,o:zt,d(n){n&&m(t),e&&e.d(n)}}}const ls=()=>{};function ns(l,t,e){let n,s;st(l,Jl,p=>e(8,s=p));const r=ie("i18n");st(l,r,p=>e(2,n=p));let{prompt:o=""}=t,i=0,a=[];const c=()=>{e(0,i=Math.max(0,i-1))},u=()=>{e(0,i=Math.min(i+1,a.length-1))},f=async p=>{let w=p.content;if(p.content.includes("{{CLIPBOARD}}")){const y=await navigator.clipboard.readText().catch(V=>(ft.error(n.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));w=p.content.replaceAll("{{CLIPBOARD}}",y)}e(5,o=w);const _=document.getElementById("chat-textarea");await vt(),_.style.height="",_.style.height=Math.min(_.scrollHeight,200)+"px",_==null||_.focus(),await vt();const k=Hl(o);if(k.length>0){const y=k.at(0);_.setSelectionRange(y==null?void 0:y.startIndex,y.endIndex+1)}},v=p=>{f(p)},g=p=>{e(0,i=p)};return l.$$set=p=>{"prompt"in p&&e(5,o=p.prompt)},l.$$.update=()=>{l.$$.dirty&288&&e(1,a=s.filter(p=>p.command.includes(o)).sort((p,w)=>p.title.localeCompare(w.title))),l.$$.dirty&32&&o&&e(0,i=0)},[i,a,n,r,f,o,c,u,s,v,g]}class ss extends Jt{constructor(t){super(),Zt(this,t,ns,es,Yt,{prompt:5,selectUp:6,selectDown:7})}get selectUp(){return this.$$.ctx[6]}get selectDown(){return this.$$.ctx[7]}}function ol(l,t,e){const n=l.slice();return n[19]=t[e],n[21]=e,n}function rl(l){let t,e,n,s='<div class="text-lg font-semibold mt-2">#</div>',r,o,i,a,c,u,f=te(l[3]),v=[];for(let _=0;_<f.length;_+=1)v[_]=il(ol(l,f,_));function g(_,k){var y,V;if(k&1&&(c=null),k&1&&(u=null),c==null&&(c=!!_[0].split(" ").some(us)),c)return as;if(u==null&&(u=!!((V=(y=_[0].split(" "))==null?void 0:y.at(0))!=null&&V.substring(1).startsWith("http"))),u)return is}let p=g(l,-1),w=p&&p(l);return{c(){t=M("div"),e=M("div"),n=M("div"),n.innerHTML=s,r=Q(),o=M("div"),i=M("div");for(let _=0;_<v.length;_+=1)v[_].c();a=Q(),w&&w.c(),this.h()},l(_){t=C(_,"DIV",{class:!0});var k=E(t);e=C(k,"DIV",{class:!0});var y=E(e);n=C(y,"DIV",{class:!0,"data-svelte-h":!0}),Qt(n)!=="svelte-czbw16"&&(n.innerHTML=s),r=K(y),o=C(y,"DIV",{class:!0});var V=E(o);i=C(V,"DIV",{class:!0});var T=E(i);for(let Z=0;Z<v.length;Z+=1)v[Z].l(T);a=K(T),w&&w.l(T),T.forEach(m),V.forEach(m),y.forEach(m),k.forEach(m),this.h()},h(){d(n,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),d(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),d(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),d(e,"class","flex w-full px-2"),d(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(_,k){N(_,t,k),b(t,e),b(e,n),b(e,r),b(e,o),b(o,i);for(let y=0;y<v.length;y+=1)v[y]&&v[y].m(i,null);b(i,a),w&&w.m(i,null)},p(_,k){if(k&46){f=te(_[3]);let y;for(y=0;y<f.length;y+=1){const V=ol(_,f,y);v[y]?v[y].p(V,k):(v[y]=il(V),v[y].c(),v[y].m(i,a))}for(;y<v.length;y+=1)v[y].d(1);v.length=f.length}p===(p=g(_,k))&&w?w.p(_,k):(w&&w.d(1),w=p&&p(_),w&&(w.c(),w.m(i,null)))},d(_){_&&m(t),Ee(v,_),w&&w.d()}}}function os(l){let t,e,n=l[19].name+"",s,r,o=l[19].filename+"",i,a,c,u,f=l[19].title+"",v;return{c(){t=M("div"),e=at("#"),s=at(n),r=at(" ("),i=at(o),a=at(")"),c=Q(),u=M("div"),v=at(f),this.h()},l(g){t=C(g,"DIV",{class:!0});var p=E(t);e=ct(p,"#"),s=ct(p,n),r=ct(p," ("),i=ct(p,o),a=ct(p,")"),p.forEach(m),c=K(g),u=C(g,"DIV",{class:!0});var w=E(u);v=ct(w,f),w.forEach(m),this.h()},h(){d(t,"class","font-medium text-black line-clamp-1"),d(u,"class","text-xs text-gray-600 line-clamp-1")},m(g,p){N(g,t,p),b(t,e),b(t,s),b(t,r),b(t,i),b(t,a),N(g,c,p),N(g,u,p),b(u,v)},p(g,p){p&8&&n!==(n=g[19].name+"")&&Et(s,n),p&8&&o!==(o=g[19].filename+"")&&Et(i,o),p&8&&f!==(f=g[19].title+"")&&Et(v,f)},d(g){g&&(m(t),m(c),m(u))}}}function rs(l){var a;let t,e=(((a=l[19])==null?void 0:a.title)??`#${l[19].name}`)+"",n,s,r,o=l[1].t("Collection")+"",i;return{c(){t=M("div"),n=at(e),s=Q(),r=M("div"),i=at(o),this.h()},l(c){t=C(c,"DIV",{class:!0});var u=E(t);n=ct(u,e),u.forEach(m),s=K(c),r=C(c,"DIV",{class:!0});var f=E(r);i=ct(f,o),f.forEach(m),this.h()},h(){d(t,"class","font-medium text-black line-clamp-1"),d(r,"class","text-xs text-gray-600 line-clamp-1")},m(c,u){N(c,t,u),b(t,n),N(c,s,u),N(c,r,u),b(r,i)},p(c,u){var f;u&8&&e!==(e=(((f=c[19])==null?void 0:f.title)??`#${c[19].name}`)+"")&&Et(n,e),u&2&&o!==(o=c[1].t("Collection")+"")&&Et(i,o)},d(c){c&&(m(t),m(s),m(r))}}}function il(l){let t,e,n,s;function r(u,f){return u[19].type==="collection"?rs:os}let o=r(l),i=o(l);function a(){return l[14](l[19])}function c(){return l[15](l[21])}return{c(){t=M("button"),i.c(),this.h()},l(u){t=C(u,"BUTTON",{class:!0,type:!0});var f=E(t);i.l(f),f.forEach(m),this.h()},h(){d(t,"class",e="px-3 py-1.5 rounded-xl w-full text-left "+(l[21]===l[2]?" bg-gray-100 selected-command-option-button":"")),d(t,"type","button")},m(u,f){N(u,t,f),i.m(t,null),n||(s=[X(t,"click",a),X(t,"mousemove",c),X(t,"focus",fs)],n=!0)},p(u,f){l=u,o===(o=r(l))&&i?i.p(l,f):(i.d(1),i=o(l),i&&(i.c(),i.m(t,null))),f&4&&e!==(e="px-3 py-1.5 rounded-xl w-full text-left "+(l[21]===l[2]?" bg-gray-100 selected-command-option-button":""))&&d(t,"class",e)},d(u){u&&m(t),i.d(),n=!1,oe(s)}}}function is(l){var f,v;let t,e,n=((v=(f=l[0].split(" "))==null?void 0:f.at(0))==null?void 0:v.substring(1))+"",s,r,o,i=l[1].t("Web")+"",a,c,u;return{c(){t=M("button"),e=M("div"),s=at(n),r=Q(),o=M("div"),a=at(i),this.h()},l(g){t=C(g,"BUTTON",{class:!0,type:!0});var p=E(t);e=C(p,"DIV",{class:!0});var w=E(e);s=ct(w,n),w.forEach(m),r=K(p),o=C(p,"DIV",{class:!0});var _=E(o);a=ct(_,i),_.forEach(m),p.forEach(m),this.h()},h(){d(e,"class","font-medium text-black line-clamp-1"),d(o,"class","text-xs text-gray-600 line-clamp-1"),d(t,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),d(t,"type","button")},m(g,p){N(g,t,p),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),c||(u=X(t,"click",l[17]),c=!0)},p(g,p){var w,_;p&1&&n!==(n=((_=(w=g[0].split(" "))==null?void 0:w.at(0))==null?void 0:_.substring(1))+"")&&Et(s,n),p&2&&i!==(i=g[1].t("Web")+"")&&Et(a,i)},d(g){g&&m(t),c=!1,u()}}}function as(l){var f,v;let t,e,n=((v=(f=l[0].split(" "))==null?void 0:f.at(0))==null?void 0:v.substring(1))+"",s,r,o,i=l[1].t("Youtube")+"",a,c,u;return{c(){t=M("button"),e=M("div"),s=at(n),r=Q(),o=M("div"),a=at(i),this.h()},l(g){t=C(g,"BUTTON",{class:!0,type:!0});var p=E(t);e=C(p,"DIV",{class:!0});var w=E(e);s=ct(w,n),w.forEach(m),r=K(p),o=C(p,"DIV",{class:!0});var _=E(o);a=ct(_,i),_.forEach(m),p.forEach(m),this.h()},h(){d(e,"class","font-medium text-black line-clamp-1"),d(o,"class","text-xs text-gray-600 line-clamp-1"),d(t,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),d(t,"type","button")},m(g,p){N(g,t,p),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),c||(u=X(t,"click",l[16]),c=!0)},p(g,p){var w,_;p&1&&n!==(n=((_=(w=g[0].split(" "))==null?void 0:w.at(0))==null?void 0:_.substring(1))+"")&&Et(s,n),p&2&&i!==(i=g[1].t("Youtube")+"")&&Et(a,i)},d(g){g&&m(t),c=!1,u()}}}function cs(l){var s,r;let t=l[3].length>0||((r=(s=l[0].split(" "))==null?void 0:s.at(0))==null?void 0:r.substring(1).startsWith("http")),e,n=t&&rl(l);return{c(){n&&n.c(),e=Ut()},l(o){n&&n.l(o),e=Ut()},m(o,i){n&&n.m(o,i),N(o,e,i)},p(o,[i]){var a,c;i&9&&(t=o[3].length>0||((c=(a=o[0].split(" "))==null?void 0:a.at(0))==null?void 0:c.substring(1).startsWith("http"))),t?n?n.p(o,i):(n=rl(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:zt,o:zt,d(o){o&&m(e),n&&n.d(o)}}}const us=l=>l.substring(1).startsWith("https://www.youtube.com")||l.substring(1).startsWith("https://youtu.be"),fs=()=>{};function ds(l,t,e){let n,s,r;st(l,Zl,I=>e(13,s=I));const o=ie("i18n");st(l,o,I=>e(1,r=I));let{prompt:i=""}=t;const a=Vl();let c=0,u=[],f=[],v=[];const g=()=>{e(2,c=Math.max(0,c-1))},p=()=>{e(2,c=Math.min(c+1,u.length-1))},w=async I=>{a("select",I),e(0,i=Se(i));const U=document.getElementById("chat-textarea");await vt(),U==null||U.focus(),await vt()},_=async I=>{a("url",I),e(0,i=Se(i));const U=document.getElementById("chat-textarea");await vt(),U==null||U.focus(),await vt()},k=async I=>{a("youtube",I),e(0,i=Se(i));const U=document.getElementById("chat-textarea");await vt(),U==null||U.focus(),await vt()},y=I=>{console.log(I),w(I)},V=I=>{e(2,c=I)},T=()=>{var U,B;const I=(B=(U=i.split(" "))==null?void 0:U.at(0))==null?void 0:B.substring(1);ze(I)?k(I):ft.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},Z=()=>{var U,B;const I=(B=(U=i.split(" "))==null?void 0:U.at(0))==null?void 0:B.substring(1);ze(I)?_(I):ft.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return l.$$set=I=>{"prompt"in I&&e(0,i=I.prompt)},l.$$.update=()=>{l.$$.dirty&8194&&e(11,v=[...s.length>0?[{name:"All Documents",type:"collection",title:r.t("All Documents"),collection_names:s.map(I=>I.collection_name)}]:[],...s.reduce((I,U,B,O)=>{var $;return[...new Set([...I,...((($=U==null?void 0:U.content)==null?void 0:$.tags)??[]).map(H=>H.name)])]},[]).map(I=>({name:I,type:"collection",collection_names:s.filter(U=>{var B;return(((B=U==null?void 0:U.content)==null?void 0:B.tags)??[]).map(O=>O.name).includes(I)}).map(U=>U.collection_name)}))]),l.$$.dirty&2049&&e(12,n=v.filter(I=>{var U,B;return I.name.includes(((B=(U=i.split(" "))==null?void 0:U.at(0))==null?void 0:B.substring(1))??"")}).sort((I,U)=>I.name.localeCompare(U.name))),l.$$.dirty&8193&&e(10,f=s.filter(I=>{var U,B;return I.name.includes(((B=(U=i.split(" "))==null?void 0:U.at(0))==null?void 0:B.substring(1))??"")}).sort((I,U)=>I.title.localeCompare(U.title))),l.$$.dirty&5120&&e(3,u=[...n,...f]),l.$$.dirty&4097&&i&&(e(2,c=0),console.log(n))},[i,r,c,u,o,w,_,k,g,p,f,v,n,s,y,V,T,Z]}class ms extends Jt{constructor(t){super(),Zt(this,t,ds,cs,Yt,{prompt:0,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function al(l,t,e){const n=l.slice();return n[16]=t[e],n[18]=e,n}function cl(l){let t,e=l[2].length>0&&ul(l);return{c(){e&&e.c(),t=Ut()},l(n){e&&e.l(n),t=Ut()},m(n,s){e&&e.m(n,s),N(n,t,s)},p(n,s){n[2].length>0?e?e.p(n,s):(e=ul(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(n){n&&m(t),e&&e.d(n)}}}function ul(l){let t,e,n,s='<div class="text-lg font-semibold mt-2">@</div>',r,o,i,a=te(l[2]),c=[];for(let u=0;u<a.length;u+=1)c[u]=fl(al(l,a,u));return{c(){t=M("div"),e=M("div"),n=M("div"),n.innerHTML=s,r=Q(),o=M("div"),i=M("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){t=C(u,"DIV",{class:!0});var f=E(t);e=C(f,"DIV",{class:!0});var v=E(e);n=C(v,"DIV",{class:!0,"data-svelte-h":!0}),Qt(n)!=="svelte-1ourwwn"&&(n.innerHTML=s),r=K(v),o=C(v,"DIV",{class:!0});var g=E(o);i=C(g,"DIV",{class:!0});var p=E(i);for(let w=0;w<c.length;w+=1)c[w].l(p);p.forEach(m),g.forEach(m),v.forEach(m),f.forEach(m),this.h()},h(){d(n,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),d(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),d(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),d(e,"class","flex w-full px-2"),d(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(u,f){N(u,t,f),b(t,e),b(e,n),b(e,r),b(e,o),b(o,i);for(let v=0;v<c.length;v+=1)c[v]&&c[v].m(i,null)},p(u,f){if(f&22){a=te(u[2]);let v;for(v=0;v<a.length;v+=1){const g=al(u,a,v);c[v]?c[v].p(g,f):(c[v]=fl(g),c[v].c(),c[v].m(i,null))}for(;v<c.length;v+=1)c[v].d(1);c.length=a.length}},d(u){u&&m(t),Ee(c,u)}}}function fl(l){let t,e,n=l[16].name+"",s,r,o,i,a;function c(){return l[11](l[16])}function u(){return l[12](l[18])}return{c(){t=M("button"),e=M("div"),s=at(n),r=Q(),this.h()},l(f){t=C(f,"BUTTON",{class:!0,type:!0});var v=E(t);e=C(v,"DIV",{class:!0});var g=E(e);s=ct(g,n),g.forEach(m),r=K(v),v.forEach(m),this.h()},h(){d(e,"class","font-medium text-black line-clamp-1"),d(t,"class",o="px-3 py-1.5 rounded-xl w-full text-left "+(l[18]===l[1]?" bg-gray-100 selected-command-option-button":"")),d(t,"type","button")},m(f,v){N(f,t,v),b(t,e),b(e,s),b(t,r),i||(a=[X(t,"click",c),X(t,"mousemove",u),X(t,"focus",gs)],i=!0)},p(f,v){l=f,v&4&&n!==(n=l[16].name+"")&&Et(s,n),v&2&&o!==(o="px-3 py-1.5 rounded-xl w-full text-left "+(l[18]===l[1]?" bg-gray-100 selected-command-option-button":""))&&d(t,"class",o)},d(f){f&&m(t),i=!1,oe(a)}}}function hs(l){let t=l[0].charAt(0)==="@",e,n=t&&cl(l);return{c(){n&&n.c(),e=Ut()},l(s){n&&n.l(s),e=Ut()},m(s,r){n&&n.m(s,r),N(s,e,r)},p(s,[r]){r&1&&(t=s[0].charAt(0)==="@"),t?n?n.p(s,r):(n=cl(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:zt,o:zt,d(s){s&&m(e),n&&n.d(s)}}}const gs=()=>{};function ps(l,t,e){let n;st(l,Oe,k=>e(10,n=k));const s=ie("i18n");st(l,s,k=>e(13,k));const r=Vl();let{prompt:o=""}=t,{user:i=null}=t,{chatInputPlaceholder:a=""}=t,{messages:c=[]}=t,u=0,f=[];const v=()=>{e(1,u=Math.max(0,u-1))},g=()=>{e(1,u=Math.min(u+1,f.length-1))},p=async k=>{e(0,o=""),r("select",k)},w=k=>{p(k)},_=k=>{e(1,u=k)};return l.$$set=k=>{"prompt"in k&&e(0,o=k.prompt),"user"in k&&e(5,i=k.user),"chatInputPlaceholder"in k&&e(6,a=k.chatInputPlaceholder),"messages"in k&&e(7,c=k.messages)},l.$$.update=()=>{l.$$.dirty&1025&&e(2,f=n.filter(k=>{var y,V;return k.name.includes(((V=(y=o.split(" "))==null?void 0:y.at(0))==null?void 0:V.substring(1))??"")}).sort((k,y)=>k.name.localeCompare(y.name))),l.$$.dirty&1&&o&&e(1,u=0)},[o,u,f,s,p,i,a,c,v,g,n,w,_]}class _s extends Jt{constructor(t){super(),Zt(this,t,ps,hs,Yt,{prompt:0,user:5,chatInputPlaceholder:6,messages:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function vs(l){let t,e;return{c(){t=pt("svg"),e=pt("path"),this.h()},l(n){t=_t(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=E(t);e=_t(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(e).forEach(m),s.forEach(m),this.h()},h(){d(e,"stroke-linecap","round"),d(e,"stroke-linejoin","round"),d(e,"d","M6 18 18 6M6 6l12 12"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"fill","none"),d(t,"viewBox","0 0 24 24"),d(t,"stroke-width",l[1]),d(t,"stroke","currentColor"),d(t,"class",l[0])},m(n,s){N(n,t,s),b(t,e)},p(n,[s]){s&2&&d(t,"stroke-width",n[1]),s&1&&d(t,"class",n[0])},i:zt,o:zt,d(n){n&&m(t)}}}function bs(l,t,e){let{className:n="size-3.5"}=t,{strokeWidth:s="2"}=t;return l.$$set=r=>{"className"in r&&e(0,n=r.className),"strokeWidth"in r&&e(1,s=r.strokeWidth)},[n,s]}class ws extends Jt{constructor(t){super(),Zt(this,t,bs,vs,Yt,{className:0,strokeWidth:1})}}function dl(l,t,e){const n=l.slice();return n[66]=t[e],n[68]=e,n}function ml(l){let t,e,n,s,r,o,i;return r=new rn({}),{c(){t=M("div"),e=M("div"),n=M("div"),s=M("div"),dt(r.$$.fragment),this.h()},l(a){t=C(a,"DIV",{class:!0,id:!0,role:!0,"aria-label":!0});var c=E(t);e=C(c,"DIV",{class:!0});var u=E(e);n=C(u,"DIV",{class:!0});var f=E(n);s=C(f,"DIV",{class:!0});var v=E(s);mt(r.$$.fragment,v),v.forEach(m),f.forEach(m),u.forEach(m),c.forEach(m),this.h()},h(){d(s,"class","max-w-md"),d(n,"class","m-auto pt-64 flex flex-col justify-center"),d(e,"class","absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center"),d(t,"class",o="fixed "+(l[21]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"),d(t,"id","dropzone"),d(t,"role","region"),d(t,"aria-label","Drag and Drop Container")},m(a,c){N(a,t,c),b(t,e),b(e,n),b(n,s),ht(r,s,null),i=!0},p(a,c){(!i||c[0]&2097152&&o!==(o="fixed "+(a[21]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"))&&d(t,"class",o)},i(a){i||(q(r.$$.fragment,a),i=!0)},o(a){G(r.$$.fragment,a),i=!1},d(a){a&&m(t),gt(r)}}}function hl(l){let t,e,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',s,r;return{c(){t=M("div"),e=M("button"),e.innerHTML=n,this.h()},l(o){t=C(o,"DIV",{class:!0});var i=E(t);e=C(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Qt(e)!=="svelte-4loiwr"&&(e.innerHTML=n),i.forEach(m),this.h()},h(){d(e,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full"),d(t,"class","absolute -top-12 left-0 right-0 flex justify-center z-30")},m(o,i){N(o,t,i),b(t,e),s||(r=X(e,"click",l[30]),s=!0)},p:zt,d(o){o&&m(t),s=!1,r()}}}function ks(l){let t,e,n;function s(o){l[34](o)}let r={};return l[0]!==void 0&&(r.prompt=l[0]),t=new ms({props:r}),l[33](t),it.push(()=>Nt(t,"prompt",s)),t.$on("youtube",l[35]),t.$on("url",l[36]),t.$on("select",l[37]),{c(){dt(t.$$.fragment)},l(o){mt(t.$$.fragment,o)},m(o,i){ht(t,o,i),n=!0},p(o,i){const a={};!e&&i[0]&1&&(e=!0,a.prompt=o[0],Lt(()=>e=!1)),t.$set(a)},i(o){n||(q(t.$$.fragment,o),n=!0)},o(o){G(t.$$.fragment,o),n=!1},d(o){l[33](null),gt(t,o)}}}function ys(l){let t,e,n;function s(o){l[32](o)}let r={};return l[0]!==void 0&&(r.prompt=l[0]),t=new ss({props:r}),l[31](t),it.push(()=>Nt(t,"prompt",s)),{c(){dt(t.$$.fragment)},l(o){mt(t.$$.fragment,o)},m(o,i){ht(t,o,i),n=!0},p(o,i){const a={};!e&&i[0]&1&&(e=!0,a.prompt=o[0],Lt(()=>e=!1)),t.$set(a)},i(o){n||(q(t.$$.fragment,o),n=!0)},o(o){G(t.$$.fragment,o),n=!1},d(o){l[31](null),gt(t,o)}}}function gl(l){let t,e,n,s,r,o,i,a,c=l[2].name+"",u,f,v,g,p,w,_,k;return p=new ws({}),{c(){t=M("div"),e=M("div"),n=M("img"),r=Q(),o=M("div"),i=at("Talking to "),a=M("span"),u=at(c),f=Q(),v=M("div"),g=M("button"),dt(p.$$.fragment),this.h()},l(y){t=C(y,"DIV",{class:!0});var V=E(t);e=C(V,"DIV",{class:!0});var T=E(e);n=C(T,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),r=K(T),o=C(T,"DIV",{});var Z=E(o);i=ct(Z,"Talking to "),a=C(Z,"SPAN",{class:!0});var I=E(a);u=ct(I,c),I.forEach(m),Z.forEach(m),T.forEach(m),f=K(V),v=C(V,"DIV",{});var U=E(v);g=C(U,"BUTTON",{class:!0});var B=E(g);mt(p.$$.fragment,B),B.forEach(m),U.forEach(m),V.forEach(m),this.h()},h(){var y;d(n,"crossorigin","anonymous"),d(n,"alt","model profile"),d(n,"class","size-5 max-w-[28px] object-cover rounded-full"),me(n.src,s=((y=l[22].find(l[43]))==null?void 0:y.imageUrl)??(l[19].language==="dg-DG"?"/doge.png":`${Me}/static/favicon.png`))||d(n,"src",s),d(a,"class","font-medium"),d(e,"class","flex items-center gap-2 text-sm dark:text-gray-500"),d(g,"class","flex items-center"),d(t,"class","px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900")},m(y,V){N(y,t,V),b(t,e),b(e,n),b(e,r),b(e,o),b(o,i),b(o,a),b(a,u),b(t,f),b(t,v),b(v,g),ht(p,g,null),w=!0,_||(k=X(g,"click",l[44]),_=!0)},p(y,V){var T;(!w||V[0]&4718596&&!me(n.src,s=((T=y[22].find(y[43]))==null?void 0:T.imageUrl)??(y[19].language==="dg-DG"?"/doge.png":`${Me}/static/favicon.png`)))&&d(n,"src",s),(!w||V[0]&4)&&c!==(c=y[2].name+"")&&Et(u,c)},i(y){w||(q(p.$$.fragment,y),w=!0)},o(y){G(p.$$.fragment,y),w=!1},d(y){y&&m(t),gt(p),_=!1,k()}}}function pl(l){let t,e=te(l[3]),n=[];for(let s=0;s<e.length;s+=1)n[s]=_l(dl(l,e,s));return{c(){t=M("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);for(let o=0;o<n.length;o+=1)n[o].l(r);r.forEach(m),this.h()},h(){d(t,"class","mx-2 mt-2 mb-1 flex flex-wrap gap-2")},m(s,r){N(s,t,r);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(t,null)},p(s,r){if(r[0]&524296){e=te(s[3]);let o;for(o=0;o<e.length;o+=1){const i=dl(s,e,o);n[o]?n[o].p(i,r):(n[o]=_l(i),n[o].c(),n[o].m(t,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=e.length}},d(s){s&&m(t),Ee(n,s)}}}function Es(l){var g;let t,e,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z"></path><path d="M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z"></path></svg>',s,r,o,i=(((g=l[66])==null?void 0:g.title)??`#${l[66].name}`)+"",a,c,u,f=l[19].t("Collection")+"",v;return{c(){t=M("div"),e=M("div"),e.innerHTML=n,s=Q(),r=M("div"),o=M("div"),a=at(i),c=Q(),u=M("div"),v=at(f),this.h()},l(p){t=C(p,"DIV",{class:!0});var w=E(t);e=C(w,"DIV",{class:!0,"data-svelte-h":!0}),Qt(e)!=="svelte-2wa7ie"&&(e.innerHTML=n),s=K(w),r=C(w,"DIV",{class:!0});var _=E(r);o=C(_,"DIV",{class:!0});var k=E(o);a=ct(k,i),k.forEach(m),c=K(_),u=C(_,"DIV",{class:!0});var y=E(u);v=ct(y,f),y.forEach(m),_.forEach(m),w.forEach(m),this.h()},h(){d(e,"class","p-2.5 bg-red-400 text-white rounded-lg"),d(o,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),d(u,"class","text-gray-500 text-sm"),d(r,"class","flex flex-col justify-center -space-y-0.5"),d(t,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(p,w){N(p,t,w),b(t,e),b(t,s),b(t,r),b(r,o),b(o,a),b(r,c),b(r,u),b(u,v)},p(p,w){var _;w[0]&8&&i!==(i=(((_=p[66])==null?void 0:_.title)??`#${p[66].name}`)+"")&&Et(a,i),w[0]&524288&&f!==(f=p[19].t("Collection")+"")&&Et(v,f)},d(p){p&&m(t)}}}function Is(l){let t,e,n,s,r,o=l[66].name+"",i,a,c,u=l[19].t("Document")+"",f;function v(w,_){return w[66].upload_status?Cs:Ms}let g=v(l),p=g(l);return{c(){t=M("div"),e=M("div"),p.c(),n=Q(),s=M("div"),r=M("div"),i=at(o),a=Q(),c=M("div"),f=at(u),this.h()},l(w){t=C(w,"DIV",{class:!0});var _=E(t);e=C(_,"DIV",{class:!0});var k=E(e);p.l(k),k.forEach(m),n=K(_),s=C(_,"DIV",{class:!0});var y=E(s);r=C(y,"DIV",{class:!0});var V=E(r);i=ct(V,o),V.forEach(m),a=K(y),c=C(y,"DIV",{class:!0});var T=E(c);f=ct(T,u),T.forEach(m),y.forEach(m),_.forEach(m),this.h()},h(){d(e,"class","p-2.5 bg-red-400 text-white rounded-lg"),d(r,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),d(c,"class","text-gray-500 text-sm"),d(s,"class","flex flex-col justify-center -space-y-0.5"),d(t,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(w,_){N(w,t,_),b(t,e),p.m(e,null),b(t,n),b(t,s),b(s,r),b(r,i),b(s,a),b(s,c),b(c,f)},p(w,_){g!==(g=v(w))&&(p.d(1),p=g(w),p&&(p.c(),p.m(e,null))),_[0]&8&&o!==(o=w[66].name+"")&&Et(i,o),_[0]&524288&&u!==(u=w[19].t("Document")+"")&&Et(f,u)},d(w){w&&m(t),p.d()}}}function Ds(l){let t,e;return{c(){t=M("img"),this.h()},l(n){t=C(n,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){me(t.src,e=l[66].url)||d(t,"src",e),d(t,"alt","input"),d(t,"class","h-16 w-16 rounded-xl object-cover")},m(n,s){N(n,t,s)},p(n,s){s[0]&8&&!me(t.src,e=n[66].url)&&d(t,"src",e)},d(n){n&&m(t)}}}function Ms(l){let t,e,n,s,r,o;return{c(){t=pt("svg"),e=pt("style"),n=at(`.spinner_qM83 {
																	animation: spinner_8HQG 1.05s infinite;
																}
																.spinner_oXPr {
																	animation-delay: 0.1s;
																}
																.spinner_ZTLf {
																	animation-delay: 0.2s;
																}
																@keyframes spinner_8HQG {
																	0%,
																	57.14% {
																		animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																		transform: translate(0);
																	}
																	28.57% {
																		animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																		transform: translateY(-6px);
																	}
																	100% {
																		transform: translate(0);
																	}
																}
															`),s=pt("circle"),r=pt("circle"),o=pt("circle"),this.h()},l(i){t=_t(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=E(t);e=_t(a,"style",{});var c=E(e);n=ct(c,`.spinner_qM83 {
																	animation: spinner_8HQG 1.05s infinite;
																}
																.spinner_oXPr {
																	animation-delay: 0.1s;
																}
																.spinner_ZTLf {
																	animation-delay: 0.2s;
																}
																@keyframes spinner_8HQG {
																	0%,
																	57.14% {
																		animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																		transform: translate(0);
																	}
																	28.57% {
																		animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																		transform: translateY(-6px);
																	}
																	100% {
																		transform: translate(0);
																	}
																}
															`),c.forEach(m),s=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(m),r=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(m),o=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(m),a.forEach(m),this.h()},h(){d(s,"class","spinner_qM83"),d(s,"cx","4"),d(s,"cy","12"),d(s,"r","2.5"),d(r,"class","spinner_qM83 spinner_oXPr"),d(r,"cx","12"),d(r,"cy","12"),d(r,"r","2.5"),d(o,"class","spinner_qM83 spinner_ZTLf"),d(o,"cx","20"),d(o,"cy","12"),d(o,"r","2.5"),d(t,"class","w-6 h-6 translate-y-[0.5px]"),d(t,"fill","currentColor"),d(t,"viewBox","0 0 24 24"),d(t,"xmlns","http://www.w3.org/2000/svg")},m(i,a){N(i,t,a),b(t,e),b(e,n),b(t,s),b(t,r),b(t,o)},d(i){i&&m(t)}}}function Cs(l){let t,e,n;return{c(){t=pt("svg"),e=pt("path"),n=pt("path"),this.h()},l(s){t=_t(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=E(t);e=_t(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(m),n=_t(r,"path",{d:!0}),E(n).forEach(m),r.forEach(m),this.h()},h(){d(e,"fill-rule","evenodd"),d(e,"d","M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z"),d(e,"clip-rule","evenodd"),d(n,"d","M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"viewBox","0 0 24 24"),d(t,"fill","currentColor"),d(t,"class","w-6 h-6")},m(s,r){N(s,t,r),b(t,e),b(t,n)},d(s){s&&m(t)}}}function _l(l){let t,e,n,s,r='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',o,i,a;function c(g,p){if(g[66].type==="image")return Ds;if(g[66].type==="doc")return Is;if(g[66].type==="collection")return Es}let u=c(l),f=u&&u(l);function v(){return l[48](l[68])}return{c(){t=M("div"),f&&f.c(),e=Q(),n=M("div"),s=M("button"),s.innerHTML=r,o=Q(),this.h()},l(g){t=C(g,"DIV",{class:!0});var p=E(t);f&&f.l(p),e=K(p),n=C(p,"DIV",{class:!0});var w=E(n);s=C(w,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Qt(s)!=="svelte-1i5njtt"&&(s.innerHTML=r),w.forEach(m),o=K(p),p.forEach(m),this.h()},h(){d(s,"class","bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition"),d(s,"type","button"),d(n,"class","absolute -top-1 -right-1"),d(t,"class","relative group")},m(g,p){N(g,t,p),f&&f.m(t,null),b(t,e),b(t,n),b(n,s),b(t,o),i||(a=X(s,"click",v),i=!0)},p(g,p){l=g,u===(u=c(l))&&f?f.p(l,p):(f&&f.d(1),f=u&&u(l),f&&(f.c(),f.m(t,e)))},d(g){g&&m(t),f&&f.d(),i=!1,a()}}}function vl(l){let t,e,n;return e=new he({props:{content:l[19].t("Upload files"),$$slots:{default:[Ss]},$$scope:{ctx:l}}}),{c(){t=M("div"),dt(e.$$.fragment),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);mt(e.$$.fragment,r),r.forEach(m),this.h()},h(){d(t,"class","self-end mb-2 ml-1")},m(s,r){N(s,t,r),ht(e,t,null),n=!0},p(s,r){const o={};r[0]&524288&&(o.content=s[19].t("Upload files")),r[0]&1024|r[2]&128&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){G(e.$$.fragment,s),n=!1},d(s){s&&m(t),gt(e)}}}function Ss(l){let t,e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-[1.2rem] h-[1.2rem]"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg>',n,s;return{c(){t=M("button"),t.innerHTML=e,this.h()},l(r){t=C(r,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Qt(t)!=="svelte-1nsa5at"&&(t.innerHTML=e),this.h()},h(){d(t,"class","bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"),d(t,"type","button")},m(r,o){N(r,t,o),n||(s=X(t,"click",l[49]),n=!0)},p:zt,d(r){r&&m(t),n=!1,s()}}}function Ts(l){let t,e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',n,s;return{c(){t=M("button"),t.innerHTML=e,this.h()},l(r){t=C(r,"BUTTON",{class:!0,"data-svelte-h":!0}),Qt(t)!=="svelte-1ygp9cw"&&(t.innerHTML=e),this.h()},h(){d(t,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5")},m(r,o){N(r,t,o),n||(s=X(t,"click",function(){ql(l[5])&&l[5].apply(this,arguments)}),n=!0)},p(r,o){l=r},i:zt,o:zt,d(r){r&&m(t),n=!1,s()}}}function Vs(l){let t,e,n,s;return t=new he({props:{content:l[19].t("Record voice"),$$slots:{default:[Os]},$$scope:{ctx:l}}}),n=new he({props:{content:l[19].t("Send message"),$$slots:{default:[Ps]},$$scope:{ctx:l}}}),{c(){dt(t.$$.fragment),e=Q(),dt(n.$$.fragment)},l(r){mt(t.$$.fragment,r),e=K(r),mt(n.$$.fragment,r)},m(r,o){ht(t,r,o),N(r,e,o),ht(n,r,o),s=!0},p(r,o){const i={};o[0]&524288&&(i.content=r[19].t("Record voice")),o[0]&262272|o[2]&128&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o[0]&524288&&(a.content=r[19].t("Send message")),o[0]&1|o[2]&128&&(a.$$scope={dirty:o,ctx:r}),n.$set(a)},i(r){s||(q(t.$$.fragment,r),q(n.$$.fragment,r),s=!0)},o(r){G(t.$$.fragment,r),G(n.$$.fragment,r),s=!1},d(r){r&&m(e),gt(t,r),gt(n,r)}}}function bl(l){let t,e,n;function s(i,a){return i[18]?As:Bs}let r=s(l),o=r(l);return{c(){t=M("button"),o.c(),this.h()},l(i){t=C(i,"BUTTON",{id:!0,class:!0,type:!0});var a=E(t);o.l(a),a.forEach(m),this.h()},h(){d(t,"id","voice-input-button"),d(t,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center"),d(t,"type","button")},m(i,a){N(i,t,a),o.m(t,null),e||(n=X(t,"click",l[57]),e=!0)},p(i,a){r!==(r=s(i))&&(o.d(1),o=r(i),o&&(o.c(),o.m(t,null)))},d(i){i&&m(t),o.d(),e=!1,n()}}}function Bs(l){let t,e,n;return{c(){t=pt("svg"),e=pt("path"),n=pt("path"),this.h()},l(s){t=_t(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=E(t);e=_t(r,"path",{d:!0}),E(e).forEach(m),n=_t(r,"path",{d:!0}),E(n).forEach(m),r.forEach(m),this.h()},h(){d(e,"d","M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"),d(n,"d","M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"viewBox","0 0 20 20"),d(t,"fill","currentColor"),d(t,"class","w-5 h-5 translate-y-[0.5px]")},m(s,r){N(s,t,r),b(t,e),b(t,n)},d(s){s&&m(t)}}}function As(l){let t,e,n,s,r,o;return{c(){t=pt("svg"),e=pt("style"),n=at(`.spinner_qM83 {
																animation: spinner_8HQG 1.05s infinite;
															}
															.spinner_oXPr {
																animation-delay: 0.1s;
															}
															.spinner_ZTLf {
																animation-delay: 0.2s;
															}
															@keyframes spinner_8HQG {
																0%,
																57.14% {
																	animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																	transform: translate(0);
																}
																28.57% {
																	animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																	transform: translateY(-6px);
																}
																100% {
																	transform: translate(0);
																}
															}
														`),s=pt("circle"),r=pt("circle"),o=pt("circle"),this.h()},l(i){t=_t(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=E(t);e=_t(a,"style",{});var c=E(e);n=ct(c,`.spinner_qM83 {
																animation: spinner_8HQG 1.05s infinite;
															}
															.spinner_oXPr {
																animation-delay: 0.1s;
															}
															.spinner_ZTLf {
																animation-delay: 0.2s;
															}
															@keyframes spinner_8HQG {
																0%,
																57.14% {
																	animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																	transform: translate(0);
																}
																28.57% {
																	animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																	transform: translateY(-6px);
																}
																100% {
																	transform: translate(0);
																}
															}
														`),c.forEach(m),s=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(m),r=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(m),o=_t(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(m),a.forEach(m),this.h()},h(){d(s,"class","spinner_qM83"),d(s,"cx","4"),d(s,"cy","12"),d(s,"r","2.5"),d(r,"class","spinner_qM83 spinner_oXPr"),d(r,"cx","12"),d(r,"cy","12"),d(r,"r","2.5"),d(o,"class","spinner_qM83 spinner_ZTLf"),d(o,"cx","20"),d(o,"cy","12"),d(o,"r","2.5"),d(t,"class","w-5 h-5 translate-y-[0.5px]"),d(t,"fill","currentColor"),d(t,"viewBox","0 0 24 24"),d(t,"xmlns","http://www.w3.org/2000/svg")},m(i,a){N(i,t,a),b(t,e),b(e,n),b(t,s),b(t,r),b(t,o)},d(i){i&&m(t)}}}function Os(l){let t,e=l[7]&&bl(l);return{c(){e&&e.c(),t=Ut()},l(n){e&&e.l(n),t=Ut()},m(n,s){e&&e.m(n,s),N(n,t,s)},p(n,s){n[7]?e?e.p(n,s):(e=bl(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(n){n&&m(t),e&&e.d(n)}}}function Ps(l){let t,e,n,s,r;return{c(){t=M("button"),e=pt("svg"),n=pt("path"),this.h()},l(o){t=C(o,"BUTTON",{id:!0,class:!0,type:!0});var i=E(t);e=_t(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(e);n=_t(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(n).forEach(m),a.forEach(m),i.forEach(m),this.h()},h(){d(n,"fill-rule","evenodd"),d(n,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),d(n,"clip-rule","evenodd"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"viewBox","0 0 16 16"),d(e,"fill","currentColor"),d(e,"class","w-5 h-5"),d(t,"id","send-message-button"),d(t,"class",s=(l[0]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 self-center"),d(t,"type","submit"),t.disabled=r=l[0]===""},m(o,i){N(o,t,i),b(t,e),b(e,n)},p(o,i){i[0]&1&&s!==(s=(o[0]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 self-center")&&d(t,"class",s),i[0]&1&&r!==(r=o[0]==="")&&(t.disabled=r)},d(o){o&&m(t)}}}function Ls(l){let t,e,n,s,r,o,i,a,c,u,f,v,g,p,w,_,k,y,V,T,Z,I,U,B,O,$,H,R,A,ot,Ht,bt,Vt,Ot,ut,wt,Bt,jt,j,et=l[19].t("LLMs can make mistakes. Verify important information.")+"",P,It,Dt,Kt,ae,kt=l[15]&&ml(l),Tt=l[1]===!1&&l[8].length>0&&hl(l);const ce=[ys,ks],Ft=[];function ue(S,J){return J[0]&1&&(c=null),J[0]&1&&(u=null),c==null&&(c=S[0].charAt(0)==="/"),c?0:(u==null&&(u=S[0].charAt(0)==="#"),u?1:-1)}~(f=ue(l,[-1,-1,-1]))&&(v=Ft[f]=ce[f](l));function _e(S){l[39](S)}function ve(S){l[40](S)}function be(S){l[41](S)}let re={messages:l[8]};l[0]!==void 0&&(re.prompt=l[0]),l[16]!==void 0&&(re.user=l[16]),l[17]!==void 0&&(re.chatInputPlaceholder=l[17]),p=new _s({props:re}),l[38](p),it.push(()=>Nt(p,"prompt",_e)),it.push(()=>Nt(p,"user",ve)),it.push(()=>Nt(p,"chatInputPlaceholder",be)),p.$on("select",l[42]);let yt=l[2]!==""&&gl(l),D=l[3].length>0&&pl(l),z=l[6]&&vl(l);const lt=[Vs,Ts],nt=[];function F(S,J){return J[0]&256&&(Ot=null),Ot==null&&(Ot=S[8].length==0||S[8].at(-1).done==!0),Ot?0:1}return ut=F(l,[-1,-1,-1]),wt=nt[ut]=lt[ut](l),{c(){kt&&kt.c(),t=Q(),e=M("div"),n=M("div"),s=M("div"),r=M("div"),o=M("div"),Tt&&Tt.c(),i=Q(),a=M("div"),v&&v.c(),g=Q(),dt(p.$$.fragment),y=Q(),yt&&yt.c(),V=Q(),T=M("div"),Z=M("div"),I=M("div"),U=M("input"),B=Q(),O=M("form"),D&&D.c(),$=Q(),H=M("div"),z&&z.c(),R=Q(),A=M("textarea"),bt=Q(),Vt=M("div"),wt.c(),jt=Q(),j=M("div"),P=at(et),this.h()},l(S){kt&&kt.l(S),t=K(S),e=C(S,"DIV",{class:!0});var J=E(e);n=C(J,"DIV",{class:!0});var Mt=E(n);s=C(Mt,"DIV",{class:!0});var rt=E(s);r=C(rt,"DIV",{class:!0});var Ct=E(r);o=C(Ct,"DIV",{class:!0});var St=E(o);Tt&&Tt.l(St),St.forEach(m),i=K(Ct),a=C(Ct,"DIV",{class:!0});var Rt=E(a);v&&v.l(Rt),g=K(Rt),mt(p.$$.fragment,Rt),y=K(Rt),yt&&yt.l(Rt),Rt.forEach(m),Ct.forEach(m),rt.forEach(m),V=K(Mt),T=C(Mt,"DIV",{class:!0});var h=E(T);Z=C(h,"DIV",{class:!0});var Y=E(Z);I=C(Y,"DIV",{class:!0});var x=E(I);U=C(x,"INPUT",{type:!0}),B=K(x),O=C(x,"FORM",{dir:!0,class:!0});var L=E(O);D&&D.l(L),$=K(L),H=C(L,"DIV",{class:!0});var tt=E(H);z&&z.l(tt),R=K(tt),A=C(tt,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),E(A).forEach(m),bt=K(tt),Vt=C(tt,"DIV",{class:!0});var W=E(Vt);wt.l(W),W.forEach(m),tt.forEach(m),L.forEach(m),jt=K(x),j=C(x,"DIV",{class:!0});var At=E(j);P=ct(At,et),At.forEach(m),x.forEach(m),Y.forEach(m),h.forEach(m),Mt.forEach(m),J.forEach(m),this.h()},h(){var S;d(o,"class","relative"),d(a,"class","w-full relative"),d(r,"class","flex flex-col max-w-5xl w-full"),d(s,"class","px-2.5 md:px-16 -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center"),d(U,"type","file"),U.hidden=!0,U.multiple=!0,d(A,"id","chat-textarea"),d(A,"class",ot="scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-3 "+(l[6]?"":" pl-4")+" rounded-xl resize-none h-[48px] svelte-141e0sl"),d(A,"placeholder",Ht=l[17]!==""?l[17]:l[18]?l[19].t("Listening..."):l[19].t("Send a Message")),d(A,"rows","1"),d(Vt,"class","self-end mb-2 flex space-x-1 mr-1"),d(H,"class","flex"),d(O,"dir",Bt=((S=l[20])==null?void 0:S.chatDirection)??"LTR"),d(O,"class","flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100"),d(j,"class","mt-1.5 text-xs text-gray-500 text-center"),d(I,"class","pb-2"),d(Z,"class","max-w-6xl px-2.5 md:px-16 mx-auto inset-x-0"),d(T,"class","bg-white dark:bg-gray-900"),d(n,"class","w-full"),d(e,"class",It="fixed bottom-0 "+(l[21]?"left-0 md:left-[260px]":"left-0")+" right-0")},m(S,J){kt&&kt.m(S,J),N(S,t,J),N(S,e,J),b(e,n),b(n,s),b(s,r),b(r,o),Tt&&Tt.m(o,null),b(r,i),b(r,a),~f&&Ft[f].m(a,null),b(a,g),ht(p,a,null),b(a,y),yt&&yt.m(a,null),b(n,V),b(n,T),b(T,Z),b(Z,I),b(I,U),l[45](U),b(I,B),b(I,O),D&&D.m(O,null),b(O,$),b(O,H),z&&z.m(H,null),b(H,R),b(H,A),l[50](A),Le(A,l[0]),b(H,bt),b(H,Vt),nt[ut].m(Vt,null),b(I,jt),b(I,j),b(j,P),Dt=!0,Kt||(ae=[X(U,"change",l[46]),X(U,"change",l[47]),X(A,"input",l[51]),X(A,"keypress",l[52]),X(A,"keydown",l[53]),X(A,"input",l[54]),X(A,"focus",l[55]),X(A,"paste",l[56]),X(O,"submit",Fl(l[58]))],Kt=!0)},p(S,J){var St;S[15]?kt?(kt.p(S,J),J[0]&32768&&q(kt,1)):(kt=ml(S),kt.c(),q(kt,1),kt.m(t.parentNode,t)):kt&&(qt(),G(kt,1,1,()=>{kt=null}),Wt()),S[1]===!1&&S[8].length>0?Tt?Tt.p(S,J):(Tt=hl(S),Tt.c(),Tt.m(o,null)):Tt&&(Tt.d(1),Tt=null);let Mt=f;f=ue(S,J),f===Mt?~f&&Ft[f].p(S,J):(v&&(qt(),G(Ft[Mt],1,1,()=>{Ft[Mt]=null}),Wt()),~f?(v=Ft[f],v?v.p(S,J):(v=Ft[f]=ce[f](S),v.c()),q(v,1),v.m(a,g)):v=null);const rt={};J[0]&256&&(rt.messages=S[8]),!w&&J[0]&1&&(w=!0,rt.prompt=S[0],Lt(()=>w=!1)),!_&&J[0]&65536&&(_=!0,rt.user=S[16],Lt(()=>_=!1)),!k&&J[0]&131072&&(k=!0,rt.chatInputPlaceholder=S[17],Lt(()=>k=!1)),p.$set(rt),S[2]!==""?yt?(yt.p(S,J),J[0]&4&&q(yt,1)):(yt=gl(S),yt.c(),q(yt,1),yt.m(a,null)):yt&&(qt(),G(yt,1,1,()=>{yt=null}),Wt()),S[3].length>0?D?D.p(S,J):(D=pl(S),D.c(),D.m(O,$)):D&&(D.d(1),D=null),S[6]?z?(z.p(S,J),J[0]&64&&q(z,1)):(z=vl(S),z.c(),q(z,1),z.m(H,R)):z&&(qt(),G(z,1,1,()=>{z=null}),Wt()),(!Dt||J[0]&64&&ot!==(ot="scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-3 "+(S[6]?"":" pl-4")+" rounded-xl resize-none h-[48px] svelte-141e0sl"))&&d(A,"class",ot),(!Dt||J[0]&917504&&Ht!==(Ht=S[17]!==""?S[17]:S[18]?S[19].t("Listening..."):S[19].t("Send a Message")))&&d(A,"placeholder",Ht),J[0]&1&&Le(A,S[0]);let Ct=ut;ut=F(S,J),ut===Ct?nt[ut].p(S,J):(qt(),G(nt[Ct],1,1,()=>{nt[Ct]=null}),Wt(),wt=nt[ut],wt?wt.p(S,J):(wt=nt[ut]=lt[ut](S),wt.c()),q(wt,1),wt.m(Vt,null)),(!Dt||J[0]&1048576&&Bt!==(Bt=((St=S[20])==null?void 0:St.chatDirection)??"LTR"))&&d(O,"dir",Bt),(!Dt||J[0]&524288)&&et!==(et=S[19].t("LLMs can make mistakes. Verify important information.")+"")&&Et(P,et),(!Dt||J[0]&2097152&&It!==(It="fixed bottom-0 "+(S[21]?"left-0 md:left-[260px]":"left-0")+" right-0"))&&d(e,"class",It)},i(S){Dt||(q(kt),q(v),q(p.$$.fragment,S),q(yt),q(z),q(wt),Dt=!0)},o(S){G(kt),G(v),G(p.$$.fragment,S),G(yt),G(z),G(wt),Dt=!1},d(S){S&&(m(t),m(e)),kt&&kt.d(S),Tt&&Tt.d(),~f&&Ft[f].d(),l[38](null),gt(p),yt&&yt.d(),l[45](null),D&&D.d(),z&&z.d(),l[50](null),nt[ut].d(),Kt=!1,oe(ae)}}}function Ns(l,t,e){let n,s,r,o,i;st(l,de,h=>e(20,s=h)),st(l,De,h=>e(21,r=h)),st(l,Pl,h=>e(22,o=h)),st(l,Ll,h=>e(23,i=h));const a=ie("i18n");st(l,a,h=>e(19,n=h));let{submitPrompt:c}=t,{stopResponse:u}=t,{autoScroll:f=!0}=t,{selectedModel:v=""}=t,g,p,w,_,k,y,V=!1,T=null,Z="",{files:I=[]}=t,{fileUploadEnabled:U=!0}=t,{speechRecognitionEnabled:B=!0}=t,{prompt:O=""}=t,{messages:$=[]}=t,H,R,A=[],ot=!1;const Ht=-45,bt=()=>{const h=document.getElementById("messages-container");h.scrollTop=h.scrollHeight},Vt=async()=>{const h=await navigator.mediaDevices.getUserMedia({audio:!0});R=new MediaRecorder(h),R.onstart=()=>{e(18,ot=!0),console.log("Recording started")},R.ondataavailable=Y=>A.push(Y.data),R.onstop=async()=>{e(18,ot=!1),console.log("Recording stopped");const Y=new Blob(A,{type:"audio/wav"}),x=Fe(Y,"recording.wav"),L=await Ye(localStorage.token,x).catch(tt=>(ft.error(tt),null));L&&(e(0,O=L.text),await vt(),g==null||g.focus(),O!==""&&(s==null?void 0:s.speechAutoSend)===!0&&c(O,T)),A=[]},R.start(),Ot(h)},Ot=h=>{const Y=new AudioContext,x=Y.createMediaStreamSource(h),L=Y.createAnalyser();L.minDecibels=Ht,x.connect(L);const tt=L.frequencyBinCount,W=new Uint8Array(tt);let At=Date.now();const Xt=()=>{if(L.getByteFrequencyData(W),W.some(xt=>xt>0)&&(At=Date.now()),ot&&Date.now()-At>3e3){R.stop(),Y.close();return}window.requestAnimationFrame(Xt)};window.requestAnimationFrame(Xt)},ut=()=>{var h;if(ot)H&&H.stop(),R&&R.stop();else if(e(18,ot=!0),((h=s==null?void 0:s.audio)==null?void 0:h.STTEngine)??!1)Vt();else if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){H=new(window.SpeechRecognition||window.webkitSpeechRecognition),H.continuous=!0;const Y=3e3;let x;H.start(),H.onresult=async L=>{clearTimeout(x),console.log(L);const tt=L.results[Object.keys(L.results).length-1][0].transcript;e(0,O=`${O}${tt}`),await vt(),g==null||g.focus(),x=setTimeout(()=>{console.log("Speech recognition turned off due to inactivity."),H.stop()},Y)},H.onend=function(){console.log("recognition ended"),e(18,ot=!1),O!==""&&(s==null?void 0:s.speechAutoSend)===!0&&c(O,T)},H.onerror=function(L){console.log(L),ft.error(n.t("Speech recognition error: {{error}}",{error:L.error})),e(18,ot=!1)}}else ft.error(n.t("SpeechRecognition API is not supported in this browser."))},wt=async h=>{console.log(h);const Y={type:"doc",name:h.name,collection_name:"",upload_status:!1,error:""};try{if(e(3,I=[...I,Y]),["audio/mpeg","audio/wav"].includes(h.type)){const L=await Ye(localStorage.token,h).catch(tt=>(ft.error(tt),null));if(L){console.log(L);const tt=new Blob([L.text],{type:"text/plain"});h=Fe(tt,`${h.name}.txt`)}}const x=await an(localStorage.token,"",h);x&&(Y.upload_status=!0,Y.collection_name=x.collection_name,e(3,I))}catch(x){e(3,I=I.filter(L=>L.name!==h.name)),ft.error(x)}},Bt=async h=>{console.log(h);const Y={type:"doc",name:h,collection_name:"",upload_status:!1,url:h,error:""};try{e(3,I=[...I,Y]);const x=await cn(localStorage.token,"",h);x&&(Y.upload_status=!0,Y.collection_name=x.collection_name,e(3,I))}catch(x){e(3,I=I.filter(L=>L.name!==h)),ft.error(x)}},jt=async h=>{console.log(h);const Y={type:"doc",name:h,collection_name:"",upload_status:!1,url:h,error:""};try{e(3,I=[...I,Y]);const x=await un(localStorage.token,h);x&&(Y.upload_status=!0,Y.collection_name=x.collection_name,e(3,I))}catch(x){e(3,I=I.filter(L=>L.name!==h)),ft.error(x)}};Bl(()=>{window.setTimeout(()=>g==null?void 0:g.focus(),0);const h=document.querySelector("body"),Y=W=>{W.key==="Escape"&&(console.log("Escape"),e(15,V=!1))},x=W=>{W.preventDefault(),e(15,V=!0)},L=()=>{e(15,V=!1)},tt=async W=>{var At,Xt;if(W.preventDefault(),console.log(W),(At=W.dataTransfer)!=null&&At.files){const xt=Array.from((Xt=W.dataTransfer)==null?void 0:Xt.files);xt&&xt.length>0?xt.forEach(Pt=>{if(console.log(Pt,Pt.name.split(".").at(-1)),["image/gif","image/webp","image/jpeg","image/png"].includes(Pt.type)){let we=new FileReader;we.onload=Pe=>{e(3,I=[...I,{type:"image",url:`${Pe.target.result}`}])},we.readAsDataURL(Pt)}else Ue.includes(Pt.type)||He.includes(Pt.name.split(".").at(-1))||ft.error(n.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:Pt.type})),wt(Pt)}):ft.error(n.t("File not found."))}e(15,V=!1)};return window.addEventListener("keydown",Y),h==null||h.addEventListener("dragover",x),h==null||h.addEventListener("drop",tt),h==null||h.addEventListener("dragleave",L),()=>{window.removeEventListener("keydown",Y),h==null||h.removeEventListener("dragover",x),h==null||h.removeEventListener("drop",tt),h==null||h.removeEventListener("dragleave",L)}});const j=()=>{e(1,f=!0),bt()};function et(h){it[h?"unshift":"push"](()=>{w=h,e(11,w)})}function P(h){O=h,e(0,O)}function It(h){it[h?"unshift":"push"](()=>{_=h,e(12,_)})}function Dt(h){O=h,e(0,O)}const Kt=h=>{console.log(h),jt(h.detail)},ae=h=>{console.log(h),Bt(h.detail)},kt=h=>{var Y;console.log(h),e(3,I=[...I,{type:((Y=h==null?void 0:h.detail)==null?void 0:Y.type)??"doc",...h.detail,upload_status:!0}])};function Tt(h){it[h?"unshift":"push"](()=>{k=h,e(13,k)})}function ce(h){O=h,e(0,O)}function Ft(h){T=h,e(16,T)}function ue(h){Z=h,e(17,Z)}const _e=h=>{e(2,v=h.detail),g==null||g.focus()},ve=h=>h.tagName===v.id,be=()=>{e(2,v="")};function re(h){it[h?"unshift":"push"](()=>{p=h,e(10,p)})}function yt(){y=this.files,e(14,y)}const D=async()=>{y&&y.length>0?Array.from(y).forEach(Y=>{if(["image/gif","image/webp","image/jpeg","image/png"].includes(Y.type)){let x=new FileReader;x.onload=L=>{e(3,I=[...I,{type:"image",url:`${L.target.result}`}]),e(14,y=null),e(10,p.value="",p)},x.readAsDataURL(Y)}else Ue.includes(Y.type)||He.includes(Y.name.split(".").at(-1))?(wt(Y),e(10,p.value="",p)):(ft.error(n.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:Y.type})),wt(Y),e(10,p.value="",p))}):ft.error(n.t("File not found."))},z=h=>{I.splice(h,1),e(3,I)},lt=()=>{p.click()};function nt(h){it[h?"unshift":"push"](()=>{g=h,e(9,g),e(0,O)})}function F(){O=this.value,e(0,O)}const S=h=>{(!i||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(h.keyCode==13&&!h.shiftKey&&h.preventDefault(),O!==""&&h.keyCode==13&&!h.shiftKey&&c(O,T))},J=async h=>{var x;const Y=h.ctrlKey||h.metaKey;if(O===""&&Y&&h.key.toLowerCase()==="r"){h.preventDefault(),console.log("regenerate");const L=[...document.getElementsByClassName("regenerate-response-button")].at(-1);L==null||L.click()}if(O===""&&h.key=="ArrowUp"){h.preventDefault();const L=[...document.getElementsByClassName("user-message")].at(-1),tt=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(L),L.scrollIntoView({block:"center"}),tt==null||tt.click()}if(["/","#","@"].includes(O.charAt(0))&&h.key==="ArrowUp"&&(h.preventDefault(),(w||_||k).selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(O.charAt(0))&&h.key==="ArrowDown"&&(h.preventDefault(),(w||_||k).selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(O.charAt(0))&&h.key==="Enter"){h.preventDefault();const L=[...document.getElementsByClassName("selected-command-option-button")].at(-1);L?L==null||L.click():(x=document.getElementById("send-message-button"))==null||x.click()}if(["/","#","@"].includes(O.charAt(0))&&h.key==="Tab"){h.preventDefault();const L=[...document.getElementsByClassName("selected-command-option-button")].at(-1);L==null||L.click()}else if(h.key==="Tab"){const L=Hl(O);if(L.length>0){const tt=L.at(0),W=O;e(0,O=O.substring(0,(tt==null?void 0:tt.endIndex)+1)),await vt(),h.target.scrollTop=h.target.scrollHeight,e(0,O=W),await vt(),h.preventDefault(),h.target.setSelectionRange(tt==null?void 0:tt.startIndex,tt.endIndex+1)}h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px"}h.key==="Escape"&&(console.log("Escape"),e(2,v=""))},Mt=h=>{h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px",e(16,T=null)},rt=h=>{h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px"},Ct=h=>{const Y=h.clipboardData||window.clipboardData;if(Y&&Y.items){for(const x of Y.items)if(x.type.indexOf("image")!==-1){const L=x.getAsFile(),tt=new FileReader;tt.onload=function(W){e(3,I=[...I,{type:"image",url:`${W.target.result}`}])},tt.readAsDataURL(L)}}},St=()=>{ut()},Rt=()=>{c(O,T)};return l.$$set=h=>{"submitPrompt"in h&&e(4,c=h.submitPrompt),"stopResponse"in h&&e(5,u=h.stopResponse),"autoScroll"in h&&e(1,f=h.autoScroll),"selectedModel"in h&&e(2,v=h.selectedModel),"files"in h&&e(3,I=h.files),"fileUploadEnabled"in h&&e(6,U=h.fileUploadEnabled),"speechRecognitionEnabled"in h&&e(7,B=h.speechRecognitionEnabled),"prompt"in h&&e(0,O=h.prompt),"messages"in h&&e(8,$=h.messages)},l.$$.update=()=>{l.$$.dirty[0]&513&&O&&g&&(e(9,g.style.height="",g),e(9,g.style.height=Math.min(g.scrollHeight,200)+"px",g))},[O,f,v,I,c,u,U,B,$,g,p,w,_,k,y,V,T,Z,ot,n,s,r,o,i,a,bt,ut,wt,Bt,jt,j,et,P,It,Dt,Kt,ae,kt,Tt,ce,Ft,ue,_e,ve,be,re,yt,D,z,lt,nt,F,S,J,Mt,rt,Ct,St,Rt]}class Us extends Jt{constructor(t){super(),Zt(this,t,Ns,Ls,Yt,{submitPrompt:4,stopResponse:5,autoScroll:1,selectedModel:2,files:3,fileUploadEnabled:6,speechRecognitionEnabled:7,prompt:0,messages:8},null,[-1,-1,-1])}}function wl(l,t,e){const n=l.slice();return n[13]=t[e],n[14]=t,n[15]=e,n}function Hs(l){let t,e,n;return e=new he({props:{content:l[4].t("Remove Model"),$$slots:{default:[js]},$$scope:{ctx:l}}}),{c(){t=M("div"),dt(e.$$.fragment),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);mt(e.$$.fragment,r),r.forEach(m),this.h()},h(){d(t,"class","self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2")},m(s,r){N(s,t,r),ht(e,t,null),n=!0},p(s,r){const o={};r&16&&(o.content=s[4].t("Remove Model")),r&65539&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){G(e.$$.fragment,s),n=!1},d(s){s&&m(t),gt(e)}}}function Rs(l){let t,e,n;return e=new he({props:{content:l[4].t("Add Model"),$$slots:{default:[zs]},$$scope:{ctx:l}}}),{c(){t=M("div"),dt(e.$$.fragment),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);mt(e.$$.fragment,r),r.forEach(m),this.h()},h(){d(t,"class","self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600")},m(s,r){N(s,t,r),ht(e,t,null),n=!0},p(s,r){const o={};r&16&&(o.content=s[4].t("Add Model")),r&65539&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){G(e.$$.fragment,s),n=!1},d(s){s&&m(t),gt(e)}}}function js(l){let t,e,n,s,r;function o(){return l[10](l[15])}return{c(){t=M("button"),e=pt("svg"),n=pt("path"),this.h()},l(i){t=C(i,"BUTTON",{});var a=E(t);e=_t(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var c=E(e);n=_t(c,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(n).forEach(m),c.forEach(m),a.forEach(m),this.h()},h(){d(n,"stroke-linecap","round"),d(n,"stroke-linejoin","round"),d(n,"d","M19.5 12h-15"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke-width","2"),d(e,"stroke","currentColor"),d(e,"class","size-3.5"),t.disabled=l[1]},m(i,a){N(i,t,a),b(t,e),b(e,n),s||(r=X(t,"click",o),s=!0)},p(i,a){l=i,a&2&&(t.disabled=l[1])},d(i){i&&m(t),s=!1,r()}}}function zs(l){let t,e,n,s,r;return{c(){t=M("button"),e=pt("svg"),n=pt("path"),this.h()},l(o){t=C(o,"BUTTON",{class:!0});var i=E(t);e=_t(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=E(e);n=_t(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(n).forEach(m),a.forEach(m),i.forEach(m),this.h()},h(){d(n,"stroke-linecap","round"),d(n,"stroke-linejoin","round"),d(n,"d","M12 6v12m6-6H6"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke-width","2"),d(e,"stroke","currentColor"),d(e,"class","size-3.5"),d(t,"class",""),t.disabled=l[1]},m(o,i){N(o,t,i),b(t,e),b(e,n),s||(r=X(t,"click",l[9]),s=!0)},p(o,i){i&2&&(t.disabled=o[1])},d(o){o&&m(t),s=!1,r()}}}function kl(l){let t,e,n,s,r,o,i,a,c,u;function f(_){l[8](_,l[13],l[14],l[15])}let v={placeholder:l[4].t("Select a model"),items:l[3].filter(El).map(Il)};l[13]!==void 0&&(v.value=l[13]),s=new vn({props:v}),it.push(()=>Nt(s,"value",f));const g=[Rs,Hs],p=[];function w(_,k){return _[15]===0?0:1}return i=w(l),a=p[i]=g[i](l),{c(){t=M("div"),e=M("div"),n=M("div"),dt(s.$$.fragment),o=Q(),a.c(),c=Q(),this.h()},l(_){t=C(_,"DIV",{class:!0});var k=E(t);e=C(k,"DIV",{class:!0});var y=E(e);n=C(y,"DIV",{class:!0});var V=E(n);mt(s.$$.fragment,V),V.forEach(m),y.forEach(m),o=K(k),a.l(k),c=K(k),k.forEach(m),this.h()},h(){d(n,"class","mr-1 max-w-full"),d(e,"class","overflow-hidden w-full"),d(t,"class","flex w-full max-w-fit")},m(_,k){N(_,t,k),b(t,e),b(e,n),ht(s,n,null),b(t,o),p[i].m(t,null),b(t,c),u=!0},p(_,k){l=_;const y={};k&16&&(y.placeholder=l[4].t("Select a model")),k&8&&(y.items=l[3].filter(El).map(Il)),!r&&k&1&&(r=!0,y.value=l[13],Lt(()=>r=!1)),s.$set(y),a.p(l,k)},i(_){u||(q(s.$$.fragment,_),q(a),u=!0)},o(_){G(s.$$.fragment,_),G(a),u=!1},d(_){_&&m(t),gt(s),p[i].d()}}}function yl(l){let t,e,n=l[4].t("Set as default")+"",s,r,o;return{c(){t=M("div"),e=M("button"),s=at(n),this.h()},l(i){t=C(i,"DIV",{class:!0});var a=E(t);e=C(a,"BUTTON",{});var c=E(e);s=ct(c,n),c.forEach(m),a.forEach(m),this.h()},h(){d(t,"class","text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500")},m(i,a){N(i,t,a),b(t,e),b(e,s),r||(o=X(e,"click",l[7]),r=!0)},p(i,a){a&16&&n!==(n=i[4].t("Set as default")+"")&&Et(s,n)},d(i){i&&m(t),r=!1,o()}}}function Fs(l){let t,e,n,s,r=te(l[0]),o=[];for(let c=0;c<r.length;c+=1)o[c]=kl(wl(l,r,c));const i=c=>G(o[c],1,1,()=>{o[c]=null});let a=l[2]&&!l[5]&&yl(l);return{c(){t=M("div");for(let c=0;c<o.length;c+=1)o[c].c();e=Q(),a&&a.c(),n=Ut(),this.h()},l(c){t=C(c,"DIV",{class:!0});var u=E(t);for(let f=0;f<o.length;f+=1)o[f].l(u);u.forEach(m),e=K(c),a&&a.l(c),n=Ut(),this.h()},h(){d(t,"class","flex flex-col w-full items-center md:items-start")},m(c,u){N(c,t,u);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(t,null);N(c,e,u),a&&a.m(c,u),N(c,n,u),s=!0},p(c,[u]){if(u&27){r=te(c[0]);let f;for(f=0;f<r.length;f+=1){const v=wl(c,r,f);o[f]?(o[f].p(v,u),q(o[f],1)):(o[f]=kl(v),o[f].c(),q(o[f],1),o[f].m(t,null))}for(qt(),f=r.length;f<o.length;f+=1)i(f);Wt()}c[2]&&!c[5]?a?a.p(c,u):(a=yl(c),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(c){if(!s){for(let u=0;u<r.length;u+=1)q(o[u]);s=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)G(o[u]);s=!1},d(c){c&&(m(t),m(e),m(n)),Ee(o,c),a&&a.d(c)}}}const El=l=>l.name!=="hr",Il=l=>({value:l.id,label:l.name,info:l});function qs(l,t,e){let n,s,r,o,i;st(l,Oe,_=>e(3,n=_)),st(l,Nl,_=>e(11,r=_)),st(l,de,_=>e(12,o=_)),st(l,Ll,_=>e(5,i=_));const a=ie("i18n");st(l,a,_=>e(4,s=_));let{selectedModels:c=[""]}=t,{disabled:u=!1}=t,{showSetDefault:f=!0}=t;const v=async()=>{if(c.filter(k=>k==="").length){ft.error(s.t("Choose a model before saving..."));return}de.set({...o,models:c}),localStorage.setItem("settings",JSON.stringify(o)),r.role==="admin"&&(console.log("setting default models globally"),await dn(localStorage.token,c.join(","))),ft.success(s.t("Default model updated"))};function g(_,k,y,V){y[V]=_,e(0,c),e(3,n)}const p=()=>{e(0,c=[...c,""])},w=_=>{c.splice(_,1),e(0,c),e(3,n)};return l.$$set=_=>{"selectedModels"in _&&e(0,c=_.selectedModels),"disabled"in _&&e(1,u=_.disabled),"showSetDefault"in _&&e(2,f=_.showSetDefault)},l.$$.update=()=>{l.$$.dirty&9&&c.length>0&&n.length>0&&e(0,c=c.map(_=>n.map(k=>k.id).includes(_)?_:""))},[c,u,f,n,s,i,a,v,g,p,w]}class Ws extends Jt{constructor(t){super(),Zt(this,t,qs,Fs,Yt,{selectedModels:0,disabled:1,showSetDefault:2})}}function Gs(l){let t;const e=l[9].default,n=ee(e,l,l[14],null);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,r){n&&n.m(s,r),t=!0},p(s,r){n&&n.p&&(!t||r&16384)&&le(n,e,s,s[14],t?se(e,s[14],r,null):ne(s[14]),null)},i(s){t||(q(n,s),t=!0)},o(s){G(n,s),t=!1},d(s){n&&n.d(s)}}}function Ys(l){let t,e,n,s,r=l[3].t("Share")+"",o;return{c(){t=pt("svg"),e=pt("path"),n=Q(),s=M("div"),o=at(r),this.h()},l(i){t=_t(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(t);e=_t(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(m),a.forEach(m),n=K(i),s=C(i,"DIV",{class:!0});var c=E(s);o=ct(c,r),c.forEach(m),this.h()},h(){d(e,"fill-rule","evenodd"),d(e,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),d(e,"clip-rule","evenodd"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"viewBox","0 0 24 24"),d(t,"fill","currentColor"),d(t,"class","size-4"),d(s,"class","flex items-center")},m(i,a){N(i,t,a),b(t,e),N(i,n,a),N(i,s,a),b(s,o)},p(i,a){a&8&&r!==(r=i[3].t("Share")+"")&&Et(o,r)},d(i){i&&(m(t),m(n),m(s))}}}function Js(l){let t,e,n,s,r=l[3].t("Download")+"",o;return{c(){t=pt("svg"),e=pt("path"),n=Q(),s=M("div"),o=at(r),this.h()},l(i){t=_t(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=E(t);e=_t(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(e).forEach(m),a.forEach(m),n=K(i),s=C(i,"DIV",{class:!0});var c=E(s);o=ct(c,r),c.forEach(m),this.h()},h(){d(e,"stroke-linecap","round"),d(e,"stroke-linejoin","round"),d(e,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"fill","none"),d(t,"viewBox","0 0 24 24"),d(t,"stroke-width","1.5"),d(t,"stroke","currentColor"),d(t,"class","size-4"),d(s,"class","flex items-center")},m(i,a){N(i,t,a),b(t,e),N(i,n,a),N(i,s,a),b(s,o)},p(i,a){a&8&&r!==(r=i[3].t("Download")+"")&&Et(o,r)},d(i){i&&(m(t),m(n),m(s))}}}function Zs(l){let t,e=l[3].t("Plain text (.txt)")+"",n;return{c(){t=M("div"),n=at(e),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);n=ct(r,e),r.forEach(m),this.h()},h(){d(t,"class","flex items-center line-clamp-1")},m(s,r){N(s,t,r),b(t,n)},p(s,r){r&8&&e!==(e=s[3].t("Plain text (.txt)")+"")&&Et(n,e)},d(s){s&&m(t)}}}function Xs(l){let t,e=l[3].t("PDF document (.pdf)")+"",n;return{c(){t=M("div"),n=at(e),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=E(t);n=ct(r,e),r.forEach(m),this.h()},h(){d(t,"class","flex items-center line-clamp-1")},m(s,r){N(s,t,r),b(t,n)},p(s,r){r&8&&e!==(e=s[3].t("PDF document (.pdf)")+"")&&Et(n,e)},d(s){s&&m(t)}}}function Qs(l){let t,e,n,s;return t=new Be({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Zs]},$$scope:{ctx:l}}}),t.$on("click",l[11]),n=new Be({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Xs]},$$scope:{ctx:l}}}),n.$on("click",l[12]),{c(){dt(t.$$.fragment),e=Q(),dt(n.$$.fragment)},l(r){mt(t.$$.fragment,r),e=K(r),mt(n.$$.fragment,r)},m(r,o){ht(t,r,o),N(r,e,o),ht(n,r,o),s=!0},p(r,o){const i={};o&16392&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o&16392&&(a.$$scope={dirty:o,ctx:r}),n.$set(a)},i(r){s||(q(t.$$.fragment,r),q(n.$$.fragment,r),s=!0)},o(r){G(t.$$.fragment,r),G(n.$$.fragment,r),s=!1},d(r){r&&m(e),gt(t,r),gt(n,r)}}}function Ks(l){let t,e,n,s;return t=new ts({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Js]},$$scope:{ctx:l}}}),n=new Jn({props:{class:"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:jl,sideOffset:8,$$slots:{default:[Qs]},$$scope:{ctx:l}}}),{c(){dt(t.$$.fragment),e=Q(),dt(n.$$.fragment)},l(r){mt(t.$$.fragment,r),e=K(r),mt(n.$$.fragment,r)},m(r,o){ht(t,r,o),N(r,e,o),ht(n,r,o),s=!0},p(r,o){const i={};o&16392&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o&16392&&(a.$$scope={dirty:o,ctx:r}),n.$set(a)},i(r){s||(q(t.$$.fragment,r),q(n.$$.fragment,r),s=!0)},o(r){G(t.$$.fragment,r),G(n.$$.fragment,r),s=!1},d(r){r&&m(e),gt(t,r),gt(n,r)}}}function xs(l){let t,e,n,s,r,o,i,a,c;return t=new Be({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[Ys]},$$scope:{ctx:l}}}),t.$on("click",l[10]),n=new An({props:{$$slots:{default:[Ks]},$$scope:{ctx:l}}}),a=new hn({props:{chatId:l[1].id}}),{c(){dt(t.$$.fragment),e=Q(),dt(n.$$.fragment),s=Q(),r=M("hr"),o=Q(),i=M("div"),dt(a.$$.fragment),this.h()},l(u){mt(t.$$.fragment,u),e=K(u),mt(n.$$.fragment,u),s=K(u),r=C(u,"HR",{class:!0}),o=K(u),i=C(u,"DIV",{class:!0});var f=E(i);mt(a.$$.fragment,f),f.forEach(m),this.h()},h(){d(r,"class","border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5"),d(i,"class","flex p-1")},m(u,f){ht(t,u,f),N(u,e,f),ht(n,u,f),N(u,s,f),N(u,r,f),N(u,o,f),N(u,i,f),ht(a,i,null),c=!0},p(u,f){const v={};f&16392&&(v.$$scope={dirty:f,ctx:u}),t.$set(v);const g={};f&16392&&(g.$$scope={dirty:f,ctx:u}),n.$set(g);const p={};f&2&&(p.chatId=u[1].id),a.$set(p)},i(u){c||(q(t.$$.fragment,u),q(n.$$.fragment,u),q(a.$$.fragment,u),c=!0)},o(u){G(t.$$.fragment,u),G(n.$$.fragment,u),G(a.$$.fragment,u),c=!1},d(u){u&&(m(e),m(s),m(r),m(o),m(i)),gt(t,u),gt(n,u),gt(a)}}}function $s(l){let t,e,n;return e=new In({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:jl,$$slots:{default:[xs]},$$scope:{ctx:l}}}),{c(){t=M("div"),dt(e.$$.fragment),this.h()},l(s){t=C(s,"DIV",{slot:!0});var r=E(t);mt(e.$$.fragment,r),r.forEach(m),this.h()},h(){d(t,"slot","content")},m(s,r){N(s,t,r),ht(e,t,null),n=!0},p(s,r){const o={};r&16395&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){G(e.$$.fragment,s),n=!1},d(s){s&&m(t),gt(e)}}}function to(l){let t,e;return t=new mn({props:{$$slots:{content:[$s],default:[Gs]},$$scope:{ctx:l}}}),t.$on("change",l[13]),{c(){dt(t.$$.fragment)},l(n){mt(t.$$.fragment,n)},m(n,s){ht(t,n,s),e=!0},p(n,[s]){const r={};s&16395&&(r.$$scope={dirty:s,ctx:n}),t.$set(r)},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){gt(t,n)}}}function eo(l,t,e){let n,{$$slots:s={},$$scope:r}=t;const{saveAs:o}=Mn,i=ie("i18n");st(l,i,V=>e(3,n=V));let{shareEnabled:a=!1}=t,{shareHandler:c}=t,{downloadHandler:u}=t,{chat:f}=t,{onClose:v=()=>{}}=t;const g=async()=>{const V=f.chat;console.log("download",f);const T=V.messages.reduce((I,U,B,O)=>`${I}### ${U.role.toUpperCase()}
${U.content}

`,"");let Z=new Blob([T],{type:"text/plain"});o(Z,`chat-${V.title}.txt`)},p=async()=>{const V=f.chat;console.log("download",f);const T=await Cn(V),Z=window.URL.createObjectURL(T),I=document.createElement("a");I.href=Z,I.download=`chat-${V.title}.pdf`,document.body.appendChild(I),I.click(),document.body.removeChild(I),window.URL.revokeObjectURL(Z)},w=()=>{c()},_=()=>{g()},k=()=>{p()},y=V=>{V.detail===!1&&v()};return l.$$set=V=>{"shareEnabled"in V&&e(7,a=V.shareEnabled),"shareHandler"in V&&e(0,c=V.shareHandler),"downloadHandler"in V&&e(8,u=V.downloadHandler),"chat"in V&&e(1,f=V.chat),"onClose"in V&&e(2,v=V.onClose),"$$scope"in V&&e(14,r=V.$$scope)},[c,f,v,n,i,g,p,a,u,s,w,_,k,y,r]}class lo extends Jt{constructor(t){super(),Zt(this,t,eo,to,Yt,{shareEnabled:7,shareHandler:0,downloadHandler:8,chat:1,onClose:2})}}function Dl(l){let t,e,n;function s(o){l[15](o)}let r={showSetDefault:!l[2]};return l[0]!==void 0&&(r.selectedModels=l[0]),t=new Ws({props:r}),it.push(()=>Nt(t,"selectedModels",s)),{c(){dt(t.$$.fragment)},l(o){mt(t.$$.fragment,o)},m(o,i){ht(t,o,i),n=!0},p(o,i){const a={};i&4&&(a.showSetDefault=!o[2]),!e&&i&1&&(e=!0,a.selectedModels=o[0],Lt(()=>e=!1)),t.$set(a)},i(o){n||(q(t.$$.fragment,o),n=!0)},o(o){G(t.$$.fragment,o),n=!1},d(o){gt(t,o)}}}function Ml(l){let t,e;return t=new lo({props:{chat:l[3],shareEnabled:l[2],shareHandler:l[16],downloadHandler:l[17],$$slots:{default:[no]},$$scope:{ctx:l}}}),{c(){dt(t.$$.fragment)},l(n){mt(t.$$.fragment,n)},m(n,s){ht(t,n,s),e=!0},p(n,s){const r={};s&8&&(r.chat=n[3]),s&4&&(r.shareEnabled=n[2]),s&32&&(r.shareHandler=n[16]),s&64&&(r.downloadHandler=n[17]),s&2097152&&(r.$$scope={dirty:s,ctx:n}),t.$set(r)},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){gt(t,n)}}}function no(l){let t,e='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){t=M("button"),t.innerHTML=e,this.h()},l(n){t=C(n,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),Qt(t)!=="svelte-9m6068"&&(t.innerHTML=e),this.h()},h(){d(t,"class","hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),d(t,"id","chat-context-menu-button")},m(n,s){N(n,t,s)},p:zt,d(n){n&&m(t)}}}function so(l){let t,e,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"></path><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"></path></svg>',s,r,o;return{c(){t=M("button"),e=M("div"),e.innerHTML=n,this.h()},l(i){t=C(i,"BUTTON",{id:!0,class:!0});var a=E(t);e=C(a,"DIV",{class:!0,"data-svelte-h":!0}),Qt(e)!=="svelte-1fcii9y"&&(e.innerHTML=n),a.forEach(m),this.h()},h(){d(e,"class","m-auto self-center"),d(t,"id","new-chat-button"),d(t,"class",s="flex "+(l[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")},m(i,a){N(i,t,a),b(t,e),r||(o=X(t,"click",l[18]),r=!0)},p(i,a){a&256&&s!==(s="flex "+(i[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")&&d(t,"class",s)},d(i){i&&m(t),r=!1,o()}}}function Cl(l){let t,e;return t=new pn({props:{className:"max-w-[200px]",role:l[10].role,$$slots:{default:[oo]},$$scope:{ctx:l}}}),t.$on("show",l[19]),{c(){dt(t.$$.fragment)},l(n){mt(t.$$.fragment,n)},m(n,s){ht(t,n,s),e=!0},p(n,s){const r={};s&1024&&(r.role=n[10].role),s&2098176&&(r.$$scope={dirty:s,ctx:n}),t.$set(r)},i(n){e||(q(t.$$.fragment,n),e=!0)},o(n){G(t.$$.fragment,n),e=!1},d(n){gt(t,n)}}}function oo(l){let t,e,n,s;return{c(){t=M("button"),e=M("div"),n=M("img"),this.h()},l(r){t=C(r,"BUTTON",{class:!0,"aria-label":!0});var o=E(t);e=C(o,"DIV",{class:!0});var i=E(e);n=C(i,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),i.forEach(m),o.forEach(m),this.h()},h(){me(n.src,s=l[10].profile_image_url)||d(n,"src",s),d(n,"class","size-6 object-cover rounded-full"),d(n,"alt","User profile"),d(n,"draggable","false"),d(e,"class","self-center"),d(t,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition"),d(t,"aria-label","User Menu")},m(r,o){N(r,t,o),b(t,e),b(e,n)},p(r,o){o&1024&&!me(n.src,s=r[10].profile_image_url)&&d(n,"src",s)},d(r){r&&m(t)}}}function ro(l){let t,e,n,s,r,o,i,a,c,u,f,v,g,p,w,_,k,y,V,T,Z;function I(H){l[13](H)}let U={chatId:l[7]};l[5]!==void 0&&(U.show=l[5]),t=new gn({props:U}),it.push(()=>Nt(t,"show",I)),u=new Sn({});let B=l[4]&&Dl(l),O=l[2]&&Ml(l);k=new he({props:{content:l[9].t("New Chat"),$$slots:{default:[so]},$$scope:{ctx:l}}});let $=l[10]!==void 0&&Cl(l);return{c(){dt(t.$$.fragment),n=Q(),s=M("nav"),r=M("div"),o=M("div"),i=M("div"),a=M("button"),c=M("div"),dt(u.$$.fragment),v=Q(),g=M("div"),B&&B.c(),p=Q(),w=M("div"),O&&O.c(),_=Q(),dt(k.$$.fragment),y=Q(),$&&$.c(),this.h()},l(H){mt(t.$$.fragment,H),n=K(H),s=C(H,"NAV",{id:!0,class:!0});var R=E(s);r=C(R,"DIV",{class:!0});var A=E(r);o=C(A,"DIV",{class:!0});var ot=E(o);i=C(ot,"DIV",{class:!0});var Ht=E(i);a=C(Ht,"BUTTON",{id:!0,class:!0});var bt=E(a);c=C(bt,"DIV",{class:!0});var Vt=E(c);mt(u.$$.fragment,Vt),Vt.forEach(m),bt.forEach(m),Ht.forEach(m),v=K(ot),g=C(ot,"DIV",{class:!0});var Ot=E(g);B&&B.l(Ot),Ot.forEach(m),p=K(ot),w=C(ot,"DIV",{class:!0});var ut=E(w);O&&O.l(ut),_=K(ut),mt(k.$$.fragment,ut),y=K(ut),$&&$.l(ut),ut.forEach(m),ot.forEach(m),A.forEach(m),R.forEach(m),this.h()},h(){d(c,"class","m-auto self-center"),d(a,"id","sidebar-toggle-button"),d(a,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),d(i,"class",f=(l[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),d(g,"class","flex-1 overflow-hidden max-w-full"),d(w,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),d(o,"class","flex items-center w-full max-w-full"),d(r,"class","flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]"),d(s,"id","nav"),d(s,"class","sticky py-2.5 top-0 flex flex-row justify-center z-30")},m(H,R){ht(t,H,R),N(H,n,R),N(H,s,R),b(s,r),b(r,o),b(o,i),b(i,a),b(a,c),ht(u,c,null),b(o,v),b(o,g),B&&B.m(g,null),b(o,p),b(o,w),O&&O.m(w,null),b(w,_),ht(k,w,null),b(w,y),$&&$.m(w,null),V=!0,T||(Z=X(a,"click",l[14]),T=!0)},p(H,[R]){const A={};R&128&&(A.chatId=H[7]),!e&&R&32&&(e=!0,A.show=H[5],Lt(()=>e=!1)),t.$set(A),(!V||R&256&&f!==(f=(H[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&d(i,"class",f),H[4]?B?(B.p(H,R),R&16&&q(B,1)):(B=Dl(H),B.c(),q(B,1),B.m(g,null)):B&&(qt(),G(B,1,1,()=>{B=null}),Wt()),H[2]?O?(O.p(H,R),R&4&&q(O,1)):(O=Ml(H),O.c(),q(O,1),O.m(w,_)):O&&(qt(),G(O,1,1,()=>{O=null}),Wt());const ot={};R&512&&(ot.content=H[9].t("New Chat")),R&2097410&&(ot.$$scope={dirty:R,ctx:H}),k.$set(ot),H[10]!==void 0?$?($.p(H,R),R&1024&&q($,1)):($=Cl(H),$.c(),q($,1),$.m(w,null)):$&&(qt(),G($,1,1,()=>{$=null}),Wt())},i(H){V||(q(t.$$.fragment,H),q(u.$$.fragment,H),q(B),q(O),q(k.$$.fragment,H),q($),V=!0)},o(H){G(t.$$.fragment,H),G(u.$$.fragment,H),G(B),G(O),G(k.$$.fragment,H),G($),V=!1},d(H){H&&(m(n),m(s)),gt(t,H),gt(u),B&&B.d(),O&&O.d(),gt(k),$&&$.d(),T=!1,Z()}}}function io(l,t,e){let n,s,r,o,i;st(l,Ul,B=>e(20,n=B)),st(l,fe,B=>e(7,s=B)),st(l,De,B=>e(8,r=B)),st(l,Nl,B=>e(10,i=B));const a=ie("i18n");st(l,a,B=>e(9,o=B));let{initNewChat:c}=t,{title:u=n}=t,{shareEnabled:f=!1}=t,{chat:v}=t,{selectedModels:g}=t,{showModelSelector:p=!0}=t,w=!1,_=!1;function k(B){w=B,e(5,w)}const y=()=>{De.set(!r)};function V(B){g=B,e(0,g)}const T=()=>{e(5,w=!w)},Z=()=>{e(6,_=!_)},I=()=>{c()},U=B=>{B.detail==="archived-chat"&&Xl.set(!0)};return l.$$set=B=>{"initNewChat"in B&&e(1,c=B.initNewChat),"title"in B&&e(12,u=B.title),"shareEnabled"in B&&e(2,f=B.shareEnabled),"chat"in B&&e(3,v=B.chat),"selectedModels"in B&&e(0,g=B.selectedModels),"showModelSelector"in B&&e(4,p=B.showModelSelector)},[g,c,f,v,p,w,_,s,r,o,i,a,u,k,y,V,T,Z,I,U]}class ao extends Jt{constructor(t){super(),Zt(this,t,io,ro,Yt,{initNewChat:1,title:12,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function co(l){let t,e,n,s,r,o,i;return a(),{feed:c,reset:a};function a(){t=!0,e="",n=0,s=-1,r=void 0,o=void 0,i=""}function c(f){e=e?e+f:f,t&&uo(e)&&(e=e.slice(zl.length)),t=!1;const v=e.length;let g=0,p=!1;for(;g<v;){p&&(e[g]===`
`&&++g,p=!1);let w=-1,_=s,k;for(let y=n;w<0&&y<v;++y)k=e[y],k===":"&&_<0?_=y-g:k==="\r"?(p=!0,w=y-g):k===`
`&&(w=y-g);if(w<0){n=v-g,s=_;break}else n=0,s=-1;u(e,g,_,w),g+=w+1}g===v?e="":g>0&&(e=e.slice(g))}function u(f,v,g,p){if(p===0){i.length>0&&(l({type:"event",id:r,event:o||void 0,data:i.slice(0,-1)}),i="",r=void 0),o=void 0;return}const w=g<0,_=f.slice(v,v+(w?p:g));let k=0;w?k=p:f[v+g+1]===" "?k=g+2:k=g+1;const y=v+k,V=p-k,T=f.slice(y,y+V).toString();if(_==="data")i+=T?"".concat(T,`
`):`
`;else if(_==="event")o=T;else if(_==="id"&&!T.includes("\0"))r=T;else if(_==="retry"){const Z=parseInt(T,10);Number.isNaN(Z)||l({type:"reconnect-interval",value:Z})}}}const zl=[239,187,191];function uo(l){return zl.every((t,e)=>l.charCodeAt(e)===t)}class fo extends TransformStream{constructor(){let t;super({start(e){t=co(n=>{n.type==="event"&&e.enqueue(n)})},transform(e){t.feed(e)}})}}async function mo(l,t){const e=l.pipeThrough(new TextDecoderStream).pipeThrough(new fo).getReader();let n=ho(e);return t&&(n=go(n)),n}async function*ho(l){var t,e,n;for(;;){const{value:s,done:r}=await l.read();if(r){yield{done:!0,value:""};break}if(!s)continue;const o=s.data;if(o.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const i=JSON.parse(o);if(console.log(i),i.error){yield{done:!0,value:"",error:i.error};break}if(i.citations){yield{done:!1,value:"",citations:i.citations};continue}yield{done:!1,value:((n=(e=(t=i.choices)==null?void 0:t[0])==null?void 0:e.delta)==null?void 0:n.content)??""}}catch(i){console.error("Error extracting delta from SSE event:",i)}}}async function*go(l){for await(const t of l){if(t.done){yield t;return}if(t.citations){yield t;continue}let e=t.value;if(e.length<5){yield{done:!1,value:e};continue}for(;e!="";){const n=Math.min(Math.floor(Math.random()*3)+1,e.length);yield{done:!1,value:e.slice(0,n)},(document==null?void 0:document.visibilityState)!=="hidden"&&await po(5),e=e.slice(n)}}}const po=l=>new Promise(t=>setTimeout(t,l)),{document:Ve}=Gl;function Sl(l){var jt;let t,e,n,s,r,o,i,a,c,u,f,v,g,p,w,_,k,y,V,T,Z,I,U,B;function O(j){l[27](j)}function $(j){l[28](j)}let H={title:l[11],shareEnabled:l[14].length>0,chat:l[10],initNewChat:l[20]};l[1]!==void 0&&(H.selectedModels=l[1]),l[6]!==void 0&&(H.showModelSelector=l[6]),e=new ao({props:H}),it.push(()=>Nt(e,"selectedModels",O)),it.push(()=>Nt(e,"showModelSelector",$));function R(j){l[29](j)}function A(j){l[30](j)}function ot(j){l[31](j)}function Ht(j){l[32](j)}let bt={chatId:l[15],selectedModels:l[1],selectedModelfiles:l[9],processing:vo,bottomPadding:l[13].length>0,suggestionPrompts:l[0]?[]:((jt=l[8])==null?void 0:jt.suggestionPrompts)??l[16].default_prompt_suggestions,sendPrompt:l[22],continueGeneration:l[25],regenerateResponse:l[24]};l[2]!==void 0&&(bt.history=l[2]),l[14]!==void 0&&(bt.messages=l[14]),l[4]!==void 0&&(bt.autoScroll=l[4]),l[12]!==void 0&&(bt.prompt=l[12]),c=new fn({props:bt}),it.push(()=>Nt(c,"history",R)),it.push(()=>Nt(c,"messages",A)),it.push(()=>Nt(c,"autoScroll",ot)),it.push(()=>Nt(c,"prompt",Ht));function Vt(j){l[35](j)}function Ot(j){l[36](j)}function ut(j){l[37](j)}function wt(j){l[38](j)}let Bt={messages:l[14],submitPrompt:l[21],stopResponse:l[23]};return l[13]!==void 0&&(Bt.files=l[13]),l[12]!==void 0&&(Bt.prompt=l[12]),l[4]!==void 0&&(Bt.autoScroll=l[4]),l[7]!==void 0&&(Bt.selectedModel=l[7]),k=new Us({props:Bt}),it.push(()=>Nt(k,"files",Vt)),it.push(()=>Nt(k,"prompt",Ot)),it.push(()=>Nt(k,"autoScroll",ut)),it.push(()=>Nt(k,"selectedModel",wt)),{c(){t=M("div"),dt(e.$$.fragment),r=Q(),o=M("div"),i=M("div"),a=M("div"),dt(c.$$.fragment),_=Q(),dt(k.$$.fragment),this.h()},l(j){t=C(j,"DIV",{class:!0});var et=E(t);mt(e.$$.fragment,et),r=K(et),o=C(et,"DIV",{class:!0});var P=E(o);i=C(P,"DIV",{class:!0,id:!0});var It=E(i);a=C(It,"DIV",{class:!0});var Dt=E(a);mt(c.$$.fragment,Dt),Dt.forEach(m),It.forEach(m),P.forEach(m),et.forEach(m),_=K(j),mt(k.$$.fragment,j),this.h()},h(){d(a,"class",p="h-full w-full flex flex-col "+(l[0]?"py-4":"pt-2 pb-4")),d(i,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full"),d(i,"id","messages-container"),d(o,"class","flex flex-col flex-auto"),d(t,"class",w="min-h-screen max-h-screen "+(l[18]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col")},m(j,et){N(j,t,et),ht(e,t,null),b(t,r),b(t,o),b(o,i),b(i,a),ht(c,a,null),l[33](i),N(j,_,et),ht(k,j,et),I=!0,U||(B=X(i,"scroll",l[34]),U=!0)},p(j,et){var Kt;const P={};et[0]&2048&&(P.title=j[11]),et[0]&16384&&(P.shareEnabled=j[14].length>0),et[0]&1024&&(P.chat=j[10]),!n&&et[0]&2&&(n=!0,P.selectedModels=j[1],Lt(()=>n=!1)),!s&&et[0]&64&&(s=!0,P.showModelSelector=j[6],Lt(()=>s=!1)),e.$set(P);const It={};et[0]&32768&&(It.chatId=j[15]),et[0]&2&&(It.selectedModels=j[1]),et[0]&512&&(It.selectedModelfiles=j[9]),et[0]&8192&&(It.bottomPadding=j[13].length>0),et[0]&65793&&(It.suggestionPrompts=j[0]?[]:((Kt=j[8])==null?void 0:Kt.suggestionPrompts)??j[16].default_prompt_suggestions),!u&&et[0]&4&&(u=!0,It.history=j[2],Lt(()=>u=!1)),!f&&et[0]&16384&&(f=!0,It.messages=j[14],Lt(()=>f=!1)),!v&&et[0]&16&&(v=!0,It.autoScroll=j[4],Lt(()=>v=!1)),!g&&et[0]&4096&&(g=!0,It.prompt=j[12],Lt(()=>g=!1)),c.$set(It),(!I||et[0]&1&&p!==(p="h-full w-full flex flex-col "+(j[0]?"py-4":"pt-2 pb-4")))&&d(a,"class",p),(!I||et[0]&262144&&w!==(w="min-h-screen max-h-screen "+(j[18]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col"))&&d(t,"class",w);const Dt={};et[0]&16384&&(Dt.messages=j[14]),!y&&et[0]&8192&&(y=!0,Dt.files=j[13],Lt(()=>y=!1)),!V&&et[0]&4096&&(V=!0,Dt.prompt=j[12],Lt(()=>V=!1)),!T&&et[0]&16&&(T=!0,Dt.autoScroll=j[4],Lt(()=>T=!1)),!Z&&et[0]&128&&(Z=!0,Dt.selectedModel=j[7],Lt(()=>Z=!1)),k.$set(Dt)},i(j){I||(q(e.$$.fragment,j),q(c.$$.fragment,j),q(k.$$.fragment,j),I=!0)},o(j){G(e.$$.fragment,j),G(c.$$.fragment,j),G(k.$$.fragment,j),I=!1},d(j){j&&(m(t),m(_)),gt(e),gt(c),l[33](null),gt(k,j),U=!1,B()}}}function _o(l){let t,e,n,s;Ve.title=t=`
		`+(l[11]?`${l[11].length>30?`${l[11].slice(0,30)}...`:l[11]} | ${l[17]}`:`${l[17]}`)+`
	`;let r=(!l[0]||l[3]&&l[0])&&Sl(l);return{c(){e=Q(),r&&r.c(),n=Ut()},l(o){Wl("svelte-1123lr8",Ve.head).forEach(m),e=K(o),r&&r.l(o),n=Ut()},m(o,i){N(o,e,i),r&&r.m(o,i),N(o,n,i),s=!0},p(o,i){(!s||i[0]&133120)&&t!==(t=`
		`+(o[11]?`${o[11].length>30?`${o[11].slice(0,30)}...`:o[11]} | ${o[17]}`:`${o[17]}`)+`
	`)&&(Ve.title=t),!o[0]||o[3]&&o[0]?r?(r.p(o,i),i[0]&9&&q(r,1)):(r=Sl(o),r.c(),q(r,1),r.m(n.parentNode,n)):r&&(qt(),G(r,1,1,()=>{r=null}),Wt())},i(o){s||(q(r),s=!0)},o(o){G(r),s=!1},d(o){o&&(m(e),m(n)),r&&r.d(o)}}}let vo="";function bo(l,t,e){let n,s,r,o,i,a,c,u,f;st(l,fe,D=>e(15,n=D)),st(l,de,D=>e(42,s=D)),st(l,Oe,D=>e(44,o=D)),st(l,Yl,D=>e(45,i=D)),st(l,Ql,D=>e(16,a=D)),st(l,Pl,D=>e(26,c=D)),st(l,Ul,D=>e(17,u=D)),st(l,De,D=>e(18,f=D));const v=ie("i18n");st(l,v,D=>e(43,r=D));let{chatIdProp:g=""}=t,p=!1,w=!1,_=!0,k,y=null,V=!0,T=[""],Z="",I=null,U={},B=null,O="",$="",H=[],R=[],A={messages:{},currentId:null};Bl(async()=>{n?(s.saveChatHistory??!0)||await Ce("/"):await ot()});const ot=async()=>{var lt;y!==null&&(await Ge(localStorage.token,y),y=null),window.history.replaceState(A.state,"","/"),await fe.set(""),e(4,_=!0),e(11,O=""),e(14,R=[]),e(2,A={messages:{},currentId:null}),i.url.searchParams.get("models")?e(1,T=(lt=i.url.searchParams.get("models"))==null?void 0:lt.split(",")):s!=null&&s.models?e(1,T=s==null?void 0:s.models):a!=null&&a.default_models?e(1,T=a==null?void 0:a.default_models.split(",")):e(1,T=[""]),i.url.searchParams.get("q")&&(e(12,$=i.url.searchParams.get("q")??""),$&&(await vt(),Vt($))),e(1,T=T.map(nt=>o.map(F=>F.id).includes(nt)?nt:""));let D=JSON.parse(localStorage.getItem("settings")??"{}");de.set({...D});const z=document.getElementById("chat-textarea");setTimeout(()=>z==null?void 0:z.focus(),0)},Ht=async()=>{if(fe.set(g),e(10,B=await sn(localStorage.token,n).catch(async D=>(await Ce("/"),null))),B){await Dt();const D=B.chat;if(D){console.log(D),e(1,T=((D==null?void 0:D.models)??void 0)!==void 0?D.models:[D.models??""]),e(2,A=((D==null?void 0:D.history)??void 0)!==void 0?D.history:en(D.messages)),e(11,O=D.title);let z=JSON.parse(localStorage.getItem("settings")??"{}");return await de.set({...z,system:D.system??z.system,options:D.options??z.options}),e(4,_=!0),await vt(),R.length>0&&e(2,A.messages[R.at(-1).id].done=!0,A),await vt(),!0}else return null}},bt=async()=>{await vt(),k&&e(5,k.scrollTop=k.scrollHeight,k)},Vt=async(D,z=null)=>{if(console.log("submitPrompt",n),e(1,T=T.map(lt=>o.map(nt=>nt.id).includes(lt)?lt:"")),T.includes(""))ft.error(r.t("Model not selected"));else if(R.length!=0&&R.at(-1).done!=!0)console.log("wait");else if(H.length>0&&H.filter(lt=>lt.upload_status===!1).length>0)ft.error(r.t("Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready."));else{document.getElementById("chat-textarea").style.height="";let lt=qe(),nt={id:lt,parentId:R.length!==0?R.at(-1).id:null,childrenIds:[],role:"user",user:z??void 0,content:D,files:H.length>0?H:void 0,timestamp:Math.floor(Date.now()/1e3),models:T.filter((F,S)=>T.indexOf(F)===S)};e(2,A.messages[lt]=nt,A),e(2,A.currentId=lt,A),R.length!==0&&A.messages[R.at(-1).id].childrenIds.push(lt),await vt(),R.length==1&&(s.saveChatHistory??!0?(e(10,B=await nn(localStorage.token,{id:n,title:r.t("New Chat"),models:T,system:s.system??void 0,options:{...s.options??{}},messages:R,history:A,tags:[],timestamp:Date.now()})),await ke.set(await ye(localStorage.token)),await fe.set(B.id)):await fe.set("local"),await vt()),e(12,$=""),e(13,H=[]),await Ot(D,lt)}},Ot=async(D,z,lt=null)=>{const nt=JSON.parse(JSON.stringify(n));await Promise.all((lt?[lt]:Z!==""?[Z.id]:T).map(async F=>{console.log("modelId",F);const S=o.filter(J=>J.id===F).at(0);if(S){let J=qe(),Mt={parentId:z,id:J,childrenIds:[],role:"assistant",content:"",model:S.id,userContext:null,timestamp:Math.floor(Date.now()/1e3)};e(2,A.messages[J]=Mt,A),e(2,A.currentId=J,A),z!==null&&e(2,A.messages[z].childrenIds=[...A.messages[z].childrenIds,J],A),await vt();let rt=null;if(((s==null?void 0:s.memory)??!1)&&rt===null){const Ct=await _n(localStorage.token,D).catch(St=>(ft.error(St),null));Ct&&(Ct.documents[0].length>0&&(rt=Ct.documents.reduce((St,Rt,h)=>{const Y=Ct.metadatas[h][0].created_at,x=new Date(Y*1e3).toISOString().split("T")[0];return St.push(`${h+1}. [${x}]. ${Rt[0]}`),St},[])),console.log(rt))}Mt.userContext=rt,S!=null&&S.external?await wt(S,D,J,nt):S&&await ut(S,D,J,nt)}else ft.error(r.t("Model {{modelId}} not found",{modelId:F}))})),await ke.set(await ye(localStorage.token))},ut=async(D,z,lt,nt)=>{var St,Rt;D=D.id;const F=A.messages[lt];await vt(),bt();const S=[s.system||((F==null?void 0:F.userContext)??null)?{role:"system",content:`${(s==null?void 0:s.system)??""}${(F==null?void 0:F.userContext)??null?`

User Context:
${((F==null?void 0:F.userContext)??[]).join(`
`)}`:""}`}:void 0,...R].filter(h=>h).filter(h=>h.content!="").map((h,Y,x)=>{var W;const L={role:h.role,content:x.length-2!==Y?h.content:(h==null?void 0:h.raContent)??h.content},tt=(W=h.files)==null?void 0:W.filter(At=>At.type==="image").map(At=>At.url.slice(At.url.indexOf(",")+1));return tt&&tt.length>0&&h.role==="user"&&(L.images=tt),L});let J=-1;S.forEach((h,Y)=>{h.images&&(J=Y)}),S.forEach((h,Y)=>{Y!==J&&delete h.images});const Mt=R.filter(h=>(h==null?void 0:h.files)??null).map(h=>h.files.filter(Y=>Y.type==="doc"||Y.type==="collection")).flat(1),[rt,Ct]=await ln(localStorage.token,{model:D,messages:S,options:{...s.options??{},stop:((St=s==null?void 0:s.options)==null?void 0:St.stop)??void 0?s.options.stop.map(h=>decodeURIComponent(JSON.parse('"'+h.replace(/\"/g,'\\"')+'"'))):void 0},format:s.requestFormat??void 0,keep_alive:s.keepAlive??void 0,docs:Mt.length>0?Mt:void 0,citations:Mt.length>0});if(rt&&rt.ok){console.log("controller",Ct);const h=rt.body.pipeThrough(new TextDecoderStream).pipeThrough(xl(`
`)).getReader();for(;;){const{value:Y,done:x}=await h.read();if(x||w||nt!==n){F.done=!0,e(14,R),e(2,A),w&&(Ct.abort("User: Stop Response"),await Ge(localStorage.token,y)),y=null;break}try{let L=Y.split(`
`);for(const tt of L)if(tt!==""){console.log(tt);let W=JSON.parse(tt);if("citations"in W){F.citations=W.citations;continue}if("detail"in W)throw W;if("id"in W)console.log(W),y=W.id;else if(W.done==!1){if(F.content==""&&W.message.content==`
`)continue;F.content+=W.message.content,e(14,R),e(2,A)}else{if(F.done=!0,F.content==""&&(F.error=!0,F.content="Oops! No text generated from Ollama, Please try again."),F.context=W.context??null,F.info={total_duration:W.total_duration,load_duration:W.load_duration,sample_count:W.sample_count,sample_duration:W.sample_duration,prompt_eval_count:W.prompt_eval_count,prompt_eval_duration:W.prompt_eval_duration,eval_count:W.eval_count,eval_duration:W.eval_duration},e(14,R),e(2,A),s.notificationEnabled&&!document.hasFocus()){const At=new Notification(I?`${I.title.charAt(0).toUpperCase()+I.title.slice(1)}`:`${D}`,{body:F.content,icon:(I==null?void 0:I.imageUrl)??`${Me}/static/favicon.png`})}s.responseAutoCopy&&We(F.content),s.responseAutoPlayback&&(await vt(),(Rt=document.getElementById(`speak-button-${F.id}`))==null||Rt.click())}}}catch(L){console.log(L),"detail"in L&&ft.error(L.detail);break}_&&bt()}n==nt&&(s.saveChatHistory??!0)&&(e(10,B=await Te(localStorage.token,nt,{messages:R,history:A})),await ke.set(await ye(localStorage.token)))}else{if(rt!==null){const h=await rt.json();console.log(h),"detail"in h?(ft.error(h.detail),F.content=h.detail):(ft.error(h.error),F.content=h.error)}else ft.error(r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})),F.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"});F.error=!0,F.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"}),F.done=!0,e(14,R),e(2,A)}if(w=!1,await vt(),_&&bt(),R.length==2&&R.at(1).content!==""){window.history.replaceState(A.state,"",`/c/${nt}`);const h=await P(z);await It(nt,h)}},wt=async(D,z,lt,nt)=>{var J,Mt,rt,Ct,St,Rt,h,Y,x;const F=A.messages[lt],S=R.filter(L=>(L==null?void 0:L.files)??null).map(L=>L.files.filter(tt=>tt.type==="doc"||tt.type==="collection")).flat(1);console.log(S),bt();try{const[L,tt]=await $l(localStorage.token,{model:D.id,stream:!0,messages:[s.system||((F==null?void 0:F.userContext)??null)?{role:"system",content:`${(s==null?void 0:s.system)??""}${(F==null?void 0:F.userContext)??null?`

User Context:
${((F==null?void 0:F.userContext)??[]).join(`
`)}`:""}`}:void 0,...R].filter(W=>W).filter(W=>W.content!="").map((W,At,Xt)=>{var xt;return{role:W.role,...((xt=W.files)==null?void 0:xt.filter(Pt=>Pt.type==="image").length)>0&&W.role==="user"?{content:[{type:"text",text:Xt.length-1!==At?W.content:(W==null?void 0:W.raContent)??W.content},...W.files.filter(Pt=>Pt.type==="image").map(Pt=>({type:"image_url",image_url:{url:Pt.url}}))]}:{content:Xt.length-1!==At?W.content:(W==null?void 0:W.raContent)??W.content}}}),seed:((J=s==null?void 0:s.options)==null?void 0:J.seed)??void 0,stop:((Mt=s==null?void 0:s.options)==null?void 0:Mt.stop)??void 0?s.options.stop.map(W=>decodeURIComponent(JSON.parse('"'+W.replace(/\"/g,'\\"')+'"'))):void 0,temperature:((rt=s==null?void 0:s.options)==null?void 0:rt.temperature)??void 0,top_p:((Ct=s==null?void 0:s.options)==null?void 0:Ct.top_p)??void 0,num_ctx:((St=s==null?void 0:s.options)==null?void 0:St.num_ctx)??void 0,frequency_penalty:((Rt=s==null?void 0:s.options)==null?void 0:Rt.repeat_penalty)??void 0,max_tokens:((h=s==null?void 0:s.options)==null?void 0:h.num_predict)??void 0,docs:S.length>0?S:void 0,citations:S.length>0},((Y=D==null?void 0:D.source)==null?void 0:Y.toLowerCase())==="litellm"?`${Re}/v1`:`${je}`);if(await vt(),bt(),L&&L.ok&&L.body){const W=await mo(L.body,s.splitLargeChunks);for await(const At of W){const{value:Xt,done:xt,citations:Pt,error:we}=At;if(we){await Bt(we,null,D,F);break}if(xt||w||nt!==n){F.done=!0,e(14,R),e(2,A),w&&tt.abort("User: Stop Response");break}if(Pt){F.citations=Pt;continue}if(!(F.content==""&&Xt==`
`)){if(F.content+=Xt,e(14,R),e(2,A),s.notificationEnabled&&!document.hasFocus()){const Pe=new Notification(`OpenAI ${D}`,{body:F.content,icon:`${Me}/static/favicon.png`})}s.responseAutoCopy&&We(F.content),s.responseAutoPlayback&&(await vt(),(x=document.getElementById(`speak-button-${F.id}`))==null||x.click()),_&&bt()}}n==nt&&(s.saveChatHistory??!0)&&(e(10,B=await Te(localStorage.token,nt,{messages:R,history:A})),await ke.set(await ye(localStorage.token)))}else await Bt(null,L,D,F)}catch(L){await Bt(L,null,D,F)}if(e(14,R),e(2,A),w=!1,await vt(),_&&bt(),R.length==2){window.history.replaceState(A.state,"",`/c/${nt}`);const L=await P(z);await It(nt,L)}},Bt=async(D,z,lt,nt)=>{let F="",S;D?S=D:z!==null&&(S=await z.json()),console.error(S),"detail"in S?(ft.error(S.detail),F=S.detail):"error"in S?"message"in S.error?(ft.error(S.error.message),F=S.error.message):(ft.error(S.error),F=S.error):"message"in S&&(ft.error(S.message),F=S.message),nt.error=!0,nt.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:lt.name??lt.id})+`
`+F,nt.done=!0,e(14,R),e(2,A)},jt=()=>{w=!0,console.log("stopResponse")},j=async D=>{if(console.log("regenerateResponse"),R.length!=0){let z=A.messages[D.parentId],lt=z.content;((z==null?void 0:z.models)??[...T]).length==1?await Ot(lt,z.id):await Ot(lt,z.id,D.model)}},et=async()=>{console.log("continueGeneration");const D=JSON.parse(JSON.stringify(n));if(R.length!=0&&R.at(-1).done==!0){const z=A.messages[A.currentId];z.done=!1,await vt();const lt=o.filter(nt=>nt.id===z.model).at(0);lt&&(lt!=null&&lt.external?await wt(lt,A.messages[z.parentId].content,z.id,D):await ut(lt,A.messages[z.parentId].content,z.id,D))}else ft.error(r.t("Model {{modelId}} not found",{modelId}))},P=async D=>{var z,lt,nt,F,S;if(((z=s==null?void 0:s.title)==null?void 0:z.auto)??!0){const J=o.find(St=>St.id===T[0]),Mt=(J==null?void 0:J.external)??!1?((lt=s==null?void 0:s.title)==null?void 0:lt.modelExternal)??T[0]:((nt=s==null?void 0:s.title)==null?void 0:nt.model)??T[0],rt=o.find(St=>St.id===Mt);return console.log(rt),await tn(localStorage.token,((F=s==null?void 0:s.title)==null?void 0:F.prompt)??r.t("Create a concise, 3-5 word phrase as a header for the following query, strictly adhering to the 3-5 word limit and avoiding the use of the word 'title':")+" {{prompt}}",Mt,D,(rt==null?void 0:rt.external)??!1?((S=rt==null?void 0:rt.source)==null?void 0:S.toLowerCase())==="litellm"?`${Re}/v1`:`${je}`:`${Kl}/v1`)}else return`${D}`},It=async(D,z)=>{D===n&&e(11,O=z),(s.saveChatHistory??!0)&&(e(10,B=await Te(localStorage.token,D,{title:z})),await ke.set(await ye(localStorage.token)))},Dt=async()=>await on(localStorage.token,n).catch(async D=>[]);function Kt(D){T=D,e(1,T)}function ae(D){V=D,e(6,V)}function kt(D){A=D,e(2,A)}function Tt(D){R=D,e(14,R),e(2,A)}function ce(D){_=D,e(4,_)}function Ft(D){$=D,e(12,$)}function ue(D){it[D?"unshift":"push"](()=>{k=D,e(5,k)})}const _e=D=>{e(4,_=k.scrollHeight-k.scrollTop<=k.clientHeight+5)};function ve(D){H=D,e(13,H)}function be(D){$=D,e(12,$)}function re(D){_=D,e(4,_)}function yt(D){Z=D,e(7,Z)}return l.$$set=D=>{"chatIdProp"in D&&e(0,g=D.chatIdProp)},l.$$.update=()=>{if(l.$$.dirty[0]&67108866&&e(8,I=T.length===1&&c.filter(D=>D.tagName===T[0]).length>0?c.filter(D=>D.tagName===T[0])[0]:null),l.$$.dirty[0]&67108866&&e(9,U=T.reduce((D,z,lt,nt)=>{var S;const F=((S=c.filter(J=>J.tagName===z))==null?void 0:S.at(0))??void 0;return{...D,...F&&{[z]:F}}},{})),l.$$.dirty[0]&4)if(A.currentId!==null){let D=[],z=A.messages[A.currentId];for(;z!==null;)D.unshift({...z}),z=z.parentId!==null?A.messages[z.parentId]:null;e(14,R=D)}else e(14,R=[]);l.$$.dirty[0]&1&&g&&(async()=>{if(await Ht()){await vt(),e(3,p=!0),window.setTimeout(()=>bt(),0);const D=document.getElementById("chat-textarea");D==null||D.focus()}else await Ce("/")})()},[g,T,A,p,_,k,V,Z,I,U,B,O,$,H,R,n,a,u,f,v,ot,Vt,Ot,jt,j,et,c,Kt,ae,kt,Tt,ce,Ft,ue,_e,ve,be,re,yt]}class Yo extends Jt{constructor(t){super(),Zt(this,t,bo,_o,Yt,{chatIdProp:0},null,[-1,-1])}}export{Yo as C};
