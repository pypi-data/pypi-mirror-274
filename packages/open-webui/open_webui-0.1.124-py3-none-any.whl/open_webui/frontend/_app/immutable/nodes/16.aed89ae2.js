import{s as ie,a as A,e as $,M as ne,d as p,c as H,i as z,w as T,P as de,p as R,f as v,l as ee,g as y,h as M,m as se,j as b,r as _,n as te,Y as U,t as C}from"../chunks/scheduler.7238b518.js";import{S as me,i as fe,a as O,t as F,c as ce,f as G,b as ue,d as ge,m as _e,e as pe,g as he}from"../chunks/index.4c8b96e2.js";import{g as ve}from"../chunks/globals.7f7f1b26.js";import{g as ae}from"../chunks/navigation.a73d356d.js";import{p as ye}from"../chunks/stores.2e15bc6d.js";import{d as oe}from"../chunks/dayjs.min.20eb4964.js";import{g as le,j as be,W as Ie,d as we}from"../chunks/index.bf1cda65.js";import{p as Me}from"../chunks/index.2773335b.js";import{q as Ee}from"../chunks/index.8cf31506.js";import{M as Se}from"../chunks/Messages.c2dd6758.js";import"../chunks/Toaster.svelte_svelte_type_style_lang.93775e0f.js";import"../chunks/create.92fd517e.js";/* empty css                                                       */import"../chunks/FileSaver.min.898eb36f.js";const{document:J}=ve;function re(s){let m,t,i,n,a,o,f,I,E=oe(s[5].chat.timestamp).format(s[10].t("MMMM DD, YYYY"))+"",w,V,Y,S,h,D,c,r,B,j,N,k;function e(l){s[15](l)}function u(l){s[16](l)}function K(l){s[17](l)}let P={chatId:s[8],readOnly:!0,selectedModels:s[0],selectedModelfiles:s[4],processing:ke,bottomPadding:s[12].length>0,sendPrompt:Ve,continueGeneration:Ye,regenerateResponse:Be};return s[1]!==void 0&&(P.history=s[1]),s[7]!==void 0&&(P.messages=s[7]),s[3]!==void 0&&(P.autoScroll=s[3]),r=new Se({props:P}),R.push(()=>G(r,"history",e)),R.push(()=>G(r,"messages",u)),R.push(()=>G(r,"autoScroll",K)),{c(){m=v("div"),t=v("div"),i=v("div"),n=v("div"),a=v("div"),o=ee(s[6]),f=A(),I=v("div"),w=ee(E),V=A(),Y=v("hr"),S=A(),h=v("div"),D=v("div"),c=v("div"),ue(r.$$.fragment),this.h()},l(l){m=y(l,"DIV",{class:!0});var d=M(m);t=y(d,"DIV",{class:!0});var g=M(t);i=y(g,"DIV",{class:!0});var W=M(i);n=y(W,"DIV",{});var q=M(n);a=y(q,"DIV",{class:!0});var L=M(a);o=se(L,s[6]),L.forEach(p),f=H(q),I=y(q,"DIV",{class:!0});var Q=M(I);w=se(Q,E),Q.forEach(p),q.forEach(p),V=H(W),Y=y(W,"HR",{class:!0}),W.forEach(p),S=H(g),h=y(g,"DIV",{class:!0,id:!0});var X=M(h);D=y(X,"DIV",{class:!0});var Z=M(D);c=y(Z,"DIV",{class:!0});var x=M(c);ge(r.$$.fragment,x),x.forEach(p),Z.forEach(p),X.forEach(p),g.forEach(p),d.forEach(p),this.h()},h(){b(a,"class","text-3xl font-semibold line-clamp-1"),b(I,"class","mt-1 text-gray-400"),b(Y,"class","dark:border-gray-800 mt-6 mb-2"),b(i,"class","px-3 w-full max-w-5xl mx-auto"),b(c,"class","py-2"),b(D,"class","h-full w-full flex flex-col py-4"),b(h,"class","flex flex-col w-full flex-auto overflow-auto h-0"),b(h,"id","messages-container"),b(t,"class","flex flex-col flex-auto justify-center py-8"),b(m,"class","min-h-screen max-h-screen w-full flex flex-col text-gray-700 dark:text-gray-100 bg-white dark:bg-gray-900")},m(l,d){z(l,m,d),_(m,t),_(t,i),_(i,n),_(n,a),_(a,o),_(n,f),_(n,I),_(I,w),_(i,V),_(i,Y),_(t,S),_(t,h),_(h,D),_(D,c),_e(r,c,null),k=!0},p(l,d){(!k||d&64)&&te(o,l[6]),(!k||d&1056)&&E!==(E=oe(l[5].chat.timestamp).format(l[10].t("MMMM DD, YYYY"))+"")&&te(w,E);const g={};d&256&&(g.chatId=l[8]),d&1&&(g.selectedModels=l[0]),d&16&&(g.selectedModelfiles=l[4]),!B&&d&2&&(B=!0,g.history=l[1],U(()=>B=!1)),!j&&d&128&&(j=!0,g.messages=l[7],U(()=>j=!1)),!N&&d&8&&(N=!0,g.autoScroll=l[3],U(()=>N=!1)),r.$set(g)},i(l){k||(O(r.$$.fragment,l),k=!0)},o(l){F(r.$$.fragment,l),k=!1},d(l){l&&p(m),pe(r)}}}function De(s){let m,t,i,n;J.title=m=`
		`+(s[6]?`${s[6].length>30?`${s[6].slice(0,30)}...`:s[6]} | ${s[9]}`:`${s[9]}`)+`
	`;let a=s[2]&&re(s);return{c(){t=A(),a&&a.c(),i=$()},l(o){ne("svelte-1123lr8",J.head).forEach(p),t=H(o),a&&a.l(o),i=$()},m(o,f){z(o,t,f),a&&a.m(o,f),z(o,i,f),n=!0},p(o,[f]){(!n||f&576)&&m!==(m=`
		`+(o[6]?`${o[6].length>30?`${o[6].slice(0,30)}...`:o[6]} | ${o[9]}`:`${o[9]}`)+`
	`)&&(J.title=m),o[2]?a?(a.p(o,f),f&4&&O(a,1)):(a=re(o),a.c(),O(a,1),a.m(i.parentNode,i)):a&&(he(),F(a,1,1,()=>{a=null}),ce())},i(o){n||(O(a),n=!0)},o(o){F(a),n=!1},d(o){o&&(p(t),p(i)),a&&a.d(o)}}}let ke="";const Ve=()=>{},Ye=()=>{},Be=()=>{};function je(s,m,t){let i,n,a,o,f;T(s,le,e=>t(8,i=e)),T(s,ye,e=>t(13,n=e)),T(s,be,e=>t(14,a=e)),T(s,Ie,e=>t(9,o=e));const I=de("i18n");T(s,I,e=>t(10,f=e));let E=!1,w=!0,V=[""],Y={},S=null,h="",D=[],c=[],r={messages:{},currentId:null};const B=async()=>{if(await le.set(n.params.id),t(5,S=await Ee(localStorage.token,i).catch(async e=>(await ae("/"),null))),S){const e=S.chat;if(e){console.log(e),t(0,V=((e==null?void 0:e.models)??void 0)!==void 0?e.models:[e.models??""]),t(1,r=((e==null?void 0:e.history)??void 0)!==void 0?e.history:Me(e.messages)),t(6,h=e.title);let u=JSON.parse(localStorage.getItem("settings")??"{}");return await we.set({...u,system:e.system??u.system,options:e.options??u.options}),t(3,w=!0),await C(),c.length>0&&t(1,r.messages[c.at(-1).id].done=!0,r),await C(),!0}else return null}};function j(e){r=e,t(1,r)}function N(e){c=e,t(7,c),t(1,r)}function k(e){w=e,t(3,w)}return s.$$.update=()=>{if(s.$$.dirty&16385&&t(4,Y=V.reduce((e,u,K,P)=>{var d;const l=((d=a.filter(g=>g.tagName===u))==null?void 0:d.at(0))??void 0;return{...e,...l&&{[u]:l}}},{})),s.$$.dirty&2)if(r.currentId!==null){let e=[],u=r.messages[r.currentId];for(;u!==null;)e.unshift({...u}),u=u.parentId!==null?r.messages[u.parentId]:null;t(7,c=e)}else t(7,c=[]);s.$$.dirty&8192&&n.params.id&&(async()=>{if(await B()){await C(),t(2,E=!0),window.setTimeout(()=>scrollToBottom(),0);const e=document.getElementById("chat-textarea");e==null||e.focus()}else await ae("/")})()},[V,r,E,w,Y,S,h,c,i,o,f,I,D,n,a,j,N,k]}class Fe extends me{constructor(m){super(),fe(this,m,je,De,ie,{})}}export{Fe as component};
