import{i as C}from"./index.295018b5.js";import{O as p,L as f}from"./index.bf1cda65.js";let g;const T=new Uint8Array(16);function L(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(T)}const r=[];for(let n=0;n<256;++n)r.push((n+256).toString(16).slice(1));function v(n,e=0){return r[n[e+0]]+r[n[e+1]]+r[n[e+2]]+r[n[e+3]]+"-"+r[n[e+4]]+r[n[e+5]]+"-"+r[n[e+6]]+r[n[e+7]]+"-"+r[n[e+8]]+r[n[e+9]]+"-"+r[n[e+10]]+r[n[e+11]]+r[n[e+12]]+r[n[e+13]]+r[n[e+14]]+r[n[e+15]]}const S=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),j={randomUUID:S};function b(n,e,t){if(j.randomUUID&&!e&&!n)return j.randomUUID();n=n||{};const a=n.random||(n.rng||L)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){t=t||0;for(let o=0;o<16;++o)e[t+o]=a[o];return e}return v(a)}const U=async(n="")=>{let e=null;const t=await fetch(`${p}/urls`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}}}).then(async a=>{if(!a.ok)throw await a.json();return a.json()}).catch(a=>(console.log(a),"detail"in a?e=a.detail:e="Server connection failed",null));if(e)throw e;return t.OPENAI_API_BASE_URLS},z=async(n="",e)=>{let t=null;const a=await fetch(`${p}/urls/update`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}},body:JSON.stringify({urls:e})}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>(console.log(o),"detail"in o?t=o.detail:t="Server connection failed",null));if(t)throw t;return a.OPENAI_API_BASE_URLS},k=async(n="")=>{let e=null;const t=await fetch(`${p}/keys`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}}}).then(async a=>{if(!a.ok)throw await a.json();return a.json()}).catch(a=>(console.log(a),"detail"in a?e=a.detail:e="Server connection failed",null));if(e)throw e;return t.OPENAI_API_KEYS},B=async(n="",e)=>{let t=null;const a=await fetch(`${p}/keys/update`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}},body:JSON.stringify({keys:e})}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>(console.log(o),"detail"in o?t=o.detail:t="Server connection failed",null));if(t)throw t;return a.OPENAI_API_KEYS},M=async(n="")=>{let e=null;const t=await fetch(`${p}/models`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}}}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>{var s;return e=`OpenAI: ${((s=o==null?void 0:o.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(e)throw e;const a=Array.isArray(t)?t:(t==null?void 0:t.data)??null;return a&&a.map(o=>({id:o.id,name:o.name??o.id,external:!0})).sort((o,s)=>o.name.localeCompare(s.name))},R=async(n="",e,t=p)=>{const a=new AbortController;let o=null;const s=await fetch(`${t}/chat/completions`,{signal:a.signal,method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(l=>(console.log(l),o=l,null));if(o)throw o;return[s,a]},Y=async(n="",e,t,a,o=p)=>{var c,u;let s=null;e=N(e,a),console.log(e);const l=await fetch(`${o}/chat/completions`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:t,messages:[{role:"user",content:e}],stream:!1,max_tokens:50})}).then(async i=>{if(!i.ok)throw await i.json();return i.json()}).catch(i=>(console.log(i),"detail"in i&&(s=i.detail),null));if(s)throw s;return((u=(c=l==null?void 0:l.choices[0])==null?void 0:c.message)==null?void 0:u.content.replace(/["']/g,""))??"New Chat"},_=async(n="")=>{let e=null;const t=await fetch(`${f}/v1/models`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}}}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>{var s;return console.log(o),e=`LiteLLM: ${((s=o==null?void 0:o.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(e)throw e;const a=Array.isArray(t)?t:(t==null?void 0:t.data)??null;return a&&a.map(o=>({id:o.id,name:o.name??o.id,external:!0,source:"LiteLLM"})).sort((o,s)=>o.name.localeCompare(s.name))},V=async(n="")=>{let e=null;const t=await fetch(`${f}/model/info`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}}}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>{var s;return console.log(o),e=`LiteLLM: ${((s=o==null?void 0:o.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(e)throw e;return Array.isArray(t)?t:(t==null?void 0:t.data)??null},G=async(n="",e)=>{let t=null;const a=await fetch(`${f}/model/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}},body:JSON.stringify({model_name:e.name,litellm_params:{model:e.model,...e.api_base===""?{}:{api_base:e.api_base},...e.api_key===""?{}:{api_key:e.api_key},...isNaN(parseInt(e.rpm))?{}:{rpm:parseInt(e.rpm)},...e.max_tokens===""?{}:{max_tokens:e.max_tokens}}})}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>{var s;return console.log(o),t=`LiteLLM: ${((s=o==null?void 0:o.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(t)throw t;return a},H=async(n="",e)=>{let t=null;const a=await fetch(`${f}/model/delete`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{authorization:`Bearer ${n}`}},body:JSON.stringify({id:e})}).then(async o=>{if(!o.ok)throw await o.json();return o.json()}).catch(o=>{var s;return console.log(o),t=`LiteLLM: ${((s=o==null?void 0:o.error)==null?void 0:s.message)??"Network Problem"}`,[]});if(t)throw t;return a},J=async n=>{let e=await Promise.all([await C(n).catch(t=>(console.log(t),null)),await M(n).catch(t=>(console.log(t),null)),await _(n).catch(t=>(console.log(t),null))]);return e=e.filter(t=>t).reduce((t,a,o,s)=>t.concat(a),[]),e},K=n=>n.replace(/<\|[a-z]*$/,"").replace(/<\|[a-z]+\|$/,"").replace(/<$/,"").replaceAll(/<\|[a-z]+\|>/g," ").replaceAll("<","&lt;").trim(),W=n=>n.replaceAll("&lt;","<"),q=n=>{let e="";return new TransformStream({transform(t,a){e+=t;const o=e.split(n);o.slice(0,-1).forEach(s=>a.enqueue(s)),e=o[o.length-1]},flush(t){e&&t.enqueue(e)}})},Q=n=>{const e={messages:{},currentId:null};let t=null,a=null;for(const o of n)a=b(),t!==null&&(e.messages[t].childrenIds=[...e.messages[t].childrenIds,a]),e.messages[a]={...o,id:a,parentId:t,childrenIds:[]},t=a;return e.currentId=a,e},$=()=>{const n=document.createElement("canvas"),e=n.getContext("2d");n.height=1,n.width=1;const t=new ImageData(n.width,n.height),a=t.data;for(let s=0;s<t.data.length;s+=1)s%4!==3?a[s]=Math.floor(256*Math.random()):a[s]=255;e.putImageData(t,0,0);const o=e.getImageData(0,0,n.width,n.height).data;for(let s=0;s<o.length;s+=1)if(o[s]!==a[s])return console.log("canvasPixelTest: Wrong canvas pixel RGB value detected:",o[s],"at:",s,"expected:",a[s]),console.log("canvasPixelTest: Canvas blocking or spoofing is likely"),!1;return!0},X=n=>{const e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=100,e.height=100,!$())return console.log("generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image."),"/user.png";t.fillStyle="#F39C12",t.fillRect(0,0,e.width,e.height),t.fillStyle="#FFFFFF",t.font="40px Helvetica",t.textAlign="center",t.textBaseline="middle";const a=n.trim(),o=a.length>0?a[0]+(a.split(" ").length>1?a[a.lastIndexOf(" ")+1]:""):"";return t.fillText(o.toUpperCase(),e.width/2,e.height/2),e.toDataURL()},Z=async n=>{let e=!1;if(!navigator.clipboard){const t=document.createElement("textarea");t.value=n,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{const o=document.execCommand("copy")?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+o),e=!0}catch(a){console.error("Fallback: Oops, unable to copy",a)}return document.body.removeChild(t),e}return e=await navigator.clipboard.writeText(n).then(()=>(console.log("Async: Copying to clipboard was successful!"),!0)).catch(t=>(console.error("Async: Could not copy text: ",t),!1)),e},ee=(n,e)=>e==="0.0.0"?!1:e.localeCompare(n,void 0,{numeric:!0,sensitivity:"case",caseFirst:"upper"})<0,te=n=>{const e=/\[([^\]]+)\]/g,t=[];let a;for(;(a=e.exec(n))!==null;)t.push({word:a[1],startIndex:a.index,endIndex:e.lastIndex-1});return t},ne=n=>{const e=n.split(" "),t=e.findIndex(o=>o.startsWith("#"));return t!==-1&&e.splice(t,1),e.join(" ")},oe=n=>n.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-"),ae=n=>"mapping"in n[0]?"openai":"webui",F=n=>{var c,u,i,h,w,I,A,x;const e=n.mapping,t=[];let a="",o=null;for(let m in e){const d=e[m];a=m;try{if(t.length==0&&(d.message==null||((c=d.message.content.parts)==null?void 0:c[0])==""&&d.message.content.text==null))continue;{const y={id:m,parentId:o,childrenIds:d.children||[],role:((i=(u=d.message)==null?void 0:u.author)==null?void 0:i.role)!=="user"?"assistant":"user",content:((I=(w=(h=d.message)==null?void 0:h.content)==null?void 0:w.parts)==null?void 0:I[0])||((x=(A=d.message)==null?void 0:A.content)==null?void 0:x.text)||"",model:"gpt-3.5-turbo",done:!0,context:null};t.push(y),o=a}}catch(y){console.log("Error with",d,`
Error:`,y)}}let s={};return t.forEach(m=>s[m.id]=m),{history:{currentId:a,messages:s},models:["gpt-3.5-turbo"],messages:t,options:{},timestamp:n.create_time,title:n.title??"New Chat"}},O=n=>{const e=n.messages;if(e.length===0||e[e.length-1].childrenIds.length!==0||e[0].parentId!==null)return!1;for(let o of e)if(typeof o.content!="string")return!1;return!0},se=n=>{const e=[];let t=0;for(let a of n){const o=F(a);O(o)?e.push({id:a.id,user_id:"",title:a.title,chat:o,timestamp:a.timestamp}):t++}return console.log(t,"Conversations could not be imported"),e},re=n=>{let e;try{e=new URL(n)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"},D=n=>{const e=/[\uD800-\uDBFF][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g;return n.replace(e,"")},ie=n=>n.split(new RegExp("(?<=[.!?])")).map(t=>D(t.trim())).filter(t=>t!==""),le=(n,e)=>new File([n],e,{type:n.type}),N=(n,e)=>(e=e.replace(/{{prompt}}|{{prompt:start:\d+}}|{{prompt:end:\d+}}/g,""),n=n.replace(/{{prompt}}/g,e),n=n.replace(/{{prompt:start:(\d+)}}/g,(t,a)=>e.substring(0,parseInt(a))),n=n.replace(/{{prompt:end:(\d+)}}/g,(t,a)=>e.slice(-parseInt(a))),n),ce=n=>{const e=Math.floor(n/1e9%60),t=Math.floor(n/6e10%60),a=Math.floor(n/36e11%24),o=[];return e>=0&&o.push(`${e}s`),t>0&&o.push(`${t}m`),a>0&&o.push(`${a}h`),o.reverse().join(" ")},ue=n=>{const e=new Date,t=new Date(n*1e3),o=(e.getTime()-t.getTime())/(1e3*3600*24),s=e.getDate(),l=e.getMonth(),c=e.getFullYear(),u=t.getDate(),i=t.getMonth(),h=t.getFullYear();return c===h&&l===i&&s===u?"Today":c===h&&l===i&&s-u===1?"Yesterday":o<=7?"Previous 7 days":o<=30?"Previous 30 days":c===h?t.toLocaleString("default",{month:"long"}):t.getFullYear().toString()};export{ie as A,W as B,ue as C,Z as a,ee as b,$ as c,V as d,G as e,H as f,X as g,ae as h,se as i,U as j,k,B as l,J as m,R as n,Y as o,Q as p,te as q,ne as r,q as s,re as t,z as u,b as v,le as w,oe as x,K as y,ce as z};
